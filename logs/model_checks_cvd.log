
. cap mkdir ./output/time_series

. 
. * CVD outcomes
. * Clinical monitoring: BP measurement
. * Hospital admissions: any code and primary code for MI, stroke, heart failur
> e and vte
. local a "systolic_bp_cvd mi_admission stroke_admission heart_failure_admissio
> n vte_admission mi_primary_admission stroke_primary_admission heart_failure_p
> rimary_admission vte_primary_admission"

. local z "bp_cvd mi_admit stroke_admit hf_admit vte_admit mi_pri stroke_pri hf
> _pri vte_pri"

. forvalues i=1/9 {
  2.     local c: word `i' of `a' 
  3.         local e: word `i' of `z'
  4.         local b "ethnicity imd"
  5.         forvalues i=1/2 {
  6.         local d: word `i' of `b'
  7.                 import delimited "./output/measures/cvd/measure_`c'_`d'_ra
> te.csv", numericcols(4) clear //get csv
  8.                 gen temp_date=date(date, "YMD")
  9.                 format temp_date %td
 10.                 gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
 11.                 gen month=mofd(temp_date)
 12.                 format month %tm
 13.                 drop temp_date
 14.                 *Value to rate per 100k
.                 gen rate = value*100000
 15.                 label variable rate "Rate of `c' exacerbation per 100,000"
 16.                 *Set time series
.                 tsset `d' month 
 17.                 *Kernel density plots to check for normality and extreme v
> alues
.                 kdensity rate if `d'==1, normal name(kd_`d'_1_`e')
 18.                 kdensity rate if `d'==2, normal name(kd_`d'_2_`e')
 19.                 kdensity rate if `d'==3, normal name(kd_`d'_3_`e')
 20.                 kdensity rate if `d'==4, normal name(kd_`d'_4_`e')
 21.                 kdensity rate if `d'==5, normal name(kd_`d'_5_`e')
 22.                 *Autoregression plots by ethnicity
.                 ac rate if `d'==1, name(ac_`d'_1_`e')
 23.                 ac rate if `d'==2, name(ac_`d'_2_`e')
 24.                 ac rate if `d'==3, name(ac_`d'_3_`e')
 25.                 ac rate if `d'==4, name(ac_`d'_4_`e')
 26.                 ac rate if `d'==5, name(ac_`d'_5_`e')
 27.                 *Partial autoregression plots by ethnicity
.                 pac rate if `d'==1, name(pac_`d'_1_`e')
 28.                 pac rate if `d'==2, name(pac_`d'_2_`e')
 29.                 pac rate if `d'==3, name(pac_`d'_3_`e')
 30.                 pac rate if `d'==4, name(pac_`d'_4_`e')
 31.                 pac rate if `d'==5, name(pac_`d'_5_`e')
 32.                 *Combine Graphs
.                 graph combine kd_`d'_1_`e' kd_`d'_2_`e' kd_`d'_3_`e' kd_`d'_4
> _`e' kd_`d'_5_`e', altshrink
 33.                 graph export ./output/time_series/cvd_kd_`d'_`c'.svg, as(s
> vg) replace
 34.                 graph combine ac_`d'_1_`e' ac_`d'_2_`e' ac_`d'_3_`e' ac_`d
> '_4_`e' ac_`d'_5_`e', altshrink
 35.                 graph export ./output/time_series/cvd_ac_`d'_`c'.svg, as(s
> vg) replace
 36.                 graph combine pac_`d'_1_`e' pac_`d'_2_`e' pac_`d'_3_`e' pa
> c_`d'_4_`e' pac_`d'_5_`e', altshrink
 37.                 graph export ./output/time_series/cvd_pac_`d'_`e'.svg, as(
> svg) replace
 38.                 }
 39.         }
(5 vars, 282 obs)
(88 missing values generated)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: time series has 12 gaps)
(note: time series has 10 gaps)
(note: time series has 9 gaps)
(note: time series has 7 gaps)
(note: time series has 10 gaps)
(note: time series has 12 gaps)
(note: time series has 10 gaps)
(note: time series has 9 gaps)
(note: time series has 7 gaps)
(note: time series has 10 gaps)
(note: file ./output/time_series/cvd_kd_ethnicity_systolic_bp_cvd.svg not found
> )
(file ./output/time_series/cvd_kd_ethnicity_systolic_bp_cvd.svg written in SVG 
> format)
(note: file ./output/time_series/cvd_ac_ethnicity_systolic_bp_cvd.svg not found
> )
(file ./output/time_series/cvd_ac_ethnicity_systolic_bp_cvd.svg written in SVG 
> format)
(note: file ./output/time_series/cvd_pac_ethnicity_bp_cvd.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_bp_cvd.svg written in SVG format)
(5 vars, 329 obs)
(132 missing values generated)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: time series has 11 gaps)
(note: time series has 15 gaps)
(note: time series has 11 gaps)
(note: time series has 11 gaps)
(note: time series has 11 gaps)
(note: time series has 11 gaps)
(note: time series has 15 gaps)
(note: time series has 11 gaps)
(note: time series has 11 gaps)
(note: time series has 11 gaps)
(note: file ./output/time_series/cvd_kd_imd_systolic_bp_cvd.svg not found)
(file ./output/time_series/cvd_kd_imd_systolic_bp_cvd.svg written in SVG format
> )
(note: file ./output/time_series/cvd_ac_imd_systolic_bp_cvd.svg not found)
(file ./output/time_series/cvd_ac_imd_systolic_bp_cvd.svg written in SVG format
> )
(note: file ./output/time_series/cvd_pac_imd_bp_cvd.svg not found)
(file ./output/time_series/cvd_pac_imd_bp_cvd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_mi_admission.svg not found)
(file ./output/time_series/cvd_kd_ethnicity_mi_admission.svg written in SVG for
> mat)
(note: file ./output/time_series/cvd_ac_ethnicity_mi_admission.svg not found)
(file ./output/time_series/cvd_ac_ethnicity_mi_admission.svg written in SVG for
> mat)
(note: file ./output/time_series/cvd_pac_ethnicity_mi_admit.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_mi_admit.svg written in SVG format
> )
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_mi_admission.svg not found)
(file ./output/time_series/cvd_kd_imd_mi_admission.svg written in SVG format)
(note: file ./output/time_series/cvd_ac_imd_mi_admission.svg not found)
(file ./output/time_series/cvd_ac_imd_mi_admission.svg written in SVG format)
(note: file ./output/time_series/cvd_pac_imd_mi_admit.svg not found)
(file ./output/time_series/cvd_pac_imd_mi_admit.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_stroke_admission.svg not foun
> d)
(file ./output/time_series/cvd_kd_ethnicity_stroke_admission.svg written in SVG
>  format)
(note: file ./output/time_series/cvd_ac_ethnicity_stroke_admission.svg not foun
> d)
(file ./output/time_series/cvd_ac_ethnicity_stroke_admission.svg written in SVG
>  format)
(note: file ./output/time_series/cvd_pac_ethnicity_stroke_admit.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_stroke_admit.svg written in SVG fo
> rmat)
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_stroke_admission.svg not found)
(file ./output/time_series/cvd_kd_imd_stroke_admission.svg written in SVG forma
> t)
(note: file ./output/time_series/cvd_ac_imd_stroke_admission.svg not found)
(file ./output/time_series/cvd_ac_imd_stroke_admission.svg written in SVG forma
> t)
(note: file ./output/time_series/cvd_pac_imd_stroke_admit.svg not found)
(file ./output/time_series/cvd_pac_imd_stroke_admit.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_heart_failure_admission.svg n
> ot found)
(file ./output/time_series/cvd_kd_ethnicity_heart_failure_admission.svg written
>  in SVG format)
(note: file ./output/time_series/cvd_ac_ethnicity_heart_failure_admission.svg n
> ot found)
(file ./output/time_series/cvd_ac_ethnicity_heart_failure_admission.svg written
>  in SVG format)
(note: file ./output/time_series/cvd_pac_ethnicity_hf_admit.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_hf_admit.svg written in SVG format
> )
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_heart_failure_admission.svg not fou
> nd)
(file ./output/time_series/cvd_kd_imd_heart_failure_admission.svg written in SV
> G format)
(note: file ./output/time_series/cvd_ac_imd_heart_failure_admission.svg not fou
> nd)
(file ./output/time_series/cvd_ac_imd_heart_failure_admission.svg written in SV
> G format)
(note: file ./output/time_series/cvd_pac_imd_hf_admit.svg not found)
(file ./output/time_series/cvd_pac_imd_hf_admit.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_vte_admission.svg not found)
(file ./output/time_series/cvd_kd_ethnicity_vte_admission.svg written in SVG fo
> rmat)
(note: file ./output/time_series/cvd_ac_ethnicity_vte_admission.svg not found)
(file ./output/time_series/cvd_ac_ethnicity_vte_admission.svg written in SVG fo
> rmat)
(note: file ./output/time_series/cvd_pac_ethnicity_vte_admit.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_vte_admit.svg written in SVG forma
> t)
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_vte_admission.svg not found)
(file ./output/time_series/cvd_kd_imd_vte_admission.svg written in SVG format)
(note: file ./output/time_series/cvd_ac_imd_vte_admission.svg not found)
(file ./output/time_series/cvd_ac_imd_vte_admission.svg written in SVG format)
(note: file ./output/time_series/cvd_pac_imd_vte_admit.svg not found)
(file ./output/time_series/cvd_pac_imd_vte_admit.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_mi_primary_admission.svg not 
> found)
(file ./output/time_series/cvd_kd_ethnicity_mi_primary_admission.svg written in
>  SVG format)
(note: file ./output/time_series/cvd_ac_ethnicity_mi_primary_admission.svg not 
> found)
(file ./output/time_series/cvd_ac_ethnicity_mi_primary_admission.svg written in
>  SVG format)
(note: file ./output/time_series/cvd_pac_ethnicity_mi_pri.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_mi_pri.svg written in SVG format)
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_mi_primary_admission.svg not found)
(file ./output/time_series/cvd_kd_imd_mi_primary_admission.svg written in SVG f
> ormat)
(note: file ./output/time_series/cvd_ac_imd_mi_primary_admission.svg not found)
(file ./output/time_series/cvd_ac_imd_mi_primary_admission.svg written in SVG f
> ormat)
(note: file ./output/time_series/cvd_pac_imd_mi_pri.svg not found)
(file ./output/time_series/cvd_pac_imd_mi_pri.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_stroke_primary_admission.svg 
> not found)
(file ./output/time_series/cvd_kd_ethnicity_stroke_primary_admission.svg writte
> n in SVG format)
(note: file ./output/time_series/cvd_ac_ethnicity_stroke_primary_admission.svg 
> not found)
(file ./output/time_series/cvd_ac_ethnicity_stroke_primary_admission.svg writte
> n in SVG format)
(note: file ./output/time_series/cvd_pac_ethnicity_stroke_pri.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_stroke_pri.svg written in SVG form
> at)
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_stroke_primary_admission.svg not fo
> und)
(file ./output/time_series/cvd_kd_imd_stroke_primary_admission.svg written in S
> VG format)
(note: file ./output/time_series/cvd_ac_imd_stroke_primary_admission.svg not fo
> und)
(file ./output/time_series/cvd_ac_imd_stroke_primary_admission.svg written in S
> VG format)
(note: file ./output/time_series/cvd_pac_imd_stroke_pri.svg not found)
(file ./output/time_series/cvd_pac_imd_stroke_pri.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_heart_failure_primary_admissi
> on.svg not found)
(file ./output/time_series/cvd_kd_ethnicity_heart_failure_primary_admission.svg
>  written in SVG format)
(note: file ./output/time_series/cvd_ac_ethnicity_heart_failure_primary_admissi
> on.svg not found)
(file ./output/time_series/cvd_ac_ethnicity_heart_failure_primary_admission.svg
>  written in SVG format)
(note: file ./output/time_series/cvd_pac_ethnicity_hf_pri.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_hf_pri.svg written in SVG format)
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_heart_failure_primary_admission.svg
>  not found)
(file ./output/time_series/cvd_kd_imd_heart_failure_primary_admission.svg writt
> en in SVG format)
(note: file ./output/time_series/cvd_ac_imd_heart_failure_primary_admission.svg
>  not found)
(file ./output/time_series/cvd_ac_imd_heart_failure_primary_admission.svg writt
> en in SVG format)
(note: file ./output/time_series/cvd_pac_imd_hf_pri.svg not found)
(file ./output/time_series/cvd_pac_imd_hf_pri.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  ethnicity (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_ethnicity_vte_primary_admission.svg not
>  found)
(file ./output/time_series/cvd_kd_ethnicity_vte_primary_admission.svg written i
> n SVG format)
(note: file ./output/time_series/cvd_ac_ethnicity_vte_primary_admission.svg not
>  found)
(file ./output/time_series/cvd_ac_ethnicity_vte_primary_admission.svg written i
> n SVG format)
(note: file ./output/time_series/cvd_pac_ethnicity_vte_pri.svg not found)
(file ./output/time_series/cvd_pac_ethnicity_vte_pri.svg written in SVG format)
(5 vars, 329 obs)
       panel variable:  imd (weakly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/cvd_kd_imd_vte_primary_admission.svg not found
> )
(file ./output/time_series/cvd_kd_imd_vte_primary_admission.svg written in SVG 
> format)
(note: file ./output/time_series/cvd_ac_imd_vte_primary_admission.svg not found
> )
(file ./output/time_series/cvd_ac_imd_vte_primary_admission.svg written in SVG 
> format)
(note: file ./output/time_series/cvd_pac_imd_vte_pri.svg not found)
(file ./output/time_series/cvd_pac_imd_vte_pri.svg written in SVG format)

. log close
      name:  <unnamed>
       log:  /workspace/logs/model_checks_cvd.log
  log type:  text
 closed on:   6 Jul 2022, 10:52:22
-------------------------------------------------------------------------------

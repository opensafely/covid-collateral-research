
. cap mkdir ./output/graphs

. cap mkdir ./output/tempdata

. cap mkdir ./output/tables

. 
. * open file to write results to
. file open tablecontent using ./output/tables/`outcome'_cox_models.txt, write 
> text replace
(note: file ./output/tables/anx_cox_models.txt not found)

. file write tablecontent ("Period") _tab ("Denominator") _tab ("Events") _tab 
> ("Total person-weeks") _tab ("Rate per 1000") _tab ("Crude HR") _tab _tab ("A
> ge/Sex Adjusted") _tab _tab ("Fully Adjusted") _tab _tab  _n

. file write tablecontent _tab _tab _tab _tab _tab _tab _tab   ("HR") _tab ("95
> % CI") _tab ("HR") _tab ("95% CI") _tab ("HR") _tab ("95% CI") _tab _tab  _n

. 
. foreach period in pre pandemic wave1 easing1 wave2 easing2 wave3 easing3 {
  2. use ./output/prep_survival_`period', clear
  3. 
.     * Drop events that occur on index date
.     drop if `outcome'_admit_date==index_date
  4.     * Cox model for each outcome category
.     * Generate flags and end dates for each outcome
.     gen `outcome'_admit=(`outcome'_admit_date!=.)
  5.     tab `outcome'_admit
  6.     count if `outcome'_admit_date!=.
  7.     if r(N) > 10 {
  8.         gen `outcome'_end = end_date
  9.         replace `outcome'_end = `outcome'_admit_date if `outcome'_admit==1
 10. 
.         stset `outcome'_end, fail(`outcome'_admit) id(patient_id) enter(index
> _date) origin(index_date) 
 11.         * Kaplan-Meier plot
.         sts graph, by(eth5) ylabel(.75(.05)1)
 12.         graph export ./output/graphs/km_`outcome'_`period'_eth.svg, as(svg
> ) replace
 13.         * Cox model - crude
.         stcox i.eth5
 14.         estimates save "./output/tempdata/crude_`outcome'_eth", replace 
 15.         eststo model1
 16.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'_eth", replace) idstr("crude_`outcome'_eth") 
 17.         estat phtest, detail
 18.         * Cox model - age and gender adjusted
.         stcox i.eth5 i.age_cat i.male
 19.         estimates save "./output/tempdata/model1_`outcome'_eth", replace 
 20.         eststo model2
 21.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model1_`outcome'_eth", replace) idstr("model1_`outcome'_eth") 
 22.         estat phtest, detail
 23.         * Cox model - fully adjusted
.         stcox i.eth5 i.age_cat i.male i.urban_rural_bin i.imd i.shielded
 24.         estimates save "./output/tempdata/model2_`outcome'_eth", replace 
 25.         eststo model3
 26.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model2_`outcome'_eth", replace) idstr("model2_`outcome'_eth") 
 27.         estat phtest, detail
 28.         esttab model1 model2 model3 using "./output/tables/`outcome'_estou
> t_table_eth_`period'.txt", b(a2) ci(2) label wide compress eform ///
>         title ("`outcome'") ///
>         varlabels(`e(labels)') ///
>         stats(N_outcome) ///
>         append 
 29.         eststo clear
 30.     * Write results to table
.         * eth16 labelled columns
. 
.         local lab1: label eth5 1
 31.         local lab2: label eth5 2
 32.         local lab3: label eth5 3
 33.         local lab4: label eth5 4
 34.         local lab5: label eth5 5
 35.         /* counts */
.         
.         * First row, eth16 = 1 (White British) reference cat
.         qui safecount if eth5==1
 36.         local denominator = r(N)
 37.         qui safecount if eth5 == 1 & `outcome'_admit == 1
 38.         local event = r(N)
 39.         bysort eth5: egen total_follow_up = total(_t)
 40.         qui su total_follow_up if eth5 == 1
 41.         local person_week = r(mean)/7
 42.         local rate = 1000*(`event'/`person_week')
 43.         if `event'>10 & `event'!=. {
 44.             file write tablecontent  ("`period'") _tab ("`lab1'") _tab (`d
> enominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate') _
> tab
 45.             file write tablecontent ("1.00") _tab _tab ("1.00") _tab _tab 
> ("1.00") _n
 46.             }
 47.         else {
 48.             file write tablecontent ("`period'") _tab ("`lab`eth''") _tab 
> ("redact") _n
 49.             continue
 50.         }
 51.     * outcomesequent ethnic groups
.         forvalues eth=2/5 {
 52.             qui safecount if eth5==`eth'
 53.             local denominator = r(N)
 54.             qui safecount if eth5 == `eth' & `outcome'_admit == 1
 55.             local event = r(N)
 56.             qui su total_follow_up if eth5 == `eth'
 57.             local person_week = r(mean)/7
 58.             local rate = 1000*(`event'/`person_week')
 59.             if `event'>10 & `event'!=. {
 60.                 file write tablecontent ("`period'") _tab ("`lab`eth''") _
> tab (`denominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`r
> ate') _tab  
 61.                 cap estimates use "./output/tempdata/crude_`outcome'_eth" 
 62.                 cap lincom `eth'.eth5, eform
 63.                 file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4
> .2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 64.                 cap estimates clear
 65.                 cap estimates use "./output/tempdata/model1_`outcome'_eth"
>  
 66.                 cap lincom `eth'.eth5, eform
 67.                 file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4
> .2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 68.                 cap estimates clear
 69.                 cap estimates use "./output/tempdata/model2_`outcome'_eth"
>  
 70.                 cap lincom `eth'.eth5, eform
 71.                 file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4
> .2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab _n
 72.                 cap estimates clear
 73.             }
 74.             else {
 75.                 file write tablecontent ("`period'") _tab ("`lab`eth''") _
> tab ("redact") _n
 76.                 continue
 77.             }
 78.         }  //end ethnic group
 79. drop total_follow_up
 80.     }
 81. else { 
 82.     file write tablecontent ("`period'") _tab ("redact") _n
 83.     continue
 84. }
 85. } //end outcomes
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        974       97.40       97.40
          1 |         26        2.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  26
(26 real changes made)

                id:  patient_id
     failure event:  anx_admit != 0 & anx_admit < .
obs. time interval:  (anx_end[_n-1], anx_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          0  exclusions
------------------------------------------------------------------------------
      1,000  observations remaining, representing
      1,000  subjects
         26  failures in single-failure-per-subject data
    741,443  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       752

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_anx_pre_eth.svg not found)
(file ./output/graphs/km_anx_pre_eth.svg written in SVG format)

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -179.27383
Iteration 1:   log likelihood = -177.49688
Iteration 2:   log likelihood =  -177.4519
Iteration 3:   log likelihood = -177.45169
Iteration 4:   log likelihood = -177.45169
Refining estimates:
Iteration 0:   log likelihood = -177.45169

Cox regression -- Breslow method for ties

No. of subjects =        1,000                  Number of obs    =       1,000
No. of failures =           26
Time at risk    =       741443
                                                LR chi2(4)       =        3.64
Log likelihood  =   -177.45169                  Prob > chi2      =      0.4563

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.568741    1.35857     0.52   0.603     .2873351    8.564731
      Black  |   2.118887   1.772789     0.90   0.369      .411094     10.9213
      Mixed  |   3.141065   2.483233     1.45   0.148      .667025    14.79148
      Other  |   2.971123   2.382202     1.36   0.174       .61722    14.30215
------------------------------------------------------------------------------
(note: file ./output/tempdata/crude_anx_eth.ster not found)
file ./output/tempdata/crude_anx_eth.ster saved
(note: file ./output/tempdata/surv_crude_anx_eth.dta not found)
file ./output/tempdata/surv_crude_anx_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.06351         0.10        1         0.7461
      3.eth5      |      0.11337         0.33        1         0.5633
      4.eth5      |     -0.02618         0.02        1         0.8939
      5.eth5      |     -0.05097         0.07        1         0.7951
      ------------+---------------------------------------------------
      global test |                      1.82        4         0.7693
      ----------------------------------------------------------------

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -159.77589
Iteration 1:   log likelihood = -156.84307
Iteration 2:   log likelihood = -156.78453
Iteration 3:   log likelihood = -156.78445
Iteration 4:   log likelihood = -156.78445
Refining estimates:
Iteration 0:   log likelihood = -156.78445

Cox regression -- Breslow method for ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           24
Time at risk    =       583923
                                                LR chi2(8)       =        5.98
Log likelihood  =   -156.78445                  Prob > chi2      =      0.6491

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.138841   1.040801     0.14   0.887     .1899063     6.82947
      Black  |   2.025541   1.699502     0.84   0.400     .3911579     10.4889
      Mixed  |   2.748592   2.211145     1.26   0.209     .5680005    13.30062
      Other  |   2.753772   2.213594     1.26   0.208     .5697672     13.3094
             |
     age_cat |
41 - 60 y..  |   1.451076   .7845421     0.69   0.491     .5028954    4.186998
61 - 80 y..  |   1.940211   1.050852     1.22   0.221     .6711555    5.608862
  >80 years  |   2.401289   1.964048     1.07   0.284     .4833201    11.93037
             |
        male |
       Male  |   1.142718   .4712082     0.32   0.746       .50926     2.56412
------------------------------------------------------------------------------
(note: file ./output/tempdata/model1_anx_eth.ster not found)
file ./output/tempdata/model1_anx_eth.ster saved
(note: file ./output/tempdata/surv_model1_anx_eth.dta not found)
file ./output/tempdata/surv_model1_anx_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.02981         0.02        1         0.8816
      3.eth5      |      0.12884         0.43        1         0.5111
      4.eth5      |     -0.02849         0.02        1         0.8872
      5.eth5      |     -0.03818         0.04        1         0.8473
      0b.age_cat  |            .            .        1             .
      1.age_cat   |     -0.00480         0.00        1         0.9813
      2.age_cat   |     -0.08809         0.19        1         0.6604
      3.age_cat   |      0.07902         0.15        1         0.6949
      0b.male     |            .            .        1             .
      1.male      |     -0.20232         1.05        1         0.3052
      ------------+---------------------------------------------------
      global test |                      3.39        8         0.9076
      ----------------------------------------------------------------

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -159.77589
Iteration 1:   log likelihood =  -153.8382
Iteration 2:   log likelihood = -153.61799
Iteration 3:   log likelihood = -153.59621
Iteration 4:   log likelihood =  -153.5883
Iteration 5:   log likelihood = -153.58539
Iteration 6:   log likelihood = -153.58432
Iteration 7:   log likelihood = -153.58392
Iteration 8:   log likelihood = -153.58378
Iteration 9:   log likelihood = -153.58373
Iteration 10:  log likelihood = -153.58371
Iteration 11:  log likelihood =  -153.5837
Iteration 12:  log likelihood =  -153.5837
Iteration 13:  log likelihood =  -153.5837
Iteration 14:  log likelihood =  -153.5837
Iteration 15:  log likelihood =  -153.5837
Iteration 16:  log likelihood =  -153.5837
Iteration 17:  log likelihood =  -153.5837
Iteration 18:  log likelihood =  -153.5837
Iteration 19:  log likelihood =  -153.5837
Iteration 20:  log likelihood =  -153.5837
Iteration 21:  log likelihood =  -153.5837
Iteration 22:  log likelihood =  -153.5837
Iteration 23:  log likelihood =  -153.5837
Iteration 24:  log likelihood =  -153.5837
Iteration 25:  log likelihood =  -153.5837
Iteration 26:  log likelihood =  -153.5837
Iteration 27:  log likelihood =  -153.5837
Iteration 28:  log likelihood =  -153.5837
Iteration 29:  log likelihood =  -153.5837
Iteration 30:  log likelihood =  -153.5837
Refining estimates:
Iteration 0:   log likelihood =  -153.5837
Iteration 1:   log likelihood =  -153.5837
Iteration 2:   log likelihood =  -153.5837
Iteration 3:   log likelihood =  -153.5837

Cox regression -- Breslow method for ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           24
Time at risk    =       583923
                                                LR chi2(15)      =       12.38
Log likelihood  =    -153.5837                  Prob > chi2      =      0.6497

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.056334   .9660322     0.06   0.952     .1759403    6.342158
      Black  |   1.864595   1.570201     0.74   0.459     .3579119    9.713888
      Mixed  |   2.668233   2.148268     1.22   0.223     .5506784    12.92854
      Other  |    2.66582   2.145417     1.22   0.223     .5505478    12.90823
             |
     age_cat |
41 - 60 y..  |   1.494078   .8120638     0.74   0.460     .5149045    4.335306
61 - 80 y..  |   2.105095   1.146602     1.37   0.172     .7238349    6.122146
  >80 years  |   2.591585   2.131038     1.16   0.247     .5171659    12.98677
             |
        male |
       Male  |   1.154453   .4779719     0.35   0.729     .5128113     2.59893
             |
urban_rura~n |
      Urban  |   1.079131   .4480882     0.18   0.854     .4782214    2.435113
             |
         imd |
          1  |    .221749   .2230379    -1.50   0.134     .0308825    1.592248
          2  |   .6606951   .5422264    -0.51   0.614     .1322598     3.30046
          3  |   .6091364   .5151915    -0.59   0.558     .1160889    3.196233
          4  |   .7991385   .6452512    -0.28   0.781     .1641849    3.889652
          5  |   .2412285   .2422292    -1.42   0.157     .0337051    1.726479
             |
  1.shielded |   3.74e-15   1.09e-07    -0.00   1.000            0           .
------------------------------------------------------------------------------
(note: file ./output/tempdata/model2_anx_eth.ster not found)
file ./output/tempdata/model2_anx_eth.ster saved
(note: file ./output/tempdata/surv_model2_anx_eth.dta not found)
file ./output/tempdata/surv_model2_anx_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.04121         0.04        1         0.8398
      3.eth5      |      0.13035         0.45        1         0.5010
      4.eth5      |     -0.03438         0.03        1         0.8628
      5.eth5      |     -0.04344         0.05        1         0.8258
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.01016         0.00        1         0.9588
      2.age_cat   |     -0.08045         0.17        1         0.6809
      3.age_cat   |      0.08088         0.16        1         0.6905
      0b.male     |            .            .        1             .
      1.male      |     -0.21271         1.20        1         0.2730
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.22023         1.20        1         0.2743
      0b.imd      |            .            .        1             .
      1.imd       |     -0.30191         2.19        1         0.1385
      2.imd       |     -0.14639         0.54        1         0.4616
      3.imd       |     -0.11269         0.33        1         0.5684
      4.imd       |     -0.08941         0.19        1         0.6590
      5.imd       |     -0.04526         0.05        1         0.8248
      0b.shielded |            .            .        1             .
      1.shielded  |      0.22030         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                      7.49       15         0.9425
      ----------------------------------------------------------------
(note: file ./output/tables/anx_estout_table_eth_pre.txt not found)
(output written to ./output/tables/anx_estout_table_eth_pre.txt)
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        976       97.60       97.60
          1 |         24        2.40      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  24
(24 real changes made)

                id:  patient_id
     failure event:  anx_admit != 0 & anx_admit < .
obs. time interval:  (anx_end[_n-1], anx_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
        999  observations remaining, representing
        999  subjects
         24  failures in single-failure-per-subject data
    722,701  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       768

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_anx_pandemic_eth.svg not found)
(file ./output/graphs/km_anx_pandemic_eth.svg written in SVG format)

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -164.31377
Iteration 1:   log likelihood = -163.09208
Iteration 2:   log likelihood = -163.04337
Iteration 3:   log likelihood = -163.04336
Refining estimates:
Iteration 0:   log likelihood = -163.04336

Cox regression -- no ties

No. of subjects =          999                  Number of obs    =         999
No. of failures =           24
Time at risk    =       722701
                                                LR chi2(4)       =        2.54
Log likelihood  =   -163.04336                  Prob > chi2      =      0.6373

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .5599299   .4089169    -0.79   0.427     .1338138    2.342968
      Black  |   .9273882   .5865378    -0.12   0.905     .2684781    3.203423
      Mixed  |   1.541299   .9024985     0.74   0.460     .4891827    4.856271
      Other  |   .8066318   .5411074    -0.32   0.749     .2166055     3.00387
------------------------------------------------------------------------------
file ./output/tempdata/crude_anx_eth.ster saved
file ./output/tempdata/surv_crude_anx_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.06500         0.10        1         0.7504
      3.eth5      |      0.40235         3.89        1         0.0485
      4.eth5      |      0.10056         0.24        1         0.6227
      5.eth5      |      0.26657         1.70        1         0.1920
      ------------+---------------------------------------------------
      global test |                      5.13        4         0.2740
      ----------------------------------------------------------------

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -118.86761
Iteration 1:   log likelihood = -115.29864
Iteration 2:   log likelihood = -114.96095
Iteration 3:   log likelihood = -114.87236
Iteration 4:   log likelihood = -114.84004
Iteration 5:   log likelihood = -114.82818
Iteration 6:   log likelihood = -114.82382
Iteration 7:   log likelihood = -114.82222
Iteration 8:   log likelihood = -114.82163
Iteration 9:   log likelihood = -114.82141
Iteration 10:  log likelihood = -114.82133
Iteration 11:  log likelihood =  -114.8213
Iteration 12:  log likelihood = -114.82129
Iteration 13:  log likelihood = -114.82129
Iteration 14:  log likelihood = -114.82128
Iteration 15:  log likelihood = -114.82128
Iteration 16:  log likelihood = -114.82128
Iteration 17:  log likelihood = -114.82128
Iteration 18:  log likelihood = -114.82128
Iteration 19:  log likelihood = -114.82128
Iteration 20:  log likelihood = -114.82128
Iteration 21:  log likelihood = -114.82128
Iteration 22:  log likelihood = -114.82128
Iteration 23:  log likelihood = -114.82128
Iteration 24:  log likelihood = -114.82128
Iteration 25:  log likelihood = -114.82128
Iteration 26:  log likelihood = -114.82128
Iteration 27:  log likelihood = -114.82128
Iteration 28:  log likelihood = -114.82128
Iteration 29:  log likelihood = -114.82128
Iteration 30:  log likelihood = -114.82128
Iteration 31:  log likelihood = -114.82128
Iteration 32:  log likelihood = -114.82128
Iteration 33:  log likelihood = -114.82128
Iteration 34:  log likelihood = -114.82128
Refining estimates:
Iteration 0:   log likelihood = -114.82128
Iteration 1:   log likelihood = -114.82128
Iteration 2:   log likelihood = -114.82128

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           18
Time at risk    =       565988
                                                LR chi2(8)       =        8.09
Log likelihood  =   -114.82128                  Prob > chi2      =      0.4245

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .9177562   .7502469    -0.10   0.916      .184879    4.555826
      Black  |   .8725982   .7129093    -0.17   0.868     .1759487    4.327555
      Mixed  |   2.129945   1.509353     1.07   0.286     .5311017    8.541993
      Other  |   .9546935   .7811409    -0.06   0.955     .1920443    4.745987
             |
     age_cat |
41 - 60 y..  |   .4936405    .275532    -1.26   0.206     .1653109    1.474077
61 - 80 y..  |   .6334359    .381188    -0.76   0.448     .1947458    2.060333
  >80 years  |   1.36e-16   8.81e-09    -0.00   1.000            0           .
             |
        male |
       Male  |   .5374324   .2696447    -1.24   0.216     .2010261    1.436796
------------------------------------------------------------------------------
file ./output/tempdata/model1_anx_eth.ster saved
file ./output/tempdata/surv_model1_anx_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.06112         0.07        1         0.7944
      3.eth5      |      0.19257         0.66        1         0.4158
      4.eth5      |     -0.04004         0.03        1         0.8658
      5.eth5      |      0.03567         0.02        1         0.8794
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.02981         0.02        1         0.8985
      2.age_cat   |      0.11922         0.25        1         0.6137
      3.age_cat   |      0.12101         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.05845         0.06        1         0.8021
      ------------+---------------------------------------------------
      global test |                      1.86        8         0.9851
      ----------------------------------------------------------------

         failure _d:  anx_admit
   analysis time _t:  (anx_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -118.86761
Iteration 1:   log likelihood = -113.55597
Iteration 2:   log likelihood = -113.12325
Iteration 3:   log likelihood = -113.02594
Iteration 4:   log likelihood = -112.99047
Iteration 5:   log likelihood = -112.97746
Iteration 6:   log likelihood = -112.97268
Iteration 7:   log likelihood = -112.97092
Iteration 8:   log likelihood = -112.97027
Iteration 9:   log likelihood = -112.97003
Iteration 10:  log likelihood = -112.96995
Iteration 11:  log likelihood = -112.96991
Iteration 12:  log likelihood =  -112.9699
Iteration 13:  log likelihood =  -112.9699
Iteration 14:  log likelihood =  -112.9699
Iteration 15:  log likelihood = -112.96989
Iteration 16:  log likelihood = -112.96989
Iteration 17:  log likelihood = -112.96989
Iteration 18:  log likelihood = -112.96989
Iteration 19:  log likelihood = -112.96989
Iteration 20:  log likelihood = -112.96989
Iteration 21:  log likelihood = -112.96989
Iteration 22:  log likelihood = -112.96989
Iteration 23:  log likelihood = -112.96989
Iteration 24:  log likelihood = -112.96989
Iteration 25:  log likelihood = -112.96989
Iteration 26:  log likelihood = -112.96989
Iteration 27:  log likelihood = -112.96989
Iteration 28:  log likelihood = -112.96989
Iteration 29:  log likelihood = -112.96989
Iteration 30:  log likelihood = -112.96989
Iteration 31:  log likelihood = -112.96989
Iteration 32:  log likelihood = -112.96989
Refining estimates:
Iteration 0:   log likelihood = -112.96989
Iteration 1:   log likelihood = -112.96989
Iteration 2:   log likelihood = -112.96989

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           18
Time at risk    =       565988
                                                LR chi2(15)      =       11.80
Log likelihood  =   -112.96989                  Prob > chi2      =      0.6944

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .8879814   .7282959    -0.14   0.885       .17794     4.43133
      Black  |   .9523608   .7843816    -0.06   0.953     .1895555     4.78483
      Mixed  |   2.246443   1.600912     1.14   0.256      .555767    9.080256
      Other  |   .9881334   .8139772    -0.01   0.988     .1966239    4.965864
             |
     age_cat |
41 - 60 y..  |   .5166865   .2893401    -1.18   0.238     .1724096    1.548434
61 - 80 y..  |   .6503554   .3946332    -0.71   0.478     .1979908    2.136272
  >80 years  |   9.39e-16   2.29e-08    -0.00   1.000            0           .
             |
        male |
       Male  |   .5442044   .2737519    -1.21   0.226     .2030397    1.458623
             |
urban_rura~n |
      Urban  |   .7255879   .3659892    -0.64   0.525     .2699857    1.950021
             |
         imd |
          1  |   1.858853   2.021229     0.57   0.569     .2206423    15.66035
          2  |   .6196557   .7642922    -0.39   0.698     .0552416    6.950796
          3  |   .6430349   .7921248    -0.36   0.720     .0575015    7.191015
          4  |    1.13266   1.315749     0.11   0.915     .1162264    11.03809
          5  |    1.25587   1.412134     0.20   0.839     .1386215    11.37781
             |
  1.shielded |   1.37e-15   8.78e-08    -0.00   1.000            0           .
------------------------------------------------------------------------------
file ./output/tempdata/model2_anx_eth.ster saved
file ./output/tempdata/surv_model2_anx_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.05081         0.05        1         0.8287
      3.eth5      |      0.21054         0.80        1         0.3716
      4.eth5      |     -0.02649         0.01        1         0.9067
      5.eth5      |      0.05189         0.05        1         0.8178
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.01498         0.00        1         0.9483
      2.age_cat   |      0.10915         0.25        1         0.6153
      3.age_cat   |     -0.05323         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.08110         0.13        1         0.7230
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.08890         0.13        1         0.7174
      0b.imd      |            .            .        1             .
      1.imd       |      0.27538         1.38        1         0.2396
      2.imd       |      0.11234         0.23        1         0.6289
      3.imd       |      0.13645         0.35        1         0.5530
      4.imd       |      0.42750         3.32        1         0.0686
      5.imd       |      0.27075         1.30        1         0.2536
      0b.shielded |            .            .        1             .
      1.shielded  |      0.13148         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                      7.13       15         0.9539
      ----------------------------------------------------------------
(note: file ./output/tables/anx_estout_table_eth_pandemic.txt not found)
(output written to ./output/tables/anx_estout_table_eth_pandemic.txt)
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  0
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        993       99.30       99.30
          1 |          7        0.70      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  7
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        992       99.20       99.20
          1 |          8        0.80      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  8
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        999       99.90       99.90
          1 |          1        0.10      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  1
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        992       99.20       99.20
          1 |          8        0.80      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  8
(0 observations deleted)

  anx_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        994       99.40       99.40
          1 |          6        0.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  6

. file close tablecontent

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/cox_model_anx.log
  log type:  text
 closed on:   6 Jul 2022, 14:59:36
-------------------------------------------------------------------------------

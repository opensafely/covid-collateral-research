
. cap mkdir ./output/time_series

. 
. * Mortality outcomes - DM outcomes not currently included
. * cvd, resp, mh, mi, stroke, heart failure, vte, asthma, copd
. foreach c in cvd resp mh mi stroke heart_failure vte asthma copd all_cause {
  2.         import delimited "./output/measures/mortality/measure_`c'_mortalit
> y_ethnic_rate.csv", numericcols(4) clear      //get csv
  3.         gen temp_date=date(date, "YMD")
  4.         format temp_date %td
  5.         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
  6.         gen month=mofd(temp_date)
  7.         format month %tm
  8.         drop temp_date
  9.         *Value to rate per 100k
.         gen rate = value*100000
 10.         label variable rate "Rate of `c' per 100,000"
 11.         *Set time series
.         tsset ethnicity month 
 12.         *Kernel density plots to check for normality and extreme values
.         kdensity rate if ethnicity==1, normal name(kd_ethnicity_1_`c')
 13.         kdensity rate if ethnicity==2, normal name(kd_ethnicity_2_`c')
 14.     kdensity rate if ethnicity==3, normal name(kd_ethnicity_3_`c')
 15.     kdensity rate if ethnicity==4, normal name(kd_ethnicity_4_`c')
 16.     kdensity rate if ethnicity==5, normal name(kd_ethnicity_5_`c')
 17.         *Autoregression plots by ethnicity
.     ac rate if ethnicity==1, name(ac_ethnicity_1_`c')
 18.         ac rate if ethnicity==2, name(ac_ethnicity_2_`c')
 19.     ac rate if ethnicity==3, name(ac_ethnicity_3_`c')
 20.     ac rate if ethnicity==4, name(ac_ethnicity_4_`c')
 21.     ac rate if ethnicity==5, name(ac_ethnicity_5_`c')
 22.         /*Partial autoregression plots by ethnicity
>         pac rate if ethnicity==1, name(pac_ethnicity_1_`c')
>         pac rate if ethnicity==2, name(pac_ethnicity_2_`c')
>     pac rate if ethnicity==3, name(pac_ethnicity_3_`c')
>     pac rate if ethnicity==4, name(pac_ethnicity_4_`c')
>     pac rate if ethnicity==5, name(pac_ethnicity_5_`c')*/
.         *Combine Graphs
.         graph combine kd_ethnicity_1_`c' kd_ethnicity_2_`c' kd_ethnicity_3_`c
> ' kd_ethnicity_4_`c' kd_ethnicity_5_`c', altshrink
 23.         graph export ./output/time_series/mortality_kd_`c'_ethnicity.svg, 
> as(svg) replace
 24.         graph combine ac_ethnicity_1_`c' ac_ethnicity_2_`c' ac_ethnicity_3
> _`c' ac_ethnicity_4_`c' ac_ethnicity_5_`c', altshrink
 25.         graph export ./output/time_series/mortality_ac_`c'_ethnicity.svg, 
> as(svg) replace
 26.     /*graph combine pac_ethnicity*', altshrink
>         graph export .output/time_series/mortality_pac_`c'_ethnicity.svg, as(
> svg) replace*/
.         }
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_cvd_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_cvd_ethnicity.svg written in SVG format
> )
(note: file ./output/time_series/mortality_ac_cvd_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_cvd_ethnicity.svg written in SVG format
> )
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_resp_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_resp_ethnicity.svg written in SVG forma
> t)
(note: file ./output/time_series/mortality_ac_resp_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_resp_ethnicity.svg written in SVG forma
> t)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_mh_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_mh_ethnicity.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_mh_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_mh_ethnicity.svg written in SVG format)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_mi_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_mi_ethnicity.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_mi_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_mi_ethnicity.svg written in SVG format)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_stroke_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_stroke_ethnicity.svg written in SVG for
> mat)
(note: file ./output/time_series/mortality_ac_stroke_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_stroke_ethnicity.svg written in SVG for
> mat)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_heart_failure_ethnicity.svg not f
> ound)
(file ./output/time_series/mortality_kd_heart_failure_ethnicity.svg written in 
> SVG format)
(note: file ./output/time_series/mortality_ac_heart_failure_ethnicity.svg not f
> ound)
(file ./output/time_series/mortality_ac_heart_failure_ethnicity.svg written in 
> SVG format)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_vte_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_vte_ethnicity.svg written in SVG format
> )
(note: file ./output/time_series/mortality_ac_vte_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_vte_ethnicity.svg written in SVG format
> )
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_asthma_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_asthma_ethnicity.svg written in SVG for
> mat)
(note: file ./output/time_series/mortality_ac_asthma_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_asthma_ethnicity.svg written in SVG for
> mat)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_copd_ethnicity.svg not found)
(file ./output/time_series/mortality_kd_copd_ethnicity.svg written in SVG forma
> t)
(note: file ./output/time_series/mortality_ac_copd_ethnicity.svg not found)
(file ./output/time_series/mortality_ac_copd_ethnicity.svg written in SVG forma
> t)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_all_cause_ethnicity.svg not found
> )
(file ./output/time_series/mortality_kd_all_cause_ethnicity.svg written in SVG 
> format)
(note: file ./output/time_series/mortality_ac_all_cause_ethnicity.svg not found
> )
(file ./output/time_series/mortality_ac_all_cause_ethnicity.svg written in SVG 
> format)

. 
. * IMD
. foreach c in cvd resp mh mi stroke heart_failure vte asthma copd {
  2.         import delimited "./output/measures/mortality/measure_`c'_mortalit
> y_imd_rate.csv", numericcols(4) clear //get csv
  3.         gen temp_date=date(date, "YMD")
  4.         format temp_date %td
  5.         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
  6.         gen month=mofd(temp_date)
  7.         format month %tm
  8.         drop temp_date
  9.         *Value to rate per 100k
.         gen rate = value*100000
 10.         label variable rate "Rate of `c' per 100,000"
 11.         *Set time series
.         tsset imd month 
 12.         *Kernel density plots to check for normality and extreme values
.         kdensity rate if imd==1, normal name(kd_imd_1_`c')
 13.         kdensity rate if imd==2, normal name(kd_imd_2_`c')
 14.     kdensity rate if imd==3, normal name(kd_imd_3_`c')
 15.     kdensity rate if imd==4, normal name(kd_imd_4_`c')
 16.     kdensity rate if imd==5, normal name(kd_imd_5_`c')
 17.         *Autoregression plots by imd
.     ac rate if imd==1, name(ac_imd_1_`c')
 18.         ac rate if imd==2, name(ac_imd_2_`c')
 19.     ac rate if imd==3, name(ac_imd_3_`c')
 20.     ac rate if imd==4, name(ac_imd_4_`c')
 21.     ac rate if imd==5, name(ac_imd_5_`c')
 22.         /*Partial autoregression plots by imd
>         pac rate if imd==1, name(pac_imd_1_`c')
>         pac rate if imd==2, name(pac_imd_2_`c')
>     pac rate if imd==3, name(pac_imd_3_`c')
>     pac rate if imd==4, name(pac_imd_4_`c')
>     pac rate if imd==5, name(pac_imd_5_`c')*/
.         *Combine Graphs
.         graph combine kd_imd_1_`c' kd_imd_2_`c' kd_imd_3_`c' kd_imd_4_`c' kd_
> imd_5_`c', altshrink
 23.         graph export ./output/time_series/mortality_kd_`c'_imd.svg, as(svg
> ) replace
 24.         graph combine ac_imd_1_`c' ac_imd_2_`c' ac_imd_3_`c' ac_imd_4_`c' 
> ac_imd_5_`c', altshrink
 25.         graph export ./output/time_series/mortality_ac_`c'_imd.svg, as(svg
> ) replace
 26.     /*graph combine pac_imd*', altshrink
>         graph export .output/time_series/mortality_pac_`c'_imd.svg, as(svg) r
> eplace*/
.         }
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_cvd_imd.svg not found)
(file ./output/time_series/mortality_kd_cvd_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_cvd_imd.svg not found)
(file ./output/time_series/mortality_ac_cvd_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_resp_imd.svg not found)
(file ./output/time_series/mortality_kd_resp_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_resp_imd.svg not found)
(file ./output/time_series/mortality_ac_resp_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_mh_imd.svg not found)
(file ./output/time_series/mortality_kd_mh_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_mh_imd.svg not found)
(file ./output/time_series/mortality_ac_mh_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_mi_imd.svg not found)
(file ./output/time_series/mortality_kd_mi_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_mi_imd.svg not found)
(file ./output/time_series/mortality_ac_mi_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_stroke_imd.svg not found)
(file ./output/time_series/mortality_kd_stroke_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_stroke_imd.svg not found)
(file ./output/time_series/mortality_ac_stroke_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_heart_failure_imd.svg not found)
(file ./output/time_series/mortality_kd_heart_failure_imd.svg written in SVG fo
> rmat)
(note: file ./output/time_series/mortality_ac_heart_failure_imd.svg not found)
(file ./output/time_series/mortality_ac_heart_failure_imd.svg written in SVG fo
> rmat)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_vte_imd.svg not found)
(file ./output/time_series/mortality_kd_vte_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_vte_imd.svg not found)
(file ./output/time_series/mortality_ac_vte_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_asthma_imd.svg not found)
(file ./output/time_series/mortality_kd_asthma_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_asthma_imd.svg not found)
(file ./output/time_series/mortality_ac_asthma_imd.svg written in SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/mortality_kd_copd_imd.svg not found)
(file ./output/time_series/mortality_kd_copd_imd.svg written in SVG format)
(note: file ./output/time_series/mortality_ac_copd_imd.svg not found)
(file ./output/time_series/mortality_ac_copd_imd.svg written in SVG format)

. 
. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/model_checks_mortality.log
  log type:  text
 closed on:   4 May 2022, 11:58:47
-------------------------------------------------------------------------------


. cap mkdir ./output/time_series

. * Time series analysis for asthma monitoring, COPD monitoring and exacerbatio
> n by ethnicity & IMD
. foreach var in asthma_monitoring copd_monitoring asthma_exacerbation copd_exa
> cerbation {
  2.         foreach strata in ethnicity imd {
  3.         import delimited ./output/measures/resp/measure_`var'_`strata'_rat
> e.csv, numericcols(4) clear   //get csv
  4.         putexcel set ./output/time_series/tsreg_tables_resp, sheet(`var'_`
> strata') modify                       //open xlsx
  5.         *Format time
.         gen temp_date=date(date, "YMD")
  6.         format temp_date %td
  7.         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
  8.         gen month=mofd(temp_date)
  9.         format month %tm
 10.         *Define Seasons
.         gen season=4
 11.         replace season = 1 if inrange(month(temp_date),3,5)
 12.         replace season = 2 if inrange(month(temp_date),6,8)
 13.         replace season = 3 if inrange(month(temp_date),9,11)
 14.         label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 "Winter"
 15.         label values season seasonlab
 16.         drop temp_date
 17.         *Value to rate per 100k
.         gen rate = value*100000
 18.         *Run time series with EWH-robust SE and 1 Lag
.         tsset `strata' month
 19.         newey rate i.`strata'##i.postcovid i.season, lag(1) force
 20.         *Export results
.         putexcel E1=("Number of obs") G1=(e(N))
 21.         putexcel E2=("F") G2=(e(F))
 22.         putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F)))
 23.         matrix a = r(table)'
 24.         putexcel A6 = matrix(a), rownames
 25.         putexcel save
 26.         import excel using ./output/time_series/tsreg_tables_resp.xlsx, sh
> eet (`var'_`strata') clear
 27.     export delimited using ./output/time_series/tsreg_resp_`var'_`strata'.
> csv
 28.         }
 29. }
(5 vars, 235 obs)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.66
                                                Prob > F          =     0.7865

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   3546.245   3266.602     1.09   0.279    -2891.273    9983.762
          3  |   828.7805    3758.35     0.22   0.826    -6577.827    8235.388
          4  |   1698.872   3250.217     0.52   0.602    -4706.354    8104.099
          5  |  -1950.519   3278.497    -0.59   0.552    -8411.477    4510.439
             |
 1.postcovid |   1254.175   3267.032     0.38   0.701    -5184.188    7692.539
             |
   ethnicity#|
   postcovid |
        2 1  |  -1213.137   4373.863    -0.28   0.782    -9832.741    7406.467
        3 1  |  -4966.968   5065.418    -0.98   0.328    -14949.42    5015.488
        4 1  |  -3056.036   4541.839    -0.67   0.502    -12006.67      5894.6
        5 1  |   2488.682    4263.43     0.58   0.560    -5913.292    10890.66
             |
      season |
     Summer  |   1.937979   2108.493     0.00   0.999    -4153.286    4157.162
     Autumn  |  -151.9949   1973.694    -0.08   0.939    -4041.569    3737.579
     Winter  |    270.909   2217.518     0.12   0.903    -4099.171    4640.989
             |
       _cons |    49795.4   2748.308    18.12   0.000     44379.29    55211.51
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 27 obs)
file ./output/time_series/tsreg_resp_asthma_monitoring_ethnicity.csv saved
(5 vars, 282 obs)
(72 real changes made)
(72 real changes made)
(72 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        282
maximum lag: 1                                  F( 14,       267) =       1.00
                                                Prob > F          =     0.4517

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          1  |  -12570.11   8941.063    -1.41   0.161    -30174.07    5033.849
          2  |  -15286.43   8788.287    -1.74   0.083    -32589.58    2016.731
          3  |  -14312.41   8844.632    -1.62   0.107    -31726.51     3101.68
          4  |  -8829.964   8898.809    -0.99   0.322    -26350.73    8690.799
          5  |  -15223.67   8855.973    -1.72   0.087    -32660.09    2212.755
             |
 1.postcovid |  -16568.13   10992.32    -1.51   0.133    -38210.79    5074.533
             |
         imd#|
   postcovid |
        1 1  |   20401.36   11570.29     1.76   0.079    -2379.247    43181.96
        2 1  |   17686.31   11635.34     1.52   0.130     -5222.37       40595
        3 1  |    19267.7   11486.43     1.68   0.095    -3347.803     41883.2
        4 1  |   10034.59   11636.79     0.86   0.389    -12876.96    32946.13
        5 1  |   18717.96   11605.63     1.61   0.108    -4132.225    41568.15
             |
      season |
     Summer  |  -3880.915   3470.786    -1.12   0.265    -10714.51    2952.677
     Autumn  |  -3468.027    3532.11    -0.98   0.327    -10422.36    3486.304
     Winter  |  -3730.872   3260.336    -1.14   0.254    -10150.11    2688.366
             |
       _cons |   66477.24   9806.783     6.78   0.000     47168.78    85785.71
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 30 obs)
file ./output/time_series/tsreg_resp_asthma_monitoring_imd.csv saved
(5 vars, 235 obs)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.67
                                                Prob > F          =     0.7818

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -32652.13   36718.78    -0.89   0.375    -105014.1    39709.84
          3  |  -18555.99   37394.27    -0.50   0.620    -92249.16    55137.18
          4  |  -51323.57   37017.34    -1.39   0.167    -124273.9    21626.79
          5  |  -19657.43   37092.29    -0.53   0.597    -92755.48    53440.62
             |
 1.postcovid |  -50331.13   37783.55    -1.33   0.184    -124791.4    24129.19
             |
   ethnicity#|
   postcovid |
        2 1  |   41647.81   41333.01     1.01   0.315    -39807.46    123103.1
        3 1  |   27375.94   42199.47     0.65   0.517    -55786.87    110538.7
        4 1  |   88775.42   44320.88     2.00   0.046     1431.929    176118.9
        5 1  |   48129.35   44356.85     1.09   0.279    -39285.02    135543.7
             |
      season |
     Summer  |   7784.045   13591.57     0.57   0.567    -19000.97    34569.06
     Autumn  |   12787.71   17895.49     0.71   0.476    -22479.06    48054.49
     Winter  |   5355.718   13112.97     0.41   0.683    -20486.11    31197.55
             |
       _cons |   239988.5   31847.91     7.54   0.000     177225.6    302751.4
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 27 obs)
file ./output/time_series/tsreg_resp_copd_monitoring_ethnicity.csv saved
(5 vars, 282 obs)
(72 real changes made)
(72 real changes made)
(72 real changes made)
(6 missing values generated)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        276
maximum lag: 1                                  F( 14,       261) =       1.98
                                                Prob > F          =     0.0195

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          1  |   30653.36   40087.86     0.76   0.445    -48283.43    109590.1
          2  |   6681.089   37858.51     0.18   0.860     -67865.9    81228.08
          3  |   37605.07   38003.17     0.99   0.323    -37226.78    112436.9
          4  |  -12619.45   33917.23    -0.37   0.710    -79405.69    54166.79
          5  |   16409.63   35564.76     0.46   0.645    -53620.76    86440.02
             |
 1.postcovid |   75258.97   45072.95     1.67   0.096    -13493.94    164011.9
             |
         imd#|
   postcovid |
        1 1  |  -123601.7   51705.98    -2.39   0.018    -225415.6    -21787.7
        2 1  |  -38873.38   55964.94    -0.69   0.488    -149073.6    71326.88
        3 1  |  -95973.57   53002.05    -1.81   0.071    -200339.6    8392.499
        4 1  |  -63018.49   49910.07    -1.26   0.208    -161296.1    35259.17
        5 1  |  -59978.38   51451.38    -1.17   0.245      -161291    41334.26
             |
      season |
     Summer  |  -5386.202   17951.48    -0.30   0.764    -40734.36    29961.96
     Autumn  |   8641.309   18047.14     0.48   0.632    -26895.22    44177.83
     Winter  |  -11312.46   16848.07    -0.67   0.503    -44487.91    21862.99
             |
       _cons |   205333.6   33978.24     6.04   0.000     138427.2      272240
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 30 obs)
file ./output/time_series/tsreg_resp_copd_monitoring_imd.csv saved
(5 vars, 235 obs)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.13
                                                Prob > F          =     0.3408

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   797.7482   3832.293     0.21   0.835     -6754.58    8350.077
          3  |  -318.7713   3568.885    -0.09   0.929        -7352    6714.457
          4  |    3000.97   3402.896     0.88   0.379    -3705.142    9707.082
          5  |  -4748.799   3368.835    -1.41   0.160    -11387.79    1890.188
             |
 1.postcovid |    808.176   3619.131     0.22   0.824    -6324.073    7940.425
             |
   ethnicity#|
   postcovid |
        2 1  |  -1862.616   5680.172    -0.33   0.743    -13056.57    9331.341
        3 1  |   -6456.19   5054.949    -1.28   0.203    -16418.02    3505.635
        4 1  |  -1049.358   5386.673    -0.19   0.846    -11664.92    9566.198
        5 1  |    4915.99   4634.749     1.06   0.290    -4217.744    14049.72
             |
      season |
     Summer  |  -1.261591   2282.345    -0.00   1.000    -4499.096    4496.573
     Autumn  |  -484.0749   2264.619    -0.21   0.831    -4946.976    3978.826
     Winter  |  -16.37227   2248.075    -0.01   0.994     -4446.67    4413.926
             |
       _cons |   51297.28   3071.328    16.70   0.000     45244.59    57349.97
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 27 obs)
file ./output/time_series/tsreg_resp_asthma_exacerbation_ethnicity.csv saved
(5 vars, 282 obs)
(72 real changes made)
(72 real changes made)
(72 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        282
maximum lag: 1                                  F( 14,       267) =       1.74
                                                Prob > F          =     0.0479

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          1  |  -10706.98   6765.768    -1.58   0.115    -24028.02    2614.066
          2  |  -10661.12   6978.416    -1.53   0.128    -24400.85    3078.603
          3  |   -11174.5   6536.569    -1.71   0.089    -24044.28    1695.271
          4  |  -5257.947    6958.64    -0.76   0.451    -18958.73    8442.841
          5  |  -9376.041   6754.474    -1.39   0.166    -22674.85    3922.767
             |
 1.postcovid |  -7334.433   9327.997    -0.79   0.432    -25700.22    11031.35
             |
         imd#|
   postcovid |
        1 1  |   6368.699    9895.33     0.64   0.520     -13114.1     25851.5
        2 1  |   10312.41   10019.89     1.03   0.304    -9415.634    30040.45
        3 1  |   12084.74   9821.508     1.23   0.220    -7252.713     31422.2
        4 1  |  -2236.854   9962.992    -0.22   0.823    -21852.88    17379.17
        5 1  |   11665.94   9845.955     1.18   0.237    -7719.653    31051.52
             |
      season |
     Summer  |   312.3206   2633.602     0.12   0.906    -4872.949     5497.59
     Autumn  |   259.8861   3107.455     0.08   0.933    -5858.347    6378.119
     Winter  |   352.9446   2864.009     0.12   0.902    -5285.969    5991.858
             |
       _cons |   59891.52   6955.594     8.61   0.000     46196.73    73586.31
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 30 obs)
file ./output/time_series/tsreg_resp_asthma_exacerbation_imd.csv saved
(5 vars, 235 obs)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.54
                                                Prob > F          =     0.8893

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -16129.32   14180.01    -1.14   0.257    -44073.98    11815.34
          3  |  -19435.87   13177.59    -1.47   0.142    -45405.05    6533.302
          4  |  -12378.63   14762.96    -0.84   0.403     -41472.1    16714.85
          5  |  -10379.13   15236.53    -0.68   0.496    -40405.86    19647.61
             |
 1.postcovid |  -24374.55   12797.26    -1.90   0.058     -49594.2    845.1034
             |
   ethnicity#|
   postcovid |
        2 1  |    26873.7   16296.53     1.65   0.101    -5241.986    58989.38
        3 1  |   32847.21   16347.15     2.01   0.046     631.7672    65062.66
        4 1  |    22734.1   17885.74     1.27   0.205    -12513.46    57981.67
        5 1  |   27132.48   18911.21     1.43   0.153    -10135.97    64400.94
             |
      season |
     Summer  |   490.5525   6973.566     0.07   0.944    -13252.31    14233.41
     Autumn  |   4775.872   8328.702     0.57   0.567    -11637.56    21189.31
     Winter  |   1483.125   7233.974     0.21   0.838    -12772.92    15739.17
             |
       _cons |   118774.6   11645.88    10.20   0.000     95824.01    141725.2
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 27 obs)
file ./output/time_series/tsreg_resp_copd_exacerbation_ethnicity.csv saved
(5 vars, 282 obs)
(72 real changes made)
(72 real changes made)
(72 real changes made)
(6 missing values generated)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        276
maximum lag: 1                                  F( 14,       261) =       0.88
                                                Prob > F          =     0.5811

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          1  |   -16041.6   26809.52    -0.60   0.550    -68832.09    36748.89
          2  |  -22631.82   25393.23    -0.89   0.374    -72633.49    27369.86
          3  |  -24002.27   26918.65    -0.89   0.373    -77007.64     29003.1
          4  |  -32447.18   23332.35    -1.39   0.166    -78390.78    13496.42
          5  |  -28424.43   24093.76    -1.18   0.239    -75867.32    19018.47
             |
 1.postcovid |   14521.35   35882.02     0.40   0.686    -56133.74    85176.44
             |
         imd#|
   postcovid |
        1 1  |   -29199.8   40167.52    -0.73   0.468    -108293.4    49893.84
        2 1  |   7264.872   40996.06     0.18   0.859    -73460.25    87989.99
        3 1  |  -22598.72   40376.65    -0.56   0.576    -102104.2    56906.73
        4 1  |  -23437.04   37823.92    -0.62   0.536    -97915.91    51041.84
        5 1  |   -12443.6   38407.12    -0.32   0.746    -88070.85    63183.66
             |
      season |
     Summer  |  -5928.453   11803.61    -0.50   0.616    -29170.88    17313.98
     Autumn  |  -5319.078   11155.92    -0.48   0.634    -27286.15    16647.99
     Winter  |  -8594.986   10409.69    -0.83   0.410    -29092.66    11902.69
             |
       _cons |   139703.4   24480.54     5.71   0.000     91498.88    187907.9
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
(10 vars, 30 obs)
file ./output/time_series/tsreg_resp_copd_exacerbation_imd.csv saved

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/tsreg_resp.log
  log type:  text
 closed on:  18 May 2022, 16:00:09
-------------------------------------------------------------------------------

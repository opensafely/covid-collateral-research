
. cap mkdir ./output/time_series

. * Time series analysis for asthma monitoring, COPD monitoring and exacerbatio
> n by ethnicity & IMD
. foreach var in asthma/*_monitoring*/ copd/*_monitoring*/ /*asthma_exacerbatio
> n copd_exacerbation*/ {
  2.         foreach strata in ethnicity imd {
  3.         import delimited ./output/measures/resp/measure_`var'_monitoring_`
> strata'_rate.csv, numericcols(4) clear        //get csv
  4.         putexcel set ./output/time_series/tsreg_tables_resp, sheet(`var'_`
> strata') modify                       //open xlsx
  5.         * Drop records where ethnicity is missing - no missing IMD
.     drop if `strata'==0 | `strata'==.
  6.         drop if has_`var'==0
  7.         *Format time
.         gen temp_date=date(date, "YMD")
  8.         format temp_date %td
  9.         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
 10.         gen month=mofd(temp_date)
 11.         format month %tm
 12.         *Define Seasons
.         gen season=4
 13.         replace season = 1 if inrange(month(temp_date),3,5)
 14.         replace season = 2 if inrange(month(temp_date),6,8)
 15.         replace season = 3 if inrange(month(temp_date),9,11)
 16.         label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 "Winter"
 17.         label values season seasonlab
 18.         drop temp_date
 19.         *Value to rate per 100k
.         gen rate = value*100000
 20.         *Run time series with EWH-robust SE and 1 Lag
.         tsset `strata' month
 21.         newey rate i.`strata'##i.postcovid i.season, lag(1) force
 22.         *Export results
.         putexcel E1=("Number of obs") G1=(e(N))
 23.         putexcel E2=("F") G2=(e(F))
 24.         putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F)))
 25.         matrix a = r(table)'
 26.         putexcel A6 = matrix(a), rownames
 27.         putexcel save
 28.         quietly margins `strata'##postcovid
 29.     marginsplot
 30.     graph export ./output/time_series/margins_resp_`var'_`strata'.svg, as(
> svg) replace
 31.         import excel using ./output/time_series/tsreg_tables_resp.xlsx, sh
> eet (`var'_`strata') clear
 32.     export delimited using ./output/time_series/tsreg_resp_`var'_`strata'.
> csv, replace
 33.         }
 34. }
(6 vars, 500 obs)
(0 observations deleted)
(250 observations deleted)
(70 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        250
maximum lag: 1                                  F( 12,       237) =       0.68
                                                Prob > F          =     0.7699

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   29.60392   1540.504     0.02   0.985    -3005.225    3064.433
          3  |  -1254.149   1388.237    -0.90   0.367    -3989.009    1480.711
          4  |  -618.8468   1338.037    -0.46   0.644    -3254.811    2017.118
          5  |  -1063.014   1234.827    -0.86   0.390    -3495.653    1369.626
             |
 1.postcovid |  -1040.486   1365.512    -0.76   0.447    -3730.578    1649.606
             |
   ethnicity#|
   postcovid |
        2 1  |  -171.2158   1902.517    -0.09   0.928    -3919.221    3576.789
        3 1  |   3558.678   1892.802     1.88   0.061    -170.1874    7287.544
        4 1  |   1271.066    1774.16     0.72   0.474    -2224.071    4766.203
        5 1  |   1404.425   1816.819     0.77   0.440    -2174.751    4983.601
             |
      season |
     Summer  |   519.9925   711.3373     0.73   0.465    -881.3592    1921.344
     Autumn  |  -295.7569   854.2094    -0.35   0.729     -1978.57    1387.056
     Winter  |  -176.1435   731.3542    -0.24   0.810    -1616.929    1264.642
             |
       _cons |   10651.63   1151.543     9.25   0.000     8383.064     12920.2
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_resp_asthma_ethnicity.svg not found)
(file ./output/time_series/margins_resp_asthma_ethnicity.svg written in SVG for
> mat)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_resp_asthma_ethnicity.csv not found)
file ./output/time_series/tsreg_resp_asthma_ethnicity.csv saved
(6 vars, 600 obs)
(100 observations deleted)
(250 observations deleted)
(70 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        250
maximum lag: 1                                  F( 12,       237) =       0.46
                                                Prob > F          =     0.9371

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -187.5882   1199.445    -0.16   0.876    -2550.524    2175.348
          3  |  -236.1727     1358.4    -0.17   0.862    -2912.254    2439.908
          4  |  -27.10396   1080.591    -0.03   0.980    -2155.893    2101.686
          5  |   132.3133   1256.585     0.11   0.916     -2343.19    2607.816
             |
 1.postcovid |   590.1464   1322.388     0.45   0.656    -2014.989    3195.282
             |
         imd#|
   postcovid |
        2 1  |  -977.2363   1800.576    -0.54   0.588    -4524.413    2569.941
        3 1  |  -605.5004   1973.185    -0.31   0.759    -4492.721    3281.721
        4 1  |   322.7878   1644.247     0.20   0.845    -2916.418    3561.994
        5 1  |  -167.4123   2049.218    -0.08   0.935    -4204.421    3869.597
             |
      season |
     Summer  |   621.7707   848.5636     0.73   0.464     -1049.92    2293.461
     Autumn  |   -450.157   882.2054    -0.51   0.610    -2188.123    1287.809
     Winter  |  -224.7734   802.1677    -0.28   0.780    -1805.063    1355.516
             |
       _cons |   10224.49   983.0359    10.40   0.000     8287.889     12161.1
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_resp_asthma_imd.svg not found)
(file ./output/time_series/margins_resp_asthma_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_resp_asthma_imd.csv not found)
file ./output/time_series/tsreg_resp_asthma_imd.csv saved
(6 vars, 500 obs)
(0 observations deleted)
(250 observations deleted)
(70 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        250
maximum lag: 1                                  F( 12,       237) =       1.25
                                                Prob > F          =     0.2490

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -720.6348   2347.525    -0.31   0.759    -5345.315    3904.046
          3  |    304.399   2104.714     0.14   0.885    -3841.938    4450.736
          4  |   2804.157   2382.705     1.18   0.240    -1889.829    7498.143
          5  |   5289.394   2745.439     1.93   0.055    -119.1869    10697.98
             |
 1.postcovid |    1541.42   2274.307     0.68   0.499    -2939.019    6021.858
             |
   ethnicity#|
   postcovid |
        2 1  |   3457.787   3553.354     0.97   0.331    -3542.407    10457.98
        3 1  |   2346.264   3495.389     0.67   0.503    -4539.737    9232.265
        4 1  |  -5053.919   3240.057    -1.56   0.120    -11436.91    1329.072
        5 1  |  -7532.645   3655.177    -2.06   0.040    -14733.43   -331.8589
             |
      season |
     Summer  |  -1524.496   1634.958    -0.93   0.352    -4745.403    1696.411
     Autumn  |  -682.9418   1611.628    -0.42   0.672    -3857.887    2492.004
     Winter  |    110.878   1792.092     0.06   0.951    -3419.587    3641.343
             |
       _cons |    9337.49   1695.627     5.51   0.000     5997.064    12677.92
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_resp_copd_ethnicity.svg not found)
(file ./output/time_series/margins_resp_copd_ethnicity.svg written in SVG forma
> t)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_resp_copd_ethnicity.csv not found)
file ./output/time_series/tsreg_resp_copd_ethnicity.csv saved
(6 vars, 600 obs)
(100 observations deleted)
(250 observations deleted)
(70 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        250
maximum lag: 1                                  F( 12,       237) =       0.52
                                                Prob > F          =     0.9004

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |    321.527   3096.451     0.10   0.917    -5778.556     6421.61
          3  |  -358.6153   2743.881    -0.13   0.896    -5764.127    5046.896
          4  |  -1501.556   3036.234    -0.49   0.621     -7483.01    4479.899
          5  |   935.4962   3144.839     0.30   0.766    -5259.911    7130.904
             |
 1.postcovid |  -2179.411   2772.943    -0.79   0.433    -7642.176    3283.353
             |
         imd#|
   postcovid |
        2 1  |  -861.6424   3905.181    -0.22   0.826    -8554.942    6831.657
        3 1  |   1544.141   3811.462     0.41   0.686     -5964.53    9052.812
        4 1  |   2900.671    3974.09     0.73   0.466    -4928.382    10729.72
        5 1  |   692.1983   4083.652     0.17   0.866    -7352.695    8737.092
             |
      season |
     Summer  |  -2468.322    1759.66    -1.40   0.162    -5934.895    998.2509
     Autumn  |  -1445.814   1868.238    -0.77   0.440    -5126.286    2234.659
     Winter  |  -87.44886   1909.868    -0.05   0.964    -3849.935    3675.037
             |
       _cons |   11832.33   2481.107     4.77   0.000     6944.493    16720.17
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved
file ./output/time_series/tsreg_tables_resp.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_resp_copd_imd.svg not found)
(file ./output/time_series/margins_resp_copd_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_resp_copd_imd.csv not found)
file ./output/time_series/tsreg_resp_copd_imd.csv saved

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/tsreg_resp.log
  log type:  text
 closed on:   5 Oct 2022, 16:21:11
-------------------------------------------------------------------------------

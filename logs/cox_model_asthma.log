
. cap mkdir ./output/graphs

. cap mkdir ./output/tempdata

. cap mkdir ./output/tables

. 
. * open file to write results to
. file open tablecontent using ./output/tables/`outcome'_cox_models.txt, write 
> text replace
(note: file ./output/tables/asthma_cox_models.txt not found)

. file write tablecontent ("Period") _tab ("Denominator") _tab ("Events") _tab 
> ("Total person-weeks") _tab ("Rate per 1000") _tab ("Crude HR") _tab _tab ("A
> ge/Sex Adjusted") _tab _tab ("Fully Adjusted") _tab _tab  _n

. file write tablecontent _tab _tab _tab _tab _tab _tab _tab   ("HR") _tab ("95
> % CI") _tab ("HR") _tab ("95% CI") _tab ("HR") _tab ("95% CI") _tab _tab  _n

. 
. foreach period in pre pandemic wave1 easing1 wave2 easing2 wave3 easing3 {
  2. use ./output/prep_survival_`period', clear
  3. 
.     * Drop events that occur on index date
.     drop if `outcome'_admit_date==index_date
  4.     * Cox model for each outcome category
.     * Generate flags and end dates for each outcome
.     gen `outcome'_admit=(`outcome'_admit_date!=.)
  5.     tab `outcome'_admit
  6.     count if `outcome'_admit_date!=.
  7.     if r(N) > 10 {
  8.         gen `outcome'_end = end_date
  9.         replace `outcome'_end = `outcome'_admit_date if `outcome'_admit==1
 10. 
.         stset `outcome'_end, fail(`outcome'_admit) id(patient_id) enter(index
> _date) origin(index_date) scale(365.25) 
 11.         * Kaplan-Meier plot
.         sts graph, by(eth5) ylabel(.75(.05)1)
 12.         graph export ./output/graphs/km_`outcome'_`period'_eth.svg, as(svg
> ) replace
 13.         * Cox model - crude
.         stcox i.eth5
 14.         estimates save "./output/tempdata/crude_`outcome'_eth", replace 
 15.         eststo model1
 16.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'_eth", replace) idstr("crude_`outcome'_eth") 
 17.         estat phtest, detail
 18.         * Cox model - age and gender adjusted
.         stcox i.eth5 i.age_cat i.male
 19.         estimates save "./output/tempdata/model1_`outcome'_eth", replace 
 20.         eststo model2
 21.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model1_`outcome'_eth", replace) idstr("model1_`outcome'_eth") 
 22.         estat phtest, detail
 23.         * Cox model - fully adjusted
.         stcox i.eth5 i.age_cat i.male i.urban_rural_bin i.imd i.shielded
 24.         estimates save "./output/tempdata/model2_`outcome'_eth", replace 
 25.         eststo model3
 26.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model2_`outcome'_eth", replace) idstr("model2_`outcome'_eth") 
 27.         estat phtest, detail
 28.         esttab model1 model2 model3 using "./output/tables/`outcome'_estou
> t_table_eth_`period'.txt", b(a2) ci(2) label wide compress eform ///
>         title ("`outcome'") ///
>         varlabels(`e(labels)') ///
>         stats(N_outcome) ///
>         append 
 29.         eststo clear
 30.     * Write results to table
.         * eth16 labelled columns
. 
.         local lab1: label eth5 1
 31.         local lab2: label eth5 2
 32.         local lab3: label eth5 3
 33.         local lab4: label eth5 4
 34.         local lab5: label eth5 5
 35.         /* counts */
.         
.         * First row, eth16 = 1 (White British) reference cat
.         qui safecount if eth5==1
 36.         local denominator = r(N)
 37.         qui safecount if eth5 == 1 & `outcome'_admit == 1
 38.         local event = r(N)
 39.         bysort eth5: egen total_follow_up = total(_t)
 40.         qui su total_follow_up if eth5 == 1
 41.         local person_week = r(mean)/7
 42.         local rate = 1000*(`event'/`person_week')
 43.         
.         file write tablecontent  ("`period'") _tab ("`lab1'") _tab (`denomina
> tor') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate') _tab
 44.         file write tablecontent ("1.00") _tab _tab ("1.00") _tab _tab ("1.
> 00") _n
 45. 
.     * outcomesequent ethnic groups
.         forvalues eth=2/5 {
 46.             qui safecount if eth5==`eth'
 47.             local denominator = r(N)
 48.             qui safecount if eth5 == `eth' & `outcome'_admit == 1
 49.             local event = r(N)
 50.             qui su total_follow_up if eth5 == `eth'
 51.             local person_week = r(mean)/7
 52.             local rate = 1000*(`event'/`person_week')
 53.             file write tablecontent ("`period'") _tab ("`lab`eth''") _tab 
> (`denominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate'
> ) _tab  
 54.             cap estimates use "./output/tempdata/crude_`outcome'_eth" 
 55.             cap lincom `eth'.eth5, eform
 56.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 57.             cap estimates clear
 58.             cap estimates use "./output/tempdata/model1_`outcome'_eth" 
 59.             cap lincom `eth'.eth5, eform
 60.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 61.             cap estimates clear
 62.             cap estimates use "./output/tempdata/model2_`outcome'_eth" 
 63.             cap lincom `eth'.eth5, eform
 64.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab _n
 65.             cap estimates clear
 66.         }  //end ethnic group
 67. drop total_follow_up
 68.     }
 69. else { 
 70.     continue
 71. }
 72. } //end outcomes
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        981       98.10       98.10
          1 |         19        1.90      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  19
(19 real changes made)

                id:  patient_id
     failure event:  asthma_admit != 0 & asthma_admit < .
obs. time interval:  (asthma_end[_n-1], asthma_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)/365.25
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          0  exclusions
------------------------------------------------------------------------------
      1,000  observations remaining, representing
      1,000  subjects
         19  failures in single-failure-per-subject data
  2,040.049  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  2.058864

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_asthma_pre_eth.svg not found)
(file ./output/graphs/km_asthma_pre_eth.svg written in SVG format)

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -131.07527
Iteration 1:   log likelihood = -128.57092
Iteration 2:   log likelihood = -128.44376
Iteration 3:   log likelihood = -128.44246
Iteration 4:   log likelihood = -128.44246
Refining estimates:
Iteration 0:   log likelihood = -128.44246

Cox regression -- Breslow method for ties

No. of subjects =        1,000                  Number of obs    =       1,000
No. of failures =           19
Time at risk    =  2040.049281
                                                LR chi2(4)       =        5.27
Log likelihood  =   -128.44246                  Prob > chi2      =      0.2611

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   5.531518   5.913464     1.60   0.110     .6805629    44.95939
      Black  |   4.249216   4.654788     1.32   0.187     .4964359    36.37093
      Mixed  |   3.092126   3.457102     1.01   0.313     .3456087    27.66493
      Other  |   1.671884   2.047632     0.42   0.675     .1516007    18.43788
------------------------------------------------------------------------------
(note: file ./output/tempdata/crude_asthma_eth.ster not found)
file ./output/tempdata/crude_asthma_eth.ster saved
(note: file ./output/tempdata/surv_crude_asthma_eth.dta not found)
file ./output/tempdata/surv_crude_asthma_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.34791         2.30        1         0.1293
      3.eth5      |      0.33740         2.16        1         0.1413
      4.eth5      |      0.55646         5.88        1         0.0153
      5.eth5      |      0.24544         1.14        1         0.2848
      ------------+---------------------------------------------------
      global test |                      7.35        4         0.1183
      ----------------------------------------------------------------

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -93.292593
Iteration 1:   log likelihood = -87.832263
Iteration 2:   log likelihood = -87.558025
Iteration 3:   log likelihood = -87.511688
Iteration 4:   log likelihood = -87.494792
Iteration 5:   log likelihood = -87.488587
Iteration 6:   log likelihood = -87.486306
Iteration 7:   log likelihood = -87.485467
Iteration 8:   log likelihood = -87.485159
Iteration 9:   log likelihood = -87.485045
Iteration 10:  log likelihood = -87.485004
Iteration 11:  log likelihood = -87.484988
Iteration 12:  log likelihood = -87.484982
Iteration 13:  log likelihood =  -87.48498
Iteration 14:  log likelihood =  -87.48498
Iteration 15:  log likelihood = -87.484979
Iteration 16:  log likelihood = -87.484979
Iteration 17:  log likelihood = -87.484979
Iteration 18:  log likelihood = -87.484979
Iteration 19:  log likelihood = -87.484979
Iteration 20:  log likelihood = -87.484979
Iteration 21:  log likelihood = -87.484979
Iteration 22:  log likelihood = -87.484979
Iteration 23:  log likelihood = -87.484979
Iteration 24:  log likelihood = -87.484979
Iteration 25:  log likelihood = -87.484979
Iteration 26:  log likelihood = -87.484979
Iteration 27:  log likelihood = -87.484979
Iteration 28:  log likelihood = -87.484979
Iteration 29:  log likelihood = -87.484979
Iteration 30:  log likelihood = -87.484979
Iteration 31:  log likelihood = -87.484979
Iteration 32:  log likelihood = -87.484979
Iteration 33:  log likelihood = -87.484979
Iteration 34:  log likelihood = -87.484979
Iteration 35:  log likelihood = -87.484979
Iteration 36:  log likelihood = -87.484979
Iteration 37:  log likelihood = -87.484979
Iteration 38:  log likelihood = -87.484979
Iteration 39:  log likelihood = -87.484979
Iteration 40:  log likelihood = -87.484979
Refining estimates:
Iteration 0:   log likelihood = -87.484979
Iteration 1:   log likelihood = -87.484979
Iteration 2:   log likelihood = -87.484979

Cox regression -- Breslow method for ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           14
Time at risk    =  1615.030801
                                                LR chi2(8)       =       11.62
Log likelihood  =   -87.484979                  Prob > chi2      =      0.1692

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   4.773812   5.170844     1.44   0.149     .5713082    39.88965
      Black  |   1.705581   2.091404     0.44   0.663     .1542122    18.86366
      Mixed  |   3.133035    3.51496     1.02   0.309     .3475364    28.24427
      Other  |   .8960582    1.26933    -0.08   0.938      .055789    14.39209
             |
     age_cat |
41 - 60 y..  |   3.385882   2.265942     1.82   0.068      .912053    12.56966
61 - 80 y..  |    1.03082   .9420117     0.03   0.974     .1719152    6.180889
  >80 years  |   8.53e-19   1.54e-09    -0.00   1.000            0           .
             |
        male |
       Male  |   .8456095   .4564242    -0.31   0.756     .2935806    2.435636
------------------------------------------------------------------------------
(note: file ./output/tempdata/model1_asthma_eth.ster not found)
file ./output/tempdata/model1_asthma_eth.ster saved
(note: file ./output/tempdata/surv_model1_asthma_eth.dta not found)
file ./output/tempdata/surv_model1_asthma_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.49780         3.71        1         0.0541
      3.eth5      |      0.60939         5.27        1         0.0216
      4.eth5      |      0.72011         7.68        1         0.0056
      5.eth5      |      0.41618         2.56        1         0.1095
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.05817         0.05        1         0.8242
      2.age_cat   |      0.00696         0.00        1         0.9796
      3.age_cat   |      0.02749         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.11532         0.19        1         0.6631
      ------------+---------------------------------------------------
      global test |                      8.76        8         0.3627
      ----------------------------------------------------------------

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -93.292593
Iteration 1:   log likelihood =  -83.59622
Iteration 2:   log likelihood = -81.842644
Iteration 3:   log likelihood = -81.603135
Iteration 4:   log likelihood = -81.523066
Iteration 5:   log likelihood = -81.493692
Iteration 6:   log likelihood = -81.482896
Iteration 7:   log likelihood = -81.478925
Iteration 8:   log likelihood = -81.477465
Iteration 9:   log likelihood = -81.476928
Iteration 10:  log likelihood =  -81.47673
Iteration 11:  log likelihood = -81.476657
Iteration 12:  log likelihood = -81.476631
Iteration 13:  log likelihood = -81.476621
Iteration 14:  log likelihood = -81.476617
Iteration 15:  log likelihood = -81.476616
Iteration 16:  log likelihood = -81.476615
Iteration 17:  log likelihood = -81.476615
Iteration 18:  log likelihood = -81.476615
Iteration 19:  log likelihood = -81.476615
Iteration 20:  log likelihood = -81.476615
Iteration 21:  log likelihood = -81.476615
Iteration 22:  log likelihood = -81.476615
Iteration 23:  log likelihood = -81.476615
Iteration 24:  log likelihood = -81.476615
Iteration 25:  log likelihood = -81.476615
Iteration 26:  log likelihood = -81.476615
Iteration 27:  log likelihood = -81.476615
Iteration 28:  log likelihood = -81.476615
Iteration 29:  log likelihood = -81.476615
Iteration 30:  log likelihood = -81.476615
Iteration 31:  log likelihood = -81.476615
Iteration 32:  log likelihood = -81.476615
Iteration 33:  log likelihood = -81.476615
Iteration 34:  log likelihood = -81.476615
Iteration 35:  log likelihood = -81.476615
Iteration 36:  log likelihood = -81.476615
Iteration 37:  log likelihood = -81.476615
Iteration 38:  log likelihood = -81.476615
Iteration 39:  log likelihood = -81.476615
Refining estimates:
Iteration 0:   log likelihood = -81.476615
Iteration 1:   log likelihood = -81.476615

Cox regression -- Breslow method for ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           14
Time at risk    =  1615.030801
                                                LR chi2(15)      =       23.63
Log likelihood  =   -81.476615                  Prob > chi2      =      0.0716

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   4.359732   4.757181     1.35   0.177     .5136411    37.00495
      Black  |   1.509681   1.858987     0.33   0.738     .1351248    16.86691
      Mixed  |   2.957414   3.328605     0.96   0.335     .3257427    26.85033
      Other  |    .742429   1.054821    -0.21   0.834     .0458451    12.02312
             |
     age_cat |
41 - 60 y..  |   3.474872    2.33854     1.85   0.064     .9291635    12.99528
61 - 80 y..  |   .9868107   .9095495    -0.01   0.989     .1620601    6.008852
  >80 years  |   5.72e-18   4.07e-09    -0.00   1.000            0           .
             |
        male |
       Male  |   .8580427    .463992    -0.28   0.777     .2973146     2.47629
             |
urban_rura~n |
      Urban  |   .3717471   .2436946    -1.51   0.131     .1028613    1.343517
             |
         imd |
          1  |   .6462201   .5691541    -0.50   0.620      .114998    3.631371
          2  |   1.18e-18   4.09e-10    -0.00   1.000            0           .
          3  |   .6277185   .5516486    -0.53   0.596     .1121285    3.514098
          4  |   .2931503   .2954295    -1.22   0.223     .0406697     2.11305
          5  |   .3465516   .3516739    -1.04   0.296     .0474226    2.532508
             |
  1.shielded |   4.12e-18   6.21e-09    -0.00   1.000            0           .
------------------------------------------------------------------------------
(note: file ./output/tempdata/model2_asthma_eth.ster not found)
file ./output/tempdata/model2_asthma_eth.ster saved
(note: file ./output/tempdata/surv_model2_asthma_eth.dta not found)
file ./output/tempdata/surv_model2_asthma_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.43480         3.05        1         0.0807
      3.eth5      |      0.61690         5.63        1         0.0176
      4.eth5      |      0.70545         7.66        1         0.0057
      5.eth5      |      0.40762         2.43        1         0.1189
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.07473         0.09        1         0.7672
      2.age_cat   |      0.06074         0.05        1         0.8158
      3.age_cat   |      0.21276         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.10350         0.16        1         0.6923
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.25945         1.05        1         0.3057
      0b.imd      |            .            .        1             .
      1.imd       |     -0.56809         5.14        1         0.0233
      2.imd       |     -0.51750         0.00        1         1.0000
      3.imd       |     -0.28162         1.06        1         0.3032
      4.imd       |     -0.41420         2.58        1         0.1084
      5.imd       |     -0.41495         2.92        1         0.0873
      0b.shielded |            .            .        1             .
      1.shielded  |     -0.13077         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                     16.12       15         0.3742
      ----------------------------------------------------------------
(note: file ./output/tables/asthma_estout_table_eth_pre.txt not found)
(output written to ./output/tables/asthma_estout_table_eth_pre.txt)
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        978       97.80       97.80
          1 |         22        2.20      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  22
(22 real changes made)

                id:  patient_id
     failure event:  asthma_admit != 0 & asthma_admit < .
obs. time interval:  (asthma_end[_n-1], asthma_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)/365.25
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
        999  observations remaining, representing
        999  subjects
         22  failures in single-failure-per-subject data
  1,978.891  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  2.102669

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_asthma_pandemic_eth.svg not found)
(file ./output/graphs/km_asthma_pandemic_eth.svg written in SVG format)

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -150.73777
Iteration 1:   log likelihood =  -149.9803
Iteration 2:   log likelihood = -149.97365
Iteration 3:   log likelihood = -149.97365
Refining estimates:
Iteration 0:   log likelihood = -149.97365

Cox regression -- no ties

No. of subjects =          999                  Number of obs    =         999
No. of failures =           22
Time at risk    =   1978.89117
                                                LR chi2(4)       =        1.53
Log likelihood  =   -149.97365                  Prob > chi2      =      0.8216

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.126896   .6823742     0.20   0.844     .3439157    3.692458
      Black  |   .5609623   .4096705    -0.79   0.429     .1340608    2.347285
      Mixed  |   .6538362   .4774957    -0.58   0.561     .1562563    2.735901
      Other  |   1.023377   .6472435     0.04   0.971     .2962691    3.534966
------------------------------------------------------------------------------
file ./output/tempdata/crude_asthma_eth.ster saved
file ./output/tempdata/surv_crude_asthma_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.10513         0.24        1         0.6224
      3.eth5      |      0.01690         0.01        1         0.9368
      4.eth5      |     -0.13202         0.38        1         0.5360
      5.eth5      |     -0.22625         1.12        1         0.2890
      ------------+---------------------------------------------------
      global test |                      1.59        4         0.8112
      ----------------------------------------------------------------

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -118.84582
Iteration 1:   log likelihood =  -116.3364
Iteration 2:   log likelihood = -116.05985
Iteration 3:   log likelihood = -115.96963
Iteration 4:   log likelihood =  -115.9367
Iteration 5:   log likelihood = -115.92461
Iteration 6:   log likelihood = -115.92017
Iteration 7:   log likelihood = -115.91854
Iteration 8:   log likelihood = -115.91794
Iteration 9:   log likelihood = -115.91772
Iteration 10:  log likelihood = -115.91764
Iteration 11:  log likelihood = -115.91761
Iteration 12:  log likelihood =  -115.9176
Iteration 13:  log likelihood = -115.91759
Iteration 14:  log likelihood = -115.91759
Iteration 15:  log likelihood = -115.91759
Iteration 16:  log likelihood = -115.91759
Iteration 17:  log likelihood = -115.91759
Iteration 18:  log likelihood = -115.91759
Iteration 19:  log likelihood = -115.91759
Iteration 20:  log likelihood = -115.91759
Iteration 21:  log likelihood = -115.91759
Iteration 22:  log likelihood = -115.91759
Iteration 23:  log likelihood = -115.91759
Iteration 24:  log likelihood = -115.91759
Iteration 25:  log likelihood = -115.91759
Iteration 26:  log likelihood = -115.91759
Iteration 27:  log likelihood = -115.91759
Iteration 28:  log likelihood = -115.91759
Iteration 29:  log likelihood = -115.91759
Iteration 30:  log likelihood = -115.91759
Iteration 31:  log likelihood = -115.91759
Iteration 32:  log likelihood = -115.91759
Iteration 33:  log likelihood = -115.91759
Iteration 34:  log likelihood = -115.91759
Iteration 35:  log likelihood = -115.91759
Iteration 36:  log likelihood = -115.91759
Iteration 37:  log likelihood = -115.91759
Iteration 38:  log likelihood = -115.91759
Iteration 39:  log likelihood = -115.91759
Iteration 40:  log likelihood = -115.91759
Iteration 41:  log likelihood = -115.91759
Iteration 42:  log likelihood = -115.91759
Iteration 43:  log likelihood = -115.91759
Iteration 44:  log likelihood = -115.91759
Refining estimates:
Iteration 0:   log likelihood = -115.91759

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           18
Time at risk    =  1548.347707
                                                LR chi2(7)       =        5.86
Log likelihood  =   -115.91759                  Prob > chi2      =      0.5566

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.223987   .8218504     0.30   0.763     .3282722    4.563722
      Black  |   .4544809   .3936485    -0.91   0.363     .0832238    2.481896
      Mixed  |    .551102    .477631    -0.69   0.492     .1008114    3.012689
      Other  |   1.275058   .8578087     0.36   0.718     .3410947    4.766337
             |
     age_cat |
41 - 60 y..  |   .8059936   .4182699    -0.42   0.678     .2914748    2.228754
61 - 80 y..  |   .5570041   .3772954    -0.86   0.388     .1476671    2.101033
  >80 years  |   5.72e-20          .        .       .            .           .
             |
        male |
       Male  |   1.059186   .5002635     0.12   0.903     .4197028    2.673023
------------------------------------------------------------------------------
file ./output/tempdata/model1_asthma_eth.ster saved
file ./output/tempdata/surv_model1_asthma_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.03533         0.02        1         0.8801
      3.eth5      |     -0.00529         0.00        1         0.9821
      4.eth5      |      0.03405         0.02        1         0.8864
      5.eth5      |     -0.24789         1.07        1         0.3007
      0b.age_cat  |            .            .        1             .
      1.age_cat   |     -0.10984         0.22        1         0.6422
      2.age_cat   |     -0.16716         0.49        1         0.4845
      3.age_cat   |            .            .        1             .
      0b.male     |            .            .        1             .
      1.male      |      0.32847         1.93        1         0.1651
      ------------+---------------------------------------------------
      global test |                      4.41        7         0.7313
      ----------------------------------------------------------------

         failure _d:  asthma_admit
   analysis time _t:  (asthma_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -118.84582
Iteration 1:   log likelihood = -115.05558
Iteration 2:   log likelihood = -114.71753
Iteration 3:   log likelihood = -114.61136
Iteration 4:   log likelihood = -114.57266
Iteration 5:   log likelihood = -114.55847
Iteration 6:   log likelihood = -114.55326
Iteration 7:   log likelihood = -114.55134
Iteration 8:   log likelihood = -114.55063
Iteration 9:   log likelihood = -114.55038
Iteration 10:  log likelihood = -114.55028
Iteration 11:  log likelihood = -114.55024
Iteration 12:  log likelihood = -114.55023
Iteration 13:  log likelihood = -114.55023
Iteration 14:  log likelihood = -114.55023
Iteration 15:  log likelihood = -114.55022
Iteration 16:  log likelihood = -114.55022
Iteration 17:  log likelihood = -114.55022
Iteration 18:  log likelihood = -114.55022
Iteration 19:  log likelihood = -114.55022
Iteration 20:  log likelihood = -114.55022
Iteration 21:  log likelihood = -114.55022
Iteration 22:  log likelihood = -114.55022
Iteration 23:  log likelihood = -114.55022
Iteration 24:  log likelihood = -114.55022
Iteration 25:  log likelihood = -114.55022
Iteration 26:  log likelihood = -114.55022
Iteration 27:  log likelihood = -114.55022
Iteration 28:  log likelihood = -114.55022
Iteration 29:  log likelihood = -114.55022
Iteration 30:  log likelihood = -114.55022
Iteration 31:  log likelihood = -114.55022
Iteration 32:  log likelihood = -114.55022
Iteration 33:  log likelihood = -114.55022
Refining estimates:
Iteration 0:   log likelihood = -114.55022
Iteration 1:   log likelihood = -114.55022
Iteration 2:   log likelihood = -114.55022

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           18
Time at risk    =  1548.347707
                                                LR chi2(15)      =        8.59
Log likelihood  =   -114.55022                  Prob > chi2      =      0.8979

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.232819   .8304526     0.31   0.756     .3292399    4.616219
      Black  |   .4013444   .3484109    -1.05   0.293     .0732118    2.200156
      Mixed  |   .4897118   .4257491    -0.82   0.412     .0891081    2.691313
      Other  |   1.231382   .8337069     0.31   0.759     .3266532     4.64193
             |
     age_cat |
41 - 60 y..  |   .7886346   .4099154    -0.46   0.648     .2847341      2.1843
61 - 80 y..  |   .5379131   .3668931    -0.91   0.363     .1412977    2.047808
  >80 years  |   4.48e-16   1.72e-08    -0.00   1.000            0           .
             |
        male |
       Male  |   1.088171   .5159232     0.18   0.859     .4296611    2.755932
             |
urban_rura~n |
      Urban  |   1.691186   .8071599     1.10   0.271     .6636431    4.309711
             |
         imd |
          1  |   1.071946   1.243275     0.06   0.952     .1103886     10.4093
          2  |   1.578626   1.776403     0.41   0.685     .1739542    14.32594
          3  |   1.637584   1.844729     0.44   0.662     .1800237    14.89627
          4  |   .8639812   1.065574    -0.12   0.906     .0770357    9.689839
          5  |   1.640111   1.843517     0.44   0.660     .1811781    14.84707
             |
  1.shielded |   3.75e-16   3.91e-08    -0.00   1.000            0           .
------------------------------------------------------------------------------
file ./output/tempdata/model2_asthma_eth.ster saved
file ./output/tempdata/surv_model2_asthma_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.00227         0.00        1         0.9923
      3.eth5      |      0.00173         0.00        1         0.9942
      4.eth5      |      0.04295         0.04        1         0.8515
      5.eth5      |     -0.23896         1.06        1         0.3030
      0b.age_cat  |            .            .        1             .
      1.age_cat   |     -0.12662         0.28        1         0.5936
      2.age_cat   |     -0.23282         0.91        1         0.3413
      3.age_cat   |     -0.22957         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |      0.35887         2.31        1         0.1284
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.46884         3.71        1         0.0539
      0b.imd      |            .            .        1             .
      1.imd       |     -0.35154         2.30        1         0.1295
      2.imd       |     -0.25363         1.20        1         0.2737
      3.imd       |     -0.49268         4.36        1         0.0368
      4.imd       |     -0.14379         0.35        1         0.5513
      5.imd       |     -0.22505         0.90        1         0.3422
      0b.shielded |            .            .        1             .
      1.shielded  |     -0.36810         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                     15.60       15         0.4088
      ----------------------------------------------------------------
(note: file ./output/tables/asthma_estout_table_eth_pandemic.txt not found)
(output written to ./output/tables/asthma_estout_table_eth_pandemic.txt)
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        999       99.90       99.90
          1 |          1        0.10      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  1
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        999       99.90       99.90
          1 |          1        0.10      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  1
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        994       99.40       99.40
          1 |          6        0.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  6
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  0
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        996       99.60       99.60
          1 |          4        0.40      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  4
(0 observations deleted)

asthma_admi |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        990       99.00       99.00
          1 |         10        1.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  10

. file close tablecontent

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/cox_model_asthma.log
  log type:  text
 closed on:   6 Jul 2022, 14:25:52
-------------------------------------------------------------------------------

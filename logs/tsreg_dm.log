
. cap mkdir ./output/time_series

. * Time series analysis for t1DM, t2DM & keto by ethnicity & IMD
. * Clinical monitoring measures first as these have not been collapsed
. local a "hba1c systolic_bp t1_primary t2_primary keto_primary t1_any t2_any k
> eto_any"

. forvalues i=1/8 {
  2.     local c: word `i' of `a' 
  3.         local b "ethnicity imd"
  4.         forvalues i=1/2 {
  5.         local d: word `i' of `b'
  6.                 import delimited "./output/measures/dm/measure_dm_`c'_`d'_
> rate.csv", numericcols(4) clear       //get csv
  7.                 putexcel set ./output/time_series/tsreg_tables_dm, sheet(`
> c'_`d') modify                        //open xlsx
  8.                 * Drop records where ethnicity is missing - no missing IMD
.         drop if `d'==0
  9.                 *Format time
.                 gen temp_date=date(date, "YMD")
 10.                 format temp_date %td
 11.                 gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
 12.                 gen month=mofd(temp_date)
 13.                 format month %tm
 14.                 *Define Seasons
.                 gen season=4
 15.                 replace season = 1 if inrange(month(temp_date),3,5)
 16.                 replace season = 2 if inrange(month(temp_date),6,8)
 17.                 replace season = 3 if inrange(month(temp_date),9,11)
 18.                 label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 
> "Winter"
 19.                 label values season seasonlab
 20.                 drop temp_date
 21.                 *Value to rate per 100k
.                 gen rate = value*100000
 22.                 *Run time series with EWH-robust SE and 1 Lag
.                 tsset `d' month
 23.                 newey rate i.`d'##i.postcovid i.season, lag(1) force
 24.                 *Export results
.                 putexcel E1=("Number of obs") G1=(e(N))
 25.                 putexcel E2=("F") G2=(e(F))
 26.                 putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F))
> )
 27.                 matrix a = r(table)'
 28.                 putexcel A6 = matrix(a), rownames
 29.                 putexcel save
 30.                 import excel using ./output/time_series/tsreg_tables_dm.xl
> sx, sheet (`c'_`d') clear
 31.         export delimited using ./output/time_series/tsreg_dm_`c'_`d'.csv, 
> replace
 32.                 }
 33.         }
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.82
                                                Prob > F          =     0.0457

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   816.2631   589.8361     1.38   0.168    -346.1313    1978.658
          3  |   51.65613   518.2643     0.10   0.921    -969.6912    1073.003
          4  |   165.1963   488.3285     0.34   0.735    -797.1563    1127.549
          5  |  -224.7528   639.9799    -0.35   0.726    -1485.966     1036.46
             |
 1.postcovid |  -313.5366   502.6404    -0.62   0.533    -1304.094    677.0205
             |
   ethnicity#|
   postcovid |
        2 1  |   17.83566   784.5244     0.02   0.982    -1528.232    1563.904
        3 1  |   902.3852   722.5216     1.25   0.213    -521.4934    2326.264
        4 1  |  -751.3922   652.4771    -1.15   0.251    -2037.234    534.4492
        5 1  |    1470.65   898.1492     1.64   0.103    -299.3393    3240.639
             |
      season |
     Summer  |  -2.430739   379.4045    -0.01   0.995    -750.1259    745.2644
     Autumn  |   3.114402   378.9209     0.01   0.993    -743.6279    749.8567
     Winter  |  -11.55833    354.543    -0.03   0.974    -710.2589    687.1422
             |
       _cons |   9847.074    428.625    22.97   0.000     9002.379    10691.77
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_hba1c_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_hba1c_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.69
                                                Prob > F          =     0.7594

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |    442.079   472.4392     0.94   0.350    -488.9605    1373.118
          3  |   30.19949   454.4364     0.07   0.947    -865.3616    925.7606
          4  |  -344.1701   457.3822    -0.75   0.453    -1245.537    557.1964
          5  |    434.588   443.5341     0.98   0.328    -439.4879    1308.664
             |
 1.postcovid |  -273.4314   673.7017    -0.41   0.685      -1601.1    1054.238
             |
         imd#|
   postcovid |
        2 1  |  -575.6929   837.3659    -0.69   0.492    -2225.896     1074.51
        3 1  |   842.8039   887.8994     0.95   0.344    -906.9861    2592.594
        4 1  |   778.7684   876.9314     0.89   0.375    -949.4068    2506.944
        5 1  |  -210.1557   861.9249    -0.24   0.808    -1908.757    1488.446
             |
      season |
     Summer  |  -100.1432    304.499    -0.33   0.743    -700.2217    499.9353
     Autumn  |  -74.04933    333.499    -0.22   0.824    -731.2782    583.1795
     Winter  |  -181.2354   313.6369    -0.58   0.564     -799.322    436.8512
             |
       _cons |   10012.16   398.9266    25.10   0.000     9225.991    10798.33
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_hba1c_imd.csv not found)
file ./output/time_series/tsreg_dm_hba1c_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.12
                                                Prob > F          =     0.3434

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -71.73344   585.1623    -0.12   0.903    -1224.917     1081.45
          3  |   360.0166   502.9508     0.72   0.475    -631.1523    1351.186
          4  |  -747.9524   458.1857    -1.63   0.104    -1650.902    154.9976
          5  |   456.0155   455.8915     1.00   0.318    -442.4132    1354.444
             |
 1.postcovid |   503.5217   592.3496     0.85   0.396     -663.826    1670.869
             |
   ethnicity#|
   postcovid |
        2 1  |  -1104.469   879.1905    -1.26   0.210    -2837.097    628.1576
        3 1  |  -931.8578   852.9092    -1.09   0.276    -2612.692    748.9768
        4 1  |   500.3172   773.1245     0.65   0.518    -1023.285    2023.919
        5 1  |  -837.1081   742.5554    -1.13   0.261    -2300.467    626.2512
             |
      season |
     Summer  |   27.78244   325.8512     0.09   0.932     -614.375    669.9398
     Autumn  |    -3.5934    330.972    -0.01   0.991    -655.8423    648.6555
     Winter  |   15.08065   367.7256     0.04   0.967     -709.599    739.7603
             |
       _cons |   9979.226   411.2797    24.26   0.000     9168.714    10789.74
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_systolic_bp_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_systolic_bp_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.54
                                                Prob > F          =     0.8905

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |   441.5931   574.6446     0.77   0.443    -690.8633     1574.05
          3  |  -207.5279    616.967    -0.34   0.737    -1423.389    1008.333
          4  |   -602.151    520.237    -1.16   0.248    -1627.386     423.084
          5  |   17.39697   641.8042     0.03   0.978    -1247.411    1282.205
             |
 1.postcovid |  -263.8835   554.2036    -0.48   0.634    -1356.057    828.2895
             |
         imd#|
   postcovid |
        2 1  |  -204.7291   839.3342    -0.24   0.808    -1858.811    1449.353
        3 1  |  -144.5136   932.0892    -0.16   0.877    -1981.389    1692.361
        4 1  |   842.4253   870.5907     0.97   0.334    -873.2542    2558.105
        5 1  |   742.4632   946.5648     0.78   0.434    -1122.939    2607.865
             |
      season |
     Summer  |  -126.8841   394.4443    -0.32   0.748    -904.2184    650.4502
     Autumn  |  -138.1709   356.1307    -0.39   0.698    -840.0002    563.6585
     Winter  |   99.78457   396.9857     0.25   0.802     -682.558    882.1271
             |
       _cons |   10071.99   429.2821    23.46   0.000     9225.999    10917.98
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_systolic_bp_imd.csv not found)
file ./output/time_series/tsreg_dm_systolic_bp_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.89
                                                Prob > F          =     0.5620

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |    1148.36   2962.847     0.39   0.699    -4690.544    6987.264
          3  |   3884.202   3890.745     1.00   0.319    -3783.317    11551.72
          4  |   5235.737   3318.668     1.58   0.116    -1304.385    11775.86
          5  |   7000.788   2867.496     2.44   0.015     1349.792    12651.78
             |
 1.postcovid |   1487.879   3117.086     0.48   0.634    -4654.985    7630.743
             |
   ethnicity#|
   postcovid |
        2 1  |  -570.4871   3967.574    -0.14   0.886    -8389.415    7248.441
        3 1  |  -1452.645   4986.568    -0.29   0.771    -11279.71    8374.421
        4 1  |   -4687.15   4524.492    -1.04   0.301     -13603.6      4229.3
        5 1  |  -4001.597   4042.155    -0.99   0.323     -11967.5    3964.307
             |
      season |
     Summer  |  -225.3767   2228.567    -0.10   0.920     -4617.23    4166.477
     Autumn  |  -608.1252   2083.631    -0.29   0.771    -4714.352    3498.101
     Winter  |  -295.0914   2091.226    -0.14   0.888    -4416.286    3826.103
             |
       _cons |   47891.92   2505.595    19.11   0.000     42954.13    52829.72
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_primary_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t1_primary_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.09
                                                Prob > F          =     0.3682

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -527.2016   3592.056    -0.15   0.883    -7606.092    6551.689
          3  |   6501.479   3135.112     2.07   0.039     323.0912    12679.87
          4  |   2583.974   2999.387     0.86   0.390     -3326.94    8494.888
          5  |  -3134.475   3325.695    -0.94   0.347    -9688.447    3419.496
             |
 1.postcovid |  -2111.703   2971.348    -0.71   0.478    -7967.361    3743.954
             |
         imd#|
   postcovid |
        2 1  |   3630.369   4504.728     0.81   0.421    -5247.132    12507.87
        3 1  |  -2849.053   4209.728    -0.68   0.499    -11145.19    5447.088
        4 1  |    270.963   4668.445     0.06   0.954    -8929.177    9471.103
        5 1  |   7234.869    5188.45     1.39   0.165    -2990.048    17459.79
             |
      season |
     Summer  |   570.7668   2556.762     0.22   0.824    -4467.862    5609.396
     Autumn  |   1211.135   1964.685     0.62   0.538    -2660.685    5082.955
     Winter  |   1451.227   2311.102     0.63   0.531    -3103.279    6005.733
             |
       _cons |   49398.76   2480.671    19.91   0.000     44510.08    54287.44
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_primary_imd.csv not found)
file ./output/time_series/tsreg_dm_t1_primary_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.83
                                                Prob > F          =     0.6195

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   470.0241   623.6704     0.75   0.452    -759.0478    1699.096
          3  |  -618.5522   754.2601    -0.82   0.413    -2104.978    867.8737
          4  |   487.2284   706.3064     0.69   0.491    -904.6948    1879.152
          5  |  -543.1869   643.7661    -0.84   0.400    -1811.861    725.4877
             |
 1.postcovid |  -473.9425   919.9252    -0.52   0.607    -2286.846    1338.961
             |
   ethnicity#|
   postcovid |
        2 1  |   404.0218   1087.366     0.37   0.711    -1738.859    2546.903
        3 1  |   933.9039   1203.263     0.78   0.438    -1437.375    3305.183
        4 1  |   451.4171   1119.212     0.40   0.687    -1754.222    2657.056
        5 1  |   663.5738   1063.229     0.62   0.533    -1431.739    2758.886
             |
      season |
     Summer  |  -19.06152   393.0731    -0.05   0.961    -793.6936    755.5705
     Autumn  |    25.1628   437.2257     0.06   0.954    -836.4812    886.8068
     Winter  |  -26.05028   418.2891    -0.06   0.950    -850.3758    798.2752
             |
       _cons |   12526.23   552.3231    22.68   0.000     11437.76     13614.7
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_primary_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t2_primary_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.32
                                                Prob > F          =     0.9848

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -353.4039   828.0168    -0.43   0.670    -1985.183    1278.375
          3  |   166.2194   868.3871     0.19   0.848    -1545.118    1877.556
          4  |   30.67412   798.0515     0.04   0.969    -1542.052      1603.4
          5  |   256.4878   809.2526     0.32   0.752    -1338.312    1851.288
             |
 1.postcovid |   109.6153   842.9304     0.13   0.897    -1551.554    1770.785
             |
         imd#|
   postcovid |
        2 1  |   669.0535   1218.854     0.55   0.584     -1732.95    3071.057
        3 1  |  -975.8818   1135.283    -0.86   0.391    -3213.193    1261.429
        4 1  |  -75.25455   1132.339    -0.07   0.947    -2306.764    2156.255
        5 1  |   -334.566   1150.792    -0.29   0.772     -2602.44    1933.308
             |
      season |
     Summer  |   214.2119   528.9377     0.40   0.686    -828.1695    1256.593
     Autumn  |  -8.521121   459.7171    -0.02   0.985     -914.489    897.4467
     Winter  |   52.44735   531.0801     0.10   0.921    -994.1562    1099.051
             |
       _cons |   12394.33    672.023    18.44   0.000     11069.97    13718.69
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_primary_imd.csv not found)
file ./output/time_series/tsreg_dm_t2_primary_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.79
                                                Prob > F          =     0.6568

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   105.5928   498.4823     0.21   0.832      -876.77    1087.956
          3  |    450.011   509.8116     0.88   0.378    -554.6785      1454.7
          4  |  -210.0965   461.1391    -0.46   0.649    -1118.867    698.6738
          5  |  -398.2695   520.4817    -0.77   0.445    -1423.987    627.4476
             |
 1.postcovid |   239.8597    557.427     0.43   0.667    -858.6658    1338.385
             |
   ethnicity#|
   postcovid |
        2 1  |  -822.6438   767.0507    -1.07   0.285    -2334.276    688.9886
        3 1  |  -1058.696   752.4733    -1.41   0.161    -2541.601    424.2087
        4 1  |   437.9215    690.217     0.63   0.526    -922.2943    1798.137
        5 1  |    232.671   763.8817     0.30   0.761    -1272.716    1738.058
             |
      season |
     Summer  |   57.67895   330.4709     0.17   0.862    -593.5825    708.9404
     Autumn  |   30.58861   336.9628     0.09   0.928    -633.4665    694.6437
     Winter  |   47.83344    336.404     0.14   0.887    -615.1205    710.7874
             |
       _cons |   9987.118   380.6302    26.24   0.000     9237.008    10737.23
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_primary_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_keto_primary_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.96
                                                Prob > F          =     0.4901

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |   893.9529   579.6896     1.54   0.124    -248.4457    2036.352
          3  |   861.5038   636.3593     1.35   0.177    -392.5742    2115.582
          4  |   973.4304   612.6061     1.59   0.113    -233.8371    2180.698
          5  |    773.545   670.3891     1.15   0.250    -547.5958    2094.686
             |
 1.postcovid |   680.0878   651.3638     1.04   0.298    -603.5596    1963.735
             |
         imd#|
   postcovid |
        2 1  |  -1441.574   796.3743    -1.81   0.072    -3010.995    127.8463
        3 1  |  -1288.889   849.4776    -1.52   0.131     -2962.96    385.1832
        4 1  |  -1183.464   848.4495    -1.39   0.164     -2855.51    488.5817
        5 1  |   52.70194   882.5217     0.06   0.952     -1686.49    1791.894
             |
      season |
     Summer  |   64.67724   358.0279     0.18   0.857     -640.891    770.2455
     Autumn  |   7.524717   386.0979     0.02   0.984    -753.3612    768.4107
     Winter  |  -19.92024   379.9614    -0.05   0.958     -768.713    728.8725
             |
       _cons |    9305.83   557.2031    16.70   0.000     8207.746    10403.91
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_primary_imd.csv not found)
file ./output/time_series/tsreg_dm_keto_primary_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.21
                                                Prob > F          =     0.2775

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   6373.929   3423.578     1.86   0.064    -372.9411     13120.8
          3  |   5715.727   3218.406     1.78   0.077    -626.8098    12058.26
          4  |   8487.505   2650.312     3.20   0.002     3264.516    13710.49
          5  |   5937.309   2332.279     2.55   0.012      1341.07    10533.55
             |
 1.postcovid |   3025.611   3065.637     0.99   0.325    -3015.863    9067.085
             |
   ethnicity#|
   postcovid |
        2 1  |  -3326.969    4759.23    -0.70   0.485    -12706.02    6052.081
        3 1  |  -3695.722   5261.873    -0.70   0.483    -14065.33     6673.89
        4 1  |  -7735.116   4521.661    -1.71   0.089    -16645.99    1175.754
        5 1  |  -740.0178   4411.077    -0.17   0.867     -9432.96    7952.925
             |
      season |
     Summer  |   -156.226   1785.999    -0.09   0.930    -3675.907    3363.455
     Autumn  |  -151.8167    2039.46    -0.07   0.941    -4170.995    3867.362
     Winter  |   260.0194   2447.432     0.11   0.915    -4563.153    5083.192
             |
       _cons |   45413.82   2055.525    22.09   0.000     41362.98    49464.66
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_any_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t1_any_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.39
                                                Prob > F          =     0.9649

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |    1375.89   3250.849     0.42   0.673    -5030.582    7782.362
          3  |   2368.069   3505.292     0.68   0.500    -4539.836    9275.974
          4  |  -614.5718   3403.715    -0.18   0.857    -7322.297    6093.154
          5  |  -1076.494     3323.7    -0.32   0.746    -7626.533    5473.546
             |
 1.postcovid |  -2142.128   3598.465    -0.60   0.552    -9233.649    4949.393
             |
         imd#|
   postcovid |
        2 1  |  -106.0785   4997.984    -0.02   0.983    -9955.643    9743.486
        3 1  |   2242.357   5273.406     0.43   0.671    -8149.983     12634.7
        4 1  |   361.2017   4758.262     0.08   0.940     -9015.94    9738.343
        5 1  |   4287.961   5126.743     0.84   0.404     -5815.35    14391.27
             |
      season |
     Summer  |  -149.3561   2037.776    -0.07   0.942    -4165.216    3866.504
     Autumn  |   259.5205    2376.67     0.11   0.913    -4424.201    4943.242
     Winter  |  -6.553429   2145.051    -0.00   0.998    -4233.821    4220.714
             |
       _cons |   50395.68   2707.111    18.62   0.000     45060.75     55730.6
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_any_imd.csv not found)
file ./output/time_series/tsreg_dm_t1_any_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.89
                                                Prob > F          =     0.0365

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   1602.849    763.762     2.10   0.037     97.69714        3108
          3  |  -654.3005    647.094    -1.01   0.313    -1929.533    620.9324
          4  |   790.0079   623.8974     1.27   0.207    -439.5113    2019.527
          5  |   1274.866     675.08     1.89   0.060    -55.51933    2605.251
             |
 1.postcovid |   1502.773   748.7029     2.01   0.046     27.29862    2978.247
             |
   ethnicity#|
   postcovid |
        2 1  |  -2306.587   1079.436    -2.14   0.034     -4433.84   -179.3349
        3 1  |  -641.9892   1005.858    -0.64   0.524     -2624.24    1340.262
        4 1  |  -2703.157   999.7978    -2.70   0.007    -4673.466   -732.8485
        5 1  |  -1774.696   976.5425    -1.82   0.071    -3699.175    149.7838
             |
      season |
     Summer  |   19.21893   472.8101     0.04   0.968    -912.5514    950.9893
     Autumn  |  -47.52555   443.8832    -0.11   0.915    -922.2895    827.2384
     Winter  |   9.438823     419.48     0.02   0.982    -817.2336    836.1112
             |
       _cons |   11887.29   480.4689    24.74   0.000     10940.43    12834.15
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_any_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t2_any_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.58
                                                Prob > F          =     0.8597

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |   602.4395   748.5632     0.80   0.422    -872.7596    2077.639
          3  |  -789.3226   703.1971    -1.12   0.263    -2175.118    596.4732
          4  |   133.5384   772.0607     0.17   0.863    -1387.967    1655.044
          5  |   671.1471   697.6739     0.96   0.337     -703.764    2046.058
             |
 1.postcovid |   362.0877   723.9423     0.50   0.617    -1064.591    1788.766
             |
         imd#|
   postcovid |
        2 1  |  -756.2695   1013.354    -0.75   0.456    -2753.293    1240.754
        3 1  |   129.2797   1035.086     0.12   0.901    -1910.573    2169.132
        4 1  |  -93.30879   1114.052    -0.08   0.933    -2288.779    2102.162
        5 1  |  -918.4547   1013.156    -0.91   0.366    -2915.089     1078.18
             |
      season |
     Summer  |  -86.78037    474.174    -0.18   0.855    -1021.239    847.6778
     Autumn  |  -9.218148   462.2157    -0.02   0.984    -920.1101    901.6738
     Winter  |  -84.43415    480.827    -0.18   0.861    -1032.003    863.1351
             |
       _cons |   12410.05   578.8331    21.44   0.000     11269.34    13550.76
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_any_imd.csv not found)
file ./output/time_series/tsreg_dm_t2_any_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.58
                                                Prob > F          =     0.8590

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   66.79922   567.1864     0.12   0.906    -1050.959    1184.558
          3  |    119.208   481.4709     0.25   0.805    -829.6302    1068.046
          4  |  -633.0782   511.1387    -1.24   0.217    -1640.383    374.2266
          5  |  -164.5888   580.5042    -0.28   0.777    -1308.593    979.4152
             |
 1.postcovid |  -123.7056   507.5894    -0.24   0.808    -1124.016    876.6046
             |
   ethnicity#|
   postcovid |
        2 1  |  -474.7803   742.2171    -0.64   0.523    -1937.473    987.9124
        3 1  |   264.0989    658.524     0.40   0.689    -1033.659    1561.857
        4 1  |   885.1675   744.4772     1.19   0.236    -581.9793    2352.314
        5 1  |     116.78   708.0645     0.16   0.869    -1278.608    1512.168
             |
      season |
     Summer  |    15.9342   310.9453     0.05   0.959    -596.8481    628.7165
     Autumn  |    -5.4738   344.0507    -0.02   0.987    -683.4971    672.5495
     Winter  |   -1.59365   298.2263    -0.01   0.996    -589.3105    586.1232
             |
       _cons |   10098.78   371.7831    27.16   0.000     9366.106    10831.46
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_any_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_keto_any_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.64
                                                Prob > F          =     0.8078

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |    651.549   533.9575     1.22   0.224    -400.7249    1703.823
          3  |   733.5465   430.9786     1.70   0.090    -115.7862    1582.879
          4  |   307.9798   545.5889     0.56   0.573    -767.2164    1383.176
          5  |  -410.5015   500.5672    -0.82   0.413    -1396.973    575.9699
             |
 1.postcovid |   61.09585   421.3158     0.15   0.885    -769.1944    891.3861
             |
         imd#|
   postcovid |
        2 1  |   -302.524   851.2898    -0.36   0.723    -1980.167    1375.119
        3 1  |  -770.4477   662.1696    -1.16   0.246     -2075.39    534.4948
        4 1  |  -138.6796   712.1318    -0.19   0.846    -1542.083    1264.724
        5 1  |   728.4237   736.4007     0.99   0.324    -722.8067    2179.654
             |
      season |
     Summer  |   87.49834   328.0636     0.27   0.790    -559.0191    734.0158
     Autumn  |    78.8613   377.5264     0.21   0.835    -665.1328    822.8554
     Winter  |  -108.7351   325.3719    -0.33   0.739     -749.948    532.4778
             |
       _cons |   9706.913      354.8    27.36   0.000     9007.706    10406.12
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_any_imd.csv not found)
file ./output/time_series/tsreg_dm_keto_any_imd.csv saved

. 
. /* hospitalisations collapsed to 3 monthly for ethnicity
> foreach var in t1_primary t1_any t2_primary t2_any keto_primary keto_any {
>         import delimited ./output/measures/dm/collapse_measure_dm_`var'_ethni
> city_rate.csv, numericcols(2) clear        //get csv
>         putexcel set ./output/time_series/tsreg_tables_dm, sheet(`var'_ethnic
> ity) modify                        //open xlsx
>         *Format time
>         gen temp_date=date(date, "DM20Y")
>         format temp_date %td
>         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
>         gen quarter=qofd(temp_date)
>         format quarter %tq
>         /*Define Seasons - not needed as collinarity with quarter
>         gen season=4
>         replace season = 1 if inrange(month(temp_date),3,5)
>         replace season = 2 if inrange(month(temp_date),6,8)
>         replace season = 3 if inrange(month(temp_date),9,11)
>         label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 "Winter"
>         label values season seasonlab*/
>         drop temp_date
>         *Run time series with EWH-robust SE and 1 Lag
>         tsset ethnicity quarter
>         newey rate i.ethnicity##i.postcovid, lag(1) force
>         *Export results
>         putexcel E1=("Number of obs") G1=(e(N))
>         putexcel E2=("F") G2=(e(F))
>         putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F)))
>         matrix a = r(table)'
>         putexcel A6 = matrix(a), rownames
>         putexcel save
>         }
> 
> * hospitalisations monthly by IMD
> foreach var in t1_primary t1_any t2_primary t2_any keto_primary keto_any {
>         import delimited ./output/measures/dm/measure_dm_`var'_imd_rate.csv, 
> numericcols(4) clear       //get csv
>         putexcel set ./output/time_series/tsreg_tables_dm, sheet(`var'_imd) m
> odify                      //open xlsx
>         *Format time
>         gen temp_date=date(date, "YMD")
>         format temp_date %td
>         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
>         gen month=mofd(temp_date)
>         format month %tm
>         *Define Seasons
>         gen season=4
>         replace season = 1 if inrange(month(temp_date),3,5)
>         replace season = 2 if inrange(month(temp_date),6,8)
>         replace season = 3 if inrange(month(temp_date),9,11)
>         label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 "Winter"
>         label values season seasonlab
>         drop temp_date
>         *Value to rate per 100k
>         gen rate = value*100000
>         *Run time series with EWH-robust SE and 1 Lag
>         tsset imd month
>         newey rate i.imd##i.postcovid i.season, lag(1) force
>         *Export results
>         putexcel E1=("Number of obs") G1=(e(N))
>         putexcel E2=("F") G2=(e(F))
>         putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F)))
>         matrix a = r(table)'
>         putexcel A6 = matrix(a), rownames
>         putexcel save
>         }
> 
> log close

end of do-file

. . file open output using "/tmp/tmp.2aq9pdpFHp", write text replace

. . file write output "success" 

. . file close output

. 
end of do-file



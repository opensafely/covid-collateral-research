
. cap mkdir ./output/time_series

. * Time series analysis for t1DM, t2DM & keto by ethnicity & IMD
. * Clinical monitoring measures first as these have not been collapsed
. local a "hba1c bp_meas t1_primary t2_primary keto_primary t1_any t2_any keto_
> any"

. forvalues i=1/8 {
  2.     local c: word `i' of `a' 
  3.         local b "ethnicity imd"
  4.         forvalues i=1/2 {
  5.         local d: word `i' of `b'
  6.                 import delimited "./output/measures/dm/measure_dm_`c'_`d'_
> rate.csv", numericcols(4) clear       //get csv
  7.                 putexcel set ./output/time_series/tsreg_tables_dm, sheet(`
> c'_`d') modify                        //open xlsx
  8.                 * Drop records where ethnicity is missing - no missing IMD
.         drop if `d'==0
  9.                 *Format time
.                 gen temp_date=date(date, "YMD")
 10.                 format temp_date %td
 11.                 gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
 12.                 gen month=mofd(temp_date)
 13.                 format month %tm
 14.                 *Define Seasons
.                 gen season=4
 15.                 replace season = 1 if inrange(month(temp_date),3,5)
 16.                 replace season = 2 if inrange(month(temp_date),6,8)
 17.                 replace season = 3 if inrange(month(temp_date),9,11)
 18.                 label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 
> "Winter"
 19.                 label values season seasonlab
 20.                 drop temp_date
 21.                 *Value to rate per 100k
.                 gen rate = value*100000
 22.                 *Run time series with EWH-robust SE and 1 Lag
.                 tsset `d' month
 23.                 newey rate i.`d'##i.postcovid i.season, lag(1) force
 24.                 *Export results
.                 putexcel E1=("Number of obs") G1=(e(N))
 25.                 putexcel E2=("F") G2=(e(F))
 26.                 putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F))
> )
 27.                 matrix a = r(table)'
 28.                 putexcel A6 = matrix(a), rownames
 29.                 putexcel save
 30.                 quietly margins `d'##postcovid
 31.         marginsplot
 32.         graph export ./output/time_series/margins_dm_`c'_`d'.svg, as(svg) 
> replace
 33.                 import excel using ./output/time_series/tsreg_tables_dm.xl
> sx, sheet (`c'_`d') clear
 34.         export delimited using ./output/time_series/tsreg_dm_`c'_`d'.csv, 
> replace
 35.                 }
 36.         }
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.57
                                                Prob > F          =     0.8622

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -434.9961   493.6113    -0.88   0.379    -1407.759    537.7673
          3  |  -121.2403   522.5692    -0.23   0.817    -1151.071    908.5906
          4  |    -577.18   476.7262    -1.21   0.227    -1516.668    362.3078
          5  |  -463.2565   554.4593    -0.84   0.404    -1555.933    629.4205
             |
 1.postcovid |  -890.3037   629.4274    -1.41   0.159    -2130.721    350.1135
             |
   ethnicity#|
   postcovid |
        2 1  |    773.917   804.2015     0.96   0.337    -810.9288    2358.763
        3 1  |   1229.193   825.1563     1.49   0.138    -396.9488    2855.335
        4 1  |   892.3344   862.1948     1.03   0.302    -806.7992    2591.468
        5 1  |   1402.554   876.8754     1.60   0.111    -325.5108    3130.619
             |
      season |
     Summer  |   20.88747   388.3054     0.05   0.957    -744.3489    786.1238
     Autumn  |  -7.463795   381.8147    -0.02   0.984    -759.9089    744.9813
     Winter  |  -7.509664   386.4463    -0.02   0.985    -769.0822    754.0628
             |
       _cons |    10333.6   435.1004    23.75   0.000     9476.144    11191.06
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_hba1c_ethnicity.svg not found)
(file ./output/time_series/margins_dm_hba1c_ethnicity.svg written in SVG format
> )
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_hba1c_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_hba1c_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.19
                                                Prob > F          =     0.9986

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -178.1186   622.0638    -0.29   0.775    -1404.024    1047.787
          3  |   73.56311   640.3241     0.11   0.909    -1188.328    1335.455
          4  |   335.5898   610.7635     0.55   0.583    -868.0464    1539.226
          5  |   212.6864   646.7067     0.33   0.743    -1061.783    1487.156
             |
 1.postcovid |  -43.57182   731.7684    -0.06   0.953    -1485.673     1398.53
             |
         imd#|
   postcovid |
        2 1  |   483.4685   907.5934     0.53   0.595    -1305.132    2272.069
        3 1  |   188.8301   961.8995     0.20   0.845    -1706.792    2084.453
        4 1  |  -381.3287   876.3277    -0.44   0.664    -2108.314    1345.657
        5 1  |  -300.2483   1027.792    -0.29   0.770    -2325.726    1725.229
             |
      season |
     Summer  |   196.1957   419.5983     0.47   0.641    -630.7098    1023.101
     Autumn  |   69.20018   425.3865     0.16   0.871    -769.1121    907.5125
     Winter  |   171.3576   405.6778     0.42   0.673    -628.1147    970.8299
             |
       _cons |   9819.622   594.4808    16.52   0.000     8648.074    10991.17
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_hba1c_imd.svg not found)
(file ./output/time_series/margins_dm_hba1c_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_hba1c_imd.csv not found)
file ./output/time_series/tsreg_dm_hba1c_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       2.72
                                                Prob > F          =     0.0019

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |   67.08043   379.1686     0.18   0.860    -680.1499    814.3107
          3  |  -1021.745   372.6939    -2.74   0.007    -1756.215   -287.2744
          4  |    -96.855   394.6943    -0.25   0.806     -874.682     680.972
          5  |   543.8314   454.8581     1.20   0.233    -352.5608    1440.224
             |
 1.postcovid |   272.8075   532.9867     0.51   0.609    -777.5533    1323.168
             |
   ethnicity#|
   postcovid |
        2 1  |    255.293   633.3292     0.40   0.687    -992.8135    1503.399
        3 1  |    342.572    710.528     0.48   0.630    -1057.671    1742.815
        4 1  |    -998.45   729.4314    -1.37   0.172    -2435.946    439.0457
        5 1  |  -1060.532   710.4391    -1.49   0.137      -2460.6    339.5352
             |
      season |
     Summer  |  -28.11051   330.7771    -0.08   0.932    -679.9753    623.7543
     Autumn  |  -4.693757   328.2843    -0.01   0.989    -651.6461    642.2586
     Winter  |  -21.15818   328.1477    -0.06   0.949    -667.8412    625.5248
             |
       _cons |   10122.77   360.3401    28.09   0.000      9412.65     10832.9
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_bp_meas_ethnicity.svg not found)
(file ./output/time_series/margins_dm_bp_meas_ethnicity.svg written in SVG form
> at)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_bp_meas_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_bp_meas_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.82
                                                Prob > F          =     0.6265

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |   623.0426   514.0365     1.21   0.227     -389.973    1636.058
          3  |   620.7654   513.8554     1.21   0.228    -391.8933    1633.424
          4  |   1594.901     609.73     2.62   0.010     393.3019    2796.501
          5  |   1073.407   606.9911     1.77   0.078    -122.7953    2269.608
             |
 1.postcovid |   1033.005   555.4362     1.86   0.064    -61.59741    2127.607
             |
         imd#|
   postcovid |
        2 1  |  -1128.397   751.8523    -1.50   0.135    -2610.078    353.2838
        3 1  |  -703.6745   764.6269    -0.92   0.358     -2210.53    803.1814
        4 1  |   -1938.53   816.1915    -2.38   0.018    -3547.005   -330.0552
        5 1  |  -1545.846   777.1756    -1.99   0.048    -3077.432   -14.26021
             |
      season |
     Summer  |    101.318   300.5095     0.34   0.736    -490.8982    693.5342
     Autumn  |   135.4179   351.2453     0.39   0.700    -556.7838    827.6196
     Winter  |    171.437   369.2707     0.46   0.643    -556.2875    899.1614
             |
       _cons |   9156.037   407.0831    22.49   0.000     8353.796    9958.279
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_bp_meas_imd.svg not found)
(file ./output/time_series/margins_dm_bp_meas_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_bp_meas_imd.csv not found)
file ./output/time_series/tsreg_dm_bp_meas_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.85
                                                Prob > F          =     0.5944

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -1732.863   3926.088    -0.44   0.659    -9470.032    6004.307
          3  |   2822.187   4548.028     0.62   0.536    -6140.646    11785.02
          4  |  -1655.082   3902.662    -0.42   0.672    -9346.086    6035.922
          5  |  -6214.375   4278.094    -1.45   0.148    -14645.25    2216.497
             |
 1.postcovid |  -4802.253   3939.213    -1.22   0.224    -12565.29    2960.782
             |
   ethnicity#|
   postcovid |
        2 1  |   6406.767   4815.933     1.33   0.185    -3084.029    15897.56
        3 1  |   825.2595   5687.472     0.15   0.885    -10383.08     12033.6
        4 1  |   8313.055   5613.061     1.48   0.140    -2748.645    19374.76
        5 1  |   9025.163   5401.453     1.67   0.096    -1619.521    19669.85
             |
      season |
     Summer  |   242.2184   2317.578     0.10   0.917    -4325.049    4809.486
     Autumn  |   -317.373    2146.88    -0.15   0.883    -4548.246      3913.5
     Winter  |   1019.861   2682.154     0.38   0.704     -4265.88    6305.602
             |
       _cons |   52142.99   3572.999    14.59   0.000     45101.65    59184.32
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_t1_primary_ethnicity.svg not found)
(file ./output/time_series/margins_dm_t1_primary_ethnicity.svg written in SVG f
> ormat)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_primary_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t1_primary_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.32
                                                Prob > F          =     0.9844

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |   653.5146   3087.842     0.21   0.833    -5431.719    6738.748
          3  |   2181.049   3653.469     0.60   0.551     -5018.87    9380.968
          4  |   3138.439    3684.45     0.85   0.395    -4122.533    10399.41
          5  |   3876.048    3468.87     1.12   0.265    -2960.079    10712.17
             |
 1.postcovid |   1922.153   3071.004     0.63   0.532    -4129.898    7974.204
             |
         imd#|
   postcovid |
        2 1  |    905.289   4161.609     0.22   0.828    -7296.024    9106.602
        3 1  |  -1836.494   5197.344    -0.35   0.724    -12078.94    8405.951
        4 1  |  -4248.769   5060.656    -0.84   0.402    -14221.84    5724.304
        5 1  |  -6146.754   4431.312    -1.39   0.167    -14879.57    2586.065
             |
      season |
     Summer  |   86.44221   2109.012     0.04   0.967    -4069.804    4242.689
     Autumn  |   1093.632   2403.734     0.45   0.650    -3643.424    5830.687
     Winter  |   482.8194   2007.266     0.24   0.810    -3472.914    4438.553
             |
       _cons |   48478.19    2574.96    18.83   0.000      43403.7    53552.69
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_t1_primary_imd.svg not found)
(file ./output/time_series/margins_dm_t1_primary_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_primary_imd.csv not found)
file ./output/time_series/tsreg_dm_t1_primary_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.70
                                                Prob > F          =     0.7471

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -1005.588   656.5255    -1.53   0.127    -2299.408    288.2316
          3  |  -403.6063    658.768    -0.61   0.541    -1701.845    894.6327
          4  |  -1361.374   682.5428    -1.99   0.047    -2706.467   -16.28233
          5  |  -1378.589   632.4113    -2.18   0.030    -2624.886   -132.2912
             |
 1.postcovid |  -1266.248   695.0544    -1.82   0.070    -2635.997    103.5012
             |
   ethnicity#|
   postcovid |
        2 1  |   2004.437   1127.088     1.78   0.077    -216.7233    4225.598
        3 1  |   1007.821   1163.324     0.87   0.387    -1284.751    3300.393
        4 1  |   1725.616   1094.655     1.58   0.116    -431.6293    3882.861
        5 1  |   1881.478   992.1528     1.90   0.059    -73.76504    3836.721
             |
      season |
     Summer  |   6.897588   498.0278     0.01   0.989    -974.5694    988.3646
     Autumn  |   35.74187   518.8527     0.07   0.945     -986.765    1058.249
     Winter  |   .2509646   564.7402     0.00   1.000    -1112.687    1113.189
             |
       _cons |   13299.23   566.0623    23.49   0.000     12183.69    14414.77
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_t2_primary_ethnicity.svg not found)
(file ./output/time_series/margins_dm_t2_primary_ethnicity.svg written in SVG f
> ormat)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_primary_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t2_primary_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.66
                                                Prob > F          =     0.7897

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -341.8939   754.9063    -0.45   0.651    -1829.593    1145.806
          3  |   439.0716    795.426     0.55   0.582     -1128.48    2006.624
          4  |    382.813   728.9116     0.53   0.600    -1053.658    1819.284
          5  |   1027.622   760.7085     1.35   0.178    -471.5117    2526.756
             |
 1.postcovid |   285.4011   791.2316     0.36   0.719    -1273.885    1844.687
             |
         imd#|
   postcovid |
        2 1  |   48.64664   1047.022     0.05   0.963    -2014.728    2112.021
        3 1  |  -903.4048   1022.052    -0.88   0.378    -2917.569     1110.76
        4 1  |  -38.29184   1084.142    -0.04   0.972    -2174.818    2098.235
        5 1  |  -686.7725   1086.157    -0.63   0.528     -2827.27    1453.725
             |
      season |
     Summer  |   18.05362   461.4896     0.04   0.969    -891.4073    927.5146
     Autumn  |   -60.9569   439.8948    -0.14   0.890    -927.8607    805.9469
     Winter  |   38.85796   434.9029     0.09   0.929    -818.2084    895.9243
             |
       _cons |   12247.02   682.0814    17.96   0.000     10902.84     13591.2
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_t2_primary_imd.svg not found)
(file ./output/time_series/margins_dm_t2_primary_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_primary_imd.csv not found)
file ./output/time_series/tsreg_dm_t2_primary_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.55
                                                Prob > F          =     0.1067

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -431.1575   489.7423    -0.88   0.380    -1396.296    533.9812
          3  |   623.2099   564.1881     1.10   0.271    -488.6397     1735.06
          4  |   867.1206    456.245     1.90   0.059    -32.00483    1766.246
          5  |   1004.327   478.5461     2.10   0.037     61.25278    1947.402
             |
 1.postcovid |   693.8676   448.9419     1.55   0.124    -190.8656    1578.601
             |
   ethnicity#|
   postcovid |
        2 1  |  -195.7399   710.2224    -0.28   0.783     -1595.38    1203.901
        3 1  |  -396.3797   741.5012    -0.53   0.593    -1857.662    1064.902
        4 1  |  -1473.674   697.8166    -2.11   0.036    -2848.867   -98.48211
        5 1  |  -1488.457   616.2033    -2.42   0.017    -2702.813   -274.1005
             |
      season |
     Summer  |   61.12951   328.4848     0.19   0.853    -586.2179    708.4769
     Autumn  |   5.581473   294.2725     0.02   0.985    -574.3435    585.5065
     Winter  |  -6.607705   324.7152    -0.02   0.984    -646.5264     633.311
             |
       _cons |   9579.235   370.3517    25.87   0.000      8849.38    10309.09
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_keto_primary_ethnicity.svg not foun
> d)
(file ./output/time_series/margins_dm_keto_primary_ethnicity.svg written in SVG
>  format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_primary_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_keto_primary_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.66
                                                Prob > F          =     0.7906

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -314.9018   546.0036    -0.58   0.565    -1390.915    761.1115
          3  |  -17.08111   552.0163    -0.03   0.975    -1104.944    1070.781
          4  |   743.0803   616.4418     1.21   0.229    -471.7462    1957.907
          5  |   686.6054   512.9311     1.34   0.182    -324.2317    1697.443
             |
 1.postcovid |   264.8675   581.7774     0.46   0.649    -881.6455    1411.381
             |
         imd#|
   postcovid |
        2 1  |   501.2545   835.8255     0.60   0.549    -1145.913    2148.422
        3 1  |   50.73548   822.6924     0.06   0.951    -1570.551    1672.022
        4 1  |  -928.4269   851.8662    -1.09   0.277    -2607.206    750.3521
        5 1  |  -980.6897   706.8486    -1.39   0.167    -2373.682    412.3021
             |
      season |
     Summer  |  -138.7412   382.4335    -0.36   0.717    -892.4057    614.9233
     Autumn  |  -131.9474   357.7331    -0.37   0.713    -836.9346    573.0399
     Winter  |  -101.3367    355.303    -0.29   0.776    -801.5351    598.8616
             |
       _cons |   9822.087   488.1366    20.12   0.000     8860.113    10784.06
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_keto_primary_imd.svg not found)
(file ./output/time_series/margins_dm_keto_primary_imd.svg written in SVG forma
> t)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_primary_imd.csv not found)
file ./output/time_series/tsreg_dm_keto_primary_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       1.25
                                                Prob > F          =     0.2510

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -8339.426   3444.377    -2.42   0.016    -15127.29   -1551.566
          3  |  -4199.582   3622.119    -1.16   0.248    -11337.72    2938.556
          4  |   -1524.66   3669.588    -0.42   0.678    -8756.344    5707.025
          5  |  -4786.304   3312.252    -1.45   0.150    -11313.78    1741.175
             |
 1.postcovid |  -4992.269   3557.509    -1.40   0.162    -12003.08    2018.539
             |
   ethnicity#|
   postcovid |
        2 1  |   7230.583   5021.067     1.44   0.151    -2664.471    17125.64
        3 1  |    3429.91   5147.785     0.67   0.506    -6714.867    13574.69
        4 1  |   4724.597   4703.387     1.00   0.316    -4544.402     13993.6
        5 1  |   10468.38   4708.099     2.22   0.027       1190.1    19746.67
             |
      season |
     Summer  |  -549.2331   2063.877    -0.27   0.790     -4616.53    3518.064
     Autumn  |  -55.71079   1963.881    -0.03   0.977    -3925.945    3814.523
     Winter  |    393.305   2342.572     0.17   0.867    -4223.219    5009.829
             |
       _cons |   54607.96    2930.78    18.63   0.000     48832.25    60383.67
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_t1_any_ethnicity.svg not found)
(file ./output/time_series/margins_dm_t1_any_ethnicity.svg written in SVG forma
> t)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_any_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t1_any_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.75
                                                Prob > F          =     0.6998

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -450.9516   3332.773    -0.14   0.892    -7018.872    6116.969
          3  |   -429.753   3810.261    -0.11   0.910    -7938.662    7079.156
          4  |   623.7028   3699.503     0.17   0.866    -6666.935    7914.341
          5  |   5702.003   3705.926     1.54   0.125    -1601.294     13005.3
             |
 1.postcovid |   3290.895   3394.978     0.97   0.333    -3399.613    9981.402
             |
         imd#|
   postcovid |
        2 1  |  -3043.783   4384.368    -0.69   0.488    -11684.09    5596.524
        3 1  |  -1550.473   4893.984    -0.32   0.752    -11195.08    8094.137
        4 1  |   -1453.53   4735.825    -0.31   0.759    -10786.45    7879.394
        5 1  |  -11159.63   4795.606    -2.33   0.021    -20610.36   -1708.892
             |
      season |
     Summer  |   549.0973   2104.668     0.26   0.794    -3598.588    4696.782
     Autumn  |   1070.191   2053.215     0.52   0.603    -2976.095    5116.478
     Winter  |   889.7389   2241.239     0.40   0.692    -3527.087    5306.565
             |
       _cons |   48958.69   2840.459    17.24   0.000     43360.98     54556.4
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_t1_any_imd.svg not found)
(file ./output/time_series/margins_dm_t1_any_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t1_any_imd.csv not found)
file ./output/time_series/tsreg_dm_t1_any_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.70
                                                Prob > F          =     0.7498

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -988.6448   661.4287    -1.49   0.136    -2292.127    314.8377
          3  |  -1005.042   649.7088    -1.55   0.123    -2285.428     275.344
          4  |  -885.2613   728.6746    -1.21   0.226    -2321.266    550.7431
          5  |  -829.8454   671.0375    -1.24   0.218    -2152.264    492.5731
             |
 1.postcovid |  -773.9905   771.0175    -1.00   0.317     -2293.44    745.4593
             |
   ethnicity#|
   postcovid |
        2 1  |   1172.724   1016.976     1.15   0.250    -831.4369    3176.885
        3 1  |   787.7016   986.8332     0.80   0.426    -1157.058    2732.461
        4 1  |   358.9092    960.627     0.37   0.709    -1534.206    2252.024
        5 1  |   1506.925    975.877     1.54   0.124    -416.2434    3430.093
             |
      season |
     Summer  |   31.33755   405.4584     0.08   0.938    -767.7023    830.3774
     Autumn  |   93.87232   431.0725     0.22   0.828    -755.6454    943.3901
     Winter  |   69.46083   386.4017     0.18   0.858    -692.0238    830.9455
             |
       _cons |   13193.77   572.4957    23.05   0.000     12065.55    14321.99
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_t2_any_ethnicity.svg not found)
(file ./output/time_series/margins_dm_t2_any_ethnicity.svg written in SVG forma
> t)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_any_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_t2_any_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.61
                                                Prob > F          =     0.8357

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |  -196.5112   776.7802    -0.25   0.801    -1727.318    1334.295
          3  |   387.0459   768.1608     0.50   0.615    -1126.774    1900.866
          4  |  -898.4515   805.4638    -1.12   0.266    -2485.785    688.8819
          5  |    324.305   949.4769     0.34   0.733    -1546.836    2195.446
             |
 1.postcovid |  -157.7585   746.6766    -0.21   0.833     -1629.24    1313.723
             |
         imd#|
   postcovid |
        2 1  |   582.8006   1087.235     0.54   0.592    -1559.821    2725.422
        3 1  |  -164.2706   1099.216    -0.15   0.881    -2330.505    2001.963
        4 1  |   1711.515   1312.795     1.30   0.194    -875.6195     4298.65
        5 1  |  -1148.814    1192.95    -0.96   0.337    -3499.769     1202.14
             |
      season |
     Summer  |   -77.5399    465.941    -0.17   0.868    -995.7733    840.6935
     Autumn  |  -55.65389    519.064    -0.11   0.915    -1078.577    967.2694
     Winter  |   71.66579   621.6599     0.12   0.908    -1153.444    1296.776
             |
       _cons |   12497.12   621.3682    20.11   0.000     11272.58    13721.65
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_t2_any_imd.svg not found)
(file ./output/time_series/margins_dm_t2_any_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_t2_any_imd.csv not found)
file ./output/time_series/tsreg_dm_t2_any_imd.csv saved
(5 vars, 235 obs)
(0 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.41
                                                Prob > F          =     0.9596

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   ethnicity |
          2  |  -464.0736   639.7122    -0.73   0.469    -1724.759     796.612
          3  |   288.1745   549.4519     0.52   0.600    -794.6344    1370.983
          4  |   528.2255   627.8066     0.84   0.401    -708.9977    1765.449
          5  |   98.68143   578.8494     0.17   0.865    -1042.061    1239.424
             |
 1.postcovid |   129.8232   545.8727     0.24   0.812    -945.9321    1205.578
             |
   ethnicity#|
   postcovid |
        2 1  |   116.1378   769.7166     0.15   0.880    -1400.748    1633.024
        3 1  |  -180.8021   711.2629    -0.25   0.800    -1582.493    1220.889
        4 1  |  -585.7598   795.8701    -0.74   0.463    -2154.187    982.6672
        5 1  |  -135.5337   750.2527    -0.18   0.857    -1614.062    1342.995
             |
      season |
     Summer  |   -25.0061   341.7262    -0.07   0.942    -698.4484    648.4362
     Autumn  |  -25.10164   362.7807    -0.07   0.945    -740.0363     689.833
     Winter  |  -11.63309   359.9302    -0.03   0.974    -720.9502     697.684
             |
       _cons |   9937.364   464.8073    21.38   0.000     9021.365    10853.36
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: ethnicity postcovid
(note: file ./output/time_series/margins_dm_keto_any_ethnicity.svg not found)
(file ./output/time_series/margins_dm_keto_any_ethnicity.svg written in SVG for
> mat)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_any_ethnicity.csv not found)
file ./output/time_series/tsreg_dm_keto_any_ethnicity.csv saved
(5 vars, 282 obs)
(47 observations deleted)
(60 real changes made)
(60 real changes made)
(60 real changes made)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        235
maximum lag: 1                                  F( 12,       222) =       0.87
                                                Prob > F          =     0.5754

------------------------------------------------------------------------------
             |             Newey-West
        rate |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         imd |
          2  |   624.8809   417.4081     1.50   0.136    -197.7083     1447.47
          3  |     1072.8   487.4835     2.20   0.029      112.113    2033.488
          4  |   1468.068   527.9422     2.78   0.006      427.648    2508.487
          5  |   593.2816   528.9617     1.12   0.263    -449.1471     1635.71
             |
 1.postcovid |   916.0579    530.692     1.73   0.086    -129.7807    1961.897
             |
         imd#|
   postcovid |
        2 1  |  -813.4746   719.1653    -1.13   0.259    -2230.739    603.7898
        3 1  |  -1088.546   717.2888    -1.52   0.131    -2502.112    325.0202
        4 1  |  -1597.185   779.5677    -2.05   0.042    -3133.485   -60.88501
        5 1  |  -815.6221   838.8542    -0.97   0.332    -2468.758    837.5141
             |
      season |
     Summer  |   76.09322   358.0255     0.21   0.832    -629.4703    781.6567
     Autumn  |  -136.7148   392.9669    -0.35   0.728    -911.1376    637.7079
     Winter  |  -31.53165   367.9177    -0.09   0.932    -756.5897    693.5264
             |
       _cons |   9273.996   415.4707    22.32   0.000     8455.224    10092.77
------------------------------------------------------------------------------
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved
file ./output/time_series/tsreg_tables_dm.xlsx saved

  Variables that uniquely identify margins: imd postcovid
(note: file ./output/time_series/margins_dm_keto_any_imd.svg not found)
(file ./output/time_series/margins_dm_keto_any_imd.svg written in SVG format)
(10 vars, 27 obs)
(note: file ./output/time_series/tsreg_dm_keto_any_imd.csv not found)
file ./output/time_series/tsreg_dm_keto_any_imd.csv saved

. 
. /* hospitalisations collapsed to 3 monthly for ethnicity
> foreach var in t1_primary t1_any t2_primary t2_any keto_primary keto_any {
>         import delimited ./output/measures/dm/collapse_measure_dm_`var'_ethni
> city_rate.csv, numericcols(2) clear        //get csv
>         putexcel set ./output/time_series/tsreg_tables_dm, sheet(`var'_ethnic
> ity) modify                        //open xlsx
>         *Format time
>         gen temp_date=date(date, "DM20Y")
>         format temp_date %td
>         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
>         gen quarter=qofd(temp_date)
>         format quarter %tq
>         /*Define Seasons - not needed as collinarity with quarter
>         gen season=4
>         replace season = 1 if inrange(month(temp_date),3,5)
>         replace season = 2 if inrange(month(temp_date),6,8)
>         replace season = 3 if inrange(month(temp_date),9,11)
>         label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 "Winter"
>         label values season seasonlab*/
>         drop temp_date
>         *Run time series with EWH-robust SE and 1 Lag
>         tsset ethnicity quarter
>         newey rate i.ethnicity##i.postcovid, lag(1) force
>         *Export results
>         putexcel E1=("Number of obs") G1=(e(N))
>         putexcel E2=("F") G2=(e(F))
>         putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F)))
>         matrix a = r(table)'
>         putexcel A6 = matrix(a), rownames
>         putexcel save
>         }
> 
> * hospitalisations monthly by IMD
> foreach var in t1_primary t1_any t2_primary t2_any keto_primary keto_any {
>         import delimited ./output/measures/dm/measure_dm_`var'_imd_rate.csv, 
> numericcols(4) clear       //get csv
>         putexcel set ./output/time_series/tsreg_tables_dm, sheet(`var'_imd) m
> odify                      //open xlsx
>         *Format time
>         gen temp_date=date(date, "YMD")
>         format temp_date %td
>         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
>         gen month=mofd(temp_date)
>         format month %tm
>         *Define Seasons
>         gen season=4
>         replace season = 1 if inrange(month(temp_date),3,5)
>         replace season = 2 if inrange(month(temp_date),6,8)
>         replace season = 3 if inrange(month(temp_date),9,11)
>         label define seasonlab 1 "Spring" 2 "Summer" 3 "Autumn" 4 "Winter"
>         label values season seasonlab
>         drop temp_date
>         *Value to rate per 100k
>         gen rate = value*100000
>         *Run time series with EWH-robust SE and 1 Lag
>         tsset imd month
>         newey rate i.imd##i.postcovid i.season, lag(1) force
>         *Export results
>         putexcel E1=("Number of obs") G1=(e(N))
>         putexcel E2=("F") G2=(e(F))
>         putexcel E3=("Prob > F") G3=(Ftail(e(df_m), e(df_r), e(F)))
>         matrix a = r(table)'
>         putexcel A6 = matrix(a), rownames
>         putexcel save
>         }
> 
> log close

end of do-file

. . file open output using "/tmp/tmp.DD7VzsOy73", write text replace

. . file write output "success" 

. . file close output

. 
end of do-file



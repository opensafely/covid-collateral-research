
. cap mkdir ./output/graphs

. cap mkdir ./output/tempdata

. cap mkdir ./output/tables

. 
. * open file to write results to
. file open tablecontent using ./output/tables/`outcome'_cox_models.txt, write 
> text replace
(note: file ./output/tables/dm_keto_cox_models.txt not found)

. file write tablecontent ("Period") _tab ("Denominator") _tab ("Events") _tab 
> ("Total person-weeks") _tab ("Rate per 1000") _tab ("Crude HR") _tab _tab ("A
> ge/Sex Adjusted") _tab _tab ("Fully Adjusted") _tab _tab  _n

. file write tablecontent _tab _tab _tab _tab _tab _tab _tab   ("HR") _tab ("95
> % CI") _tab ("HR") _tab ("95% CI") _tab ("HR") _tab ("95% CI") _tab _tab  _n

. 
. foreach period in pre pandemic wave1 easing1 wave2 easing2 wave3 easing3 {
  2. use ./output/prep_survival_`period', clear
  3. 
.     * Drop events that occur on index date
.     drop if `outcome'_admit_date==index_date
  4.     * Cox model for each outcome category
.     * Generate flags and end dates for each outcome
.     gen `outcome'_admit=(`outcome'_admit_date!=.)
  5.     tab `outcome'_admit
  6.     count if `outcome'_admit_date!=.
  7.     if r(N) > 10 {
  8.         gen `outcome'_end = end_date
  9.         replace `outcome'_end = `outcome'_admit_date if `outcome'_admit==1
 10. 
.         stset `outcome'_end, fail(`outcome'_admit) id(patient_id) enter(index
> _date) origin(index_date) scale(365.25) 
 11.         * Kaplan-Meier plot
.         sts graph, by(eth5) ylabel(.75(.05)1)
 12.         graph export ./output/graphs/km_`outcome'_`period'_eth.svg, as(svg
> ) replace
 13.         * Cox model - crude
.         stcox i.eth5
 14.         estimates save "./output/tempdata/crude_`outcome'_eth", replace 
 15.         eststo model1
 16.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'_eth", replace) idstr("crude_`outcome'_eth") 
 17.         estat phtest, detail
 18.         * Cox model - age and gender adjusted
.         stcox i.eth5 i.age_cat i.male
 19.         estimates save "./output/tempdata/model1_`outcome'_eth", replace 
 20.         eststo model2
 21.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model1_`outcome'_eth", replace) idstr("model1_`outcome'_eth") 
 22.         estat phtest, detail
 23.         * Cox model - fully adjusted
.         stcox i.eth5 i.age_cat i.male i.urban_rural_bin i.imd i.shielded
 24.         estimates save "./output/tempdata/model2_`outcome'_eth", replace 
 25.         eststo model3
 26.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model2_`outcome'_eth", replace) idstr("model2_`outcome'_eth") 
 27.         estat phtest, detail
 28.         esttab model1 model2 model3 using "./output/tables/`outcome'_estou
> t_table_eth_`period'.txt", b(a2) ci(2) label wide compress eform ///
>         title ("`outcome'") ///
>         varlabels(`e(labels)') ///
>         stats(N_outcome) ///
>         append 
 29.         eststo clear
 30.     * Write results to table
.         * eth16 labelled columns
. 
.         local lab1: label eth5 1
 31.         local lab2: label eth5 2
 32.         local lab3: label eth5 3
 33.         local lab4: label eth5 4
 34.         local lab5: label eth5 5
 35.         /* counts */
.         
.         * First row, eth16 = 1 (White British) reference cat
.         qui safecount if eth5==1
 36.         local denominator = r(N)
 37.         qui safecount if eth5 == 1 & `outcome'_admit == 1
 38.         local event = r(N)
 39.         bysort eth5: egen total_follow_up = total(_t)
 40.         qui su total_follow_up if eth5 == 1
 41.         local person_week = r(mean)/7
 42.         local rate = 1000*(`event'/`person_week')
 43.         
.         file write tablecontent  ("`period'") _tab ("`lab1'") _tab (`denomina
> tor') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate') _tab
 44.         file write tablecontent ("1.00") _tab _tab ("1.00") _tab _tab ("1.
> 00") _n
 45. 
.     * outcomesequent ethnic groups
.         forvalues eth=2/5 {
 46.             qui safecount if eth5==`eth'
 47.             local denominator = r(N)
 48.             qui safecount if eth5 == `eth' & `outcome'_admit == 1
 49.             local event = r(N)
 50.             qui su total_follow_up if eth5 == `eth'
 51.             local person_week = r(mean)/7
 52.             local rate = 1000*(`event'/`person_week')
 53.             file write tablecontent ("`period'") _tab ("`lab`eth''") _tab 
> (`denominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate'
> ) _tab  
 54.             cap estimates use "./output/tempdata/crude_`outcome'_eth" 
 55.             cap lincom `eth'.eth5, eform
 56.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 57.             cap estimates clear
 58.             cap estimates use "./output/tempdata/model1_`outcome'_eth" 
 59.             cap lincom `eth'.eth5, eform
 60.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 61.             cap estimates clear
 62.             cap estimates use "./output/tempdata/model2_`outcome'_eth" 
 63.             cap lincom `eth'.eth5, eform
 64.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab _n
 65.             cap estimates clear
 66.         }  //end ethnic group
 67. drop total_follow_up
 68.     }
 69. else { 
 70.     continue
 71. }
 72. } //end outcomes
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        974       97.40       97.40
          1 |         26        2.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  26
(26 real changes made)

                id:  patient_id
     failure event:  dm_keto_admit != 0 & dm_keto_admit < .
obs. time interval:  (dm_keto_end[_n-1], dm_keto_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)/365.25
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          0  exclusions
------------------------------------------------------------------------------
      1,000  observations remaining, representing
      1,000  subjects
         26  failures in single-failure-per-subject data
  2,035.233  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  2.058864

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_dm_keto_pre_eth.svg not found)
(file ./output/graphs/km_dm_keto_pre_eth.svg written in SVG format)

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -179.27484
Iteration 1:   log likelihood = -176.84748
Iteration 2:   log likelihood = -176.80643
Iteration 3:   log likelihood =  -176.8064
Refining estimates:
Iteration 0:   log likelihood =  -176.8064

Cox regression -- Breslow method for ties

No. of subjects =        1,000                  Number of obs    =       1,000
No. of failures =           26
Time at risk    =  2035.233402
                                                LR chi2(4)       =        4.94
Log likelihood  =    -176.8064                  Prob > chi2      =      0.2938

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .3862315   .2731073    -1.35   0.179     .0965954    1.544326
      Black  |   .7004541   .4241468    -0.59   0.557     .2137719    2.295138
      Mixed  |   1.164241   .6136103     0.29   0.773     .4143995    3.270894
      Other  |   .4133139   .2922574    -1.25   0.211     .1033687    1.652612
------------------------------------------------------------------------------
(note: file ./output/tempdata/crude_dm_keto_eth.ster not found)
file ./output/tempdata/crude_dm_keto_eth.ster saved
(note: file ./output/tempdata/surv_crude_dm_keto_eth.dta not found)
file ./output/tempdata/surv_crude_dm_keto_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.10542         0.29        1         0.5910
      3.eth5      |      0.03537         0.03        1         0.8570
      4.eth5      |      0.08755         0.20        1         0.6556
      5.eth5      |      0.06378         0.11        1         0.7452
      ------------+---------------------------------------------------
      global test |                      0.37        4         0.9846
      ----------------------------------------------------------------

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -146.48961
Iteration 1:   log likelihood = -144.46504
Iteration 2:   log likelihood =  -144.4286
Iteration 3:   log likelihood = -144.42859
Refining estimates:
Iteration 0:   log likelihood = -144.42859

Cox regression -- Breslow method for ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           22
Time at risk    =  1605.765914
                                                LR chi2(8)       =        4.12
Log likelihood  =   -144.42859                  Prob > chi2      =      0.8459

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .3709905   .2628263    -1.40   0.162     .0925408    1.487278
      Black  |   .5515039    .357543    -0.92   0.359     .1547782    1.965112
      Mixed  |   .7721754   .4488332    -0.44   0.656     .2471429    2.412591
      Other  |   .3940313   .2795996    -1.31   0.189     .0980684    1.583188
             |
     age_cat |
41 - 60 y..  |   1.613576   .8513166     0.91   0.364     .5737181    4.538163
61 - 80 y..  |   1.528816   .8850394     0.73   0.463     .4915758    4.754667
  >80 years  |   1.194059   1.290857     0.16   0.870     .1434897     9.93644
             |
        male |
       Male  |    1.01007   .4347543     0.02   0.981     .4344878    2.348149
------------------------------------------------------------------------------
(note: file ./output/tempdata/model1_dm_keto_eth.ster not found)
file ./output/tempdata/model1_dm_keto_eth.ster saved
(note: file ./output/tempdata/surv_model1_dm_keto_eth.dta not found)
file ./output/tempdata/surv_model1_dm_keto_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.10658         0.25        1         0.6185
      3.eth5      |     -0.08011         0.15        1         0.7020
      4.eth5      |      0.05073         0.06        1         0.8098
      5.eth5      |      0.06881         0.11        1         0.7434
      0b.age_cat  |            .            .        1             .
      1.age_cat   |     -0.00254         0.00        1         0.9905
      2.age_cat   |     -0.15539         0.54        1         0.4617
      3.age_cat   |      0.24930         1.37        1         0.2426
      0b.male     |            .            .        1             .
      1.male      |      0.18614         0.78        1         0.3765
      ------------+---------------------------------------------------
      global test |                      4.18        8         0.8401
      ----------------------------------------------------------------

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -146.48961
Iteration 1:   log likelihood =  -143.4004
Iteration 2:   log likelihood = -141.82854
Iteration 3:   log likelihood = -141.64473
Iteration 4:   log likelihood =  -141.6373
Iteration 5:   log likelihood = -141.63728
Refining estimates:
Iteration 0:   log likelihood = -141.63728

Cox regression -- Breslow method for ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           22
Time at risk    =  1605.765914
                                                LR chi2(15)      =        9.70
Log likelihood  =   -141.63728                  Prob > chi2      =      0.8379

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .3797484   .2702011    -1.36   0.174      .094155    1.531611
      Black  |   .5576921   .3637655    -0.90   0.371     .1553037     2.00266
      Mixed  |   .7274751   .4246259    -0.55   0.586     .2317252    2.283826
      Other  |   .3742141   .2666879    -1.38   0.168     .0925767    1.512651
             |
     age_cat |
41 - 60 y..  |   1.706595   .9073054     1.01   0.315      .601994    4.838033
61 - 80 y..  |    1.66305   .9733468     0.87   0.385     .5280991    5.237149
  >80 years  |   1.560137   1.710411     0.41   0.685     .1819586    13.37682
             |
        male |
       Male  |   .9790687   .4222942    -0.05   0.961     .4204079    2.280108
             |
urban_rura~n |
      Urban  |   .5531358   .2664926    -1.23   0.219     .2151471    1.422093
             |
         imd |
          1  |   .3201928   .2980708    -1.22   0.221     .0516439    1.985199
          2  |   .2847839   .2638733    -1.36   0.175     .0463249    1.750719
          3  |   .6243954   .5294707    -0.56   0.579      .118485    3.290456
          4  |    .428196   .3751893    -0.97   0.333     .0768797    2.384917
          5  |   .5930742    .499689    -0.62   0.535     .1137463    3.092294
             |
  1.shielded |   4.690136   4.959813     1.46   0.144     .5902568    37.26747
------------------------------------------------------------------------------
(note: file ./output/tempdata/model2_dm_keto_eth.ster not found)
file ./output/tempdata/model2_dm_keto_eth.ster saved
(note: file ./output/tempdata/surv_model2_dm_keto_eth.dta not found)
file ./output/tempdata/surv_model2_dm_keto_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.11706         0.29        1         0.5907
      3.eth5      |     -0.07024         0.11        1         0.7444
      4.eth5      |      0.02476         0.01        1         0.9080
      5.eth5      |      0.05685         0.07        1         0.7863
      0b.age_cat  |            .            .        1             .
      1.age_cat   |     -0.01218         0.00        1         0.9528
      2.age_cat   |     -0.14120         0.47        1         0.4944
      3.age_cat   |      0.25235         1.38        1         0.2400
      0b.male     |            .            .        1             .
      1.male      |      0.18082         0.72        1         0.3969
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.08649         0.17        1         0.6822
      0b.imd      |            .            .        1             .
      1.imd       |     -0.06085         0.08        1         0.7771
      2.imd       |      0.20411         0.94        1         0.3317
      3.imd       |      0.03785         0.03        1         0.8559
      4.imd       |      0.08176         0.13        1         0.7173
      5.imd       |     -0.10051         0.22        1         0.6407
      0b.shielded |            .            .        1             .
      1.shielded  |      0.24920         1.27        1         0.2590
      ------------+---------------------------------------------------
      global test |                     10.08       15         0.8145
      ----------------------------------------------------------------
(note: file ./output/tables/dm_keto_estout_table_eth_pre.txt not found)
(output written to ./output/tables/dm_keto_estout_table_eth_pre.txt)
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        981       98.10       98.10
          1 |         19        1.90      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  19
(19 real changes made)

                id:  patient_id
     failure event:  dm_keto_admit != 0 & dm_keto_admit < .
obs. time interval:  (dm_keto_end[_n-1], dm_keto_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)/365.25
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
        999  observations remaining, representing
        999  subjects
         19  failures in single-failure-per-subject data
  1,981.262  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  2.102669

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_dm_keto_pandemic_eth.svg not found)
(file ./output/graphs/km_dm_keto_pandemic_eth.svg written in SVG format)

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -130.18054
Iteration 1:   log likelihood = -129.95224
Iteration 2:   log likelihood = -129.95109
Iteration 3:   log likelihood = -129.95109
Refining estimates:
Iteration 0:   log likelihood = -129.95109

Cox regression -- Breslow method for ties

No. of subjects =          999                  Number of obs    =         999
No. of failures =           19
Time at risk    =  1981.262149
                                                LR chi2(4)       =        0.46
Log likelihood  =   -129.95109                  Prob > chi2      =      0.9774

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |    1.17889   .7908271     0.25   0.806     .3165681    4.390149
      Black  |   .9424292   .6664059    -0.08   0.933     .2356955    3.768306
      Mixed  |   .8136395    .621429    -0.27   0.787     .1821019    3.635378
      Other  |   .7627089   .5825312    -0.35   0.723     .1707026    3.407828
------------------------------------------------------------------------------
file ./output/tempdata/crude_dm_keto_eth.ster saved
file ./output/tempdata/surv_crude_dm_keto_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.21010         0.84        1         0.3601
      3.eth5      |     -0.06433         0.08        1         0.7793
      4.eth5      |      0.24556         1.14        1         0.2849
      5.eth5      |     -0.26820         1.37        1         0.2422
      ------------+---------------------------------------------------
      global test |                      5.55        4         0.2350
      ----------------------------------------------------------------

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -85.859931
Iteration 1:   log likelihood = -83.600387
Iteration 2:   log likelihood = -83.405399
Iteration 3:   log likelihood = -83.338884
Iteration 4:   log likelihood =   -83.3146
Iteration 5:   log likelihood = -83.305692
Iteration 6:   log likelihood = -83.302418
Iteration 7:   log likelihood = -83.301214
Iteration 8:   log likelihood = -83.300771
Iteration 9:   log likelihood = -83.300608
Iteration 10:  log likelihood = -83.300548
Iteration 11:  log likelihood = -83.300526
Iteration 12:  log likelihood = -83.300518
Iteration 13:  log likelihood = -83.300515
Iteration 14:  log likelihood = -83.300514
Iteration 15:  log likelihood = -83.300513
Iteration 16:  log likelihood = -83.300513
Iteration 17:  log likelihood = -83.300513
Iteration 18:  log likelihood = -83.300513
Iteration 19:  log likelihood = -83.300513
Iteration 20:  log likelihood = -83.300513
Iteration 21:  log likelihood = -83.300513
Iteration 22:  log likelihood = -83.300513
Iteration 23:  log likelihood = -83.300513
Iteration 24:  log likelihood = -83.300513
Iteration 25:  log likelihood = -83.300513
Iteration 26:  log likelihood = -83.300513
Iteration 27:  log likelihood = -83.300513
Iteration 28:  log likelihood = -83.300513
Iteration 29:  log likelihood = -83.300513
Iteration 30:  log likelihood = -83.300513
Iteration 31:  log likelihood = -83.300513
Iteration 32:  log likelihood = -83.300513
Iteration 33:  log likelihood = -83.300513
Iteration 34:  log likelihood = -83.300513
Iteration 35:  log likelihood = -83.300513
Refining estimates:
Iteration 0:   log likelihood = -83.300513
Iteration 1:   log likelihood = -83.300513

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           13
Time at risk    =  1553.702943
                                                LR chi2(8)       =        5.12
Log likelihood  =   -83.300513                  Prob > chi2      =      0.7448

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.367226   1.045221     0.41   0.682     .3055701    6.117436
      Black  |   .6316616   .5770356    -0.50   0.615     .1054131    3.785073
      Mixed  |   .7733535   .7069513    -0.28   0.779      .128903    4.639735
      Other  |   .6984762   .6398339    -0.39   0.695     .1159885    4.206185
             |
     age_cat |
41 - 60 y..  |    .975321   .6193601    -0.04   0.969     .2809359    3.386007
61 - 80 y..  |   .9335442   .6833854    -0.09   0.925     .2223448    3.919609
  >80 years  |   1.90e-16   1.43e-08    -0.00   1.000            0           .
             |
        male |
       Male  |   2.392003   1.440074     1.45   0.147     .7350337    7.784241
------------------------------------------------------------------------------
file ./output/tempdata/model1_dm_keto_eth.ster saved
file ./output/tempdata/surv_model1_dm_keto_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.31306         1.29        1         0.2566
      3.eth5      |     -0.33466         1.48        1         0.2232
      4.eth5      |      0.15050         0.28        1         0.5953
      5.eth5      |     -0.27598         0.99        1         0.3190
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.14110         0.24        1         0.6218
      2.age_cat   |      0.51472         3.39        1         0.0655
      3.age_cat   |      0.30703         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.34889         1.55        1         0.2134
      ------------+---------------------------------------------------
      global test |                      9.27        8         0.3199
      ----------------------------------------------------------------

         failure _d:  dm_keto_admit
   analysis time _t:  (dm_keto_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -85.859931
Iteration 1:   log likelihood = -81.080231
Iteration 2:   log likelihood = -80.682227
Iteration 3:   log likelihood = -80.555125
Iteration 4:   log likelihood = -80.508771
Iteration 5:   log likelihood = -80.491768
Iteration 6:   log likelihood = -80.485519
Iteration 7:   log likelihood = -80.483221
Iteration 8:   log likelihood = -80.482376
Iteration 9:   log likelihood = -80.482065
Iteration 10:  log likelihood =  -80.48195
Iteration 11:  log likelihood = -80.481908
Iteration 12:  log likelihood = -80.481893
Iteration 13:  log likelihood = -80.481887
Iteration 14:  log likelihood = -80.481885
Iteration 15:  log likelihood = -80.481884
Iteration 16:  log likelihood = -80.481884
Iteration 17:  log likelihood = -80.481884
Iteration 18:  log likelihood = -80.481884
Iteration 19:  log likelihood = -80.481884
Iteration 20:  log likelihood = -80.481884
Iteration 21:  log likelihood = -80.481884
Iteration 22:  log likelihood = -80.481884
Iteration 23:  log likelihood = -80.481884
Iteration 24:  log likelihood = -80.481884
Iteration 25:  log likelihood = -80.481884
Iteration 26:  log likelihood = -80.481884
Iteration 27:  log likelihood = -80.481884
Iteration 28:  log likelihood = -80.481884
Iteration 29:  log likelihood = -80.481884
Iteration 30:  log likelihood = -80.481884
Iteration 31:  log likelihood = -80.481884
Iteration 32:  log likelihood = -80.481884
Iteration 33:  log likelihood = -80.481884
Refining estimates:
Iteration 0:   log likelihood = -80.481884
Iteration 1:   log likelihood = -80.481884
Iteration 2:   log likelihood = -80.481884
Iteration 3:   log likelihood = -80.481884
Iteration 4:   log likelihood = -80.481884
Iteration 5:   log likelihood = -80.481884
Iteration 6:   log likelihood = -80.481884
Iteration 7:   log likelihood = -80.481884

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           13
Time at risk    =  1553.702943
                                                LR chi2(14)      =       10.76
Log likelihood  =   -80.481884                  Prob > chi2      =      0.7051

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.417087   1.093101     0.45   0.651     .3124666    6.426722
      Black  |   .5518936   .5063883    -0.65   0.517     .0913772    3.333288
      Mixed  |   .7311521   .6735644    -0.34   0.734     .1201847    4.448014
      Other  |   .6988748   .6450723    -0.39   0.698     .1144793      4.2665
             |
     age_cat |
41 - 60 y..  |   .9306638   .5935487    -0.11   0.910     .2666384    3.248351
61 - 80 y..  |   .8255935    .609301    -0.26   0.795     .1943418    3.507247
  >80 years  |   2.90e-18   1.67e-09    -0.00   1.000            0           .
             |
        male |
       Male  |   2.415685   1.463698     1.46   0.145     .7366908    7.921281
             |
urban_rura~n |
      Urban  |   1.572199   .8849889     0.80   0.421     .5216355    4.738576
             |
         imd |
          1  |   6.24e+08          .        .       .            .           .
          2  |   2.71e+09   3.04e+09    19.37   0.000     3.01e+08    2.44e+10
          3  |   1.32e+09   1.62e+09    17.11   0.000     1.19e+08    1.46e+10
          4  |   1.43e+09   1.76e+09    17.14   0.000     1.28e+08    1.59e+10
          5  |   2.90e+09   3.26e+09    19.37   0.000     3.20e+08    2.63e+10
             |
  1.shielded |   3.23e-18   4.80e-09    -0.00   1.000            0           .
------------------------------------------------------------------------------
file ./output/tempdata/model2_dm_keto_eth.ster saved
file ./output/tempdata/surv_model2_dm_keto_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.25534         0.85        1         0.3557
      3.eth5      |     -0.33040         1.43        1         0.2320
      4.eth5      |      0.15381         0.27        1         0.6010
      5.eth5      |     -0.29244         1.09        1         0.2962
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.19483         0.44        1         0.5052
      2.age_cat   |      0.55855         4.05        1         0.0442
      3.age_cat   |      0.25274         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.34719         1.57        1         0.2099
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.34947         1.37        1         0.2425
      0b.imd      |            .            .        1             .
      1.imd       |            .            .        1             .
      2.imd       |     -0.39796         1.93        1         0.1646
      3.imd       |     -0.02680         0.01        1         0.9238
      4.imd       |     -0.14371         0.25        1         0.6143
      5.imd       |     -0.12983         0.20        1         0.6530
      0b.shielded |            .            .        1             .
      1.shielded  |     -0.23294         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                     15.05       14         0.3747
      ----------------------------------------------------------------
(note: file ./output/tables/dm_keto_estout_table_eth_pandemic.txt not found)
(output written to ./output/tables/dm_keto_estout_table_eth_pandemic.txt)
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        997       99.70       99.70
          1 |          3        0.30      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  3
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        998       99.80       99.80
          1 |          2        0.20      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  2
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        992       99.20       99.20
          1 |          8        0.80      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  8
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        999       99.90       99.90
          1 |          1        0.10      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  1
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        996       99.60       99.60
          1 |          4        0.40      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  4
(0 observations deleted)

dm_keto_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        994       99.40       99.40
          1 |          6        0.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  6

. file close tablecontent

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/cox_model_dm_keto.log
  log type:  text
 closed on:   6 Jul 2022, 14:17:10
-------------------------------------------------------------------------------

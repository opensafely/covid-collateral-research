
. cap mkdir ./output/time_series

. 
. *Respiratory outcomes:
. *Clinical monitoring for asthma & copd and hospital admissions for copd exace
> rbation - 
. * both by IMD and ethnicity
. * hospital admissions for asthma exacerbation only by IMD as ethnicity has sm
> all numbers
. foreach var in asthma/*_monitoring*/ copd/*_monitoring*/ /*asthma_exacerbatio
> n copd_exacerbation*/ {
  2.         foreach strata in ethnicity imd {
  3.                 import delimited ./output/measures/resp/measure_`var'_moni
> toring_`strata'_rate.csv, numericcols(4) clear        //get csv
  4.                 putexcel set ./output/time_series/tsreg_tables_resp, sheet
> (`var'_`strata') modify                       //open xlsx
  5.                 * Drop records where ethnicity is missing - no missing IMD
.                 drop if `strata'==0 | `strata'==.
  6.                 drop if has_`var'==0
  7.                 gen temp_date=date(date, "YMD")
  8.                 format temp_date %td
  9.                 gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
 10.                 gen month=mofd(temp_date)
 11.                 format month %tm
 12.                 drop temp_date
 13.                 *Value to rate per 100k
.                 gen rate = value*100000
 14.                 *Set time series
.                 tsset `strata' month 
 15.                 *Kernel density plots to check for normality and extreme v
> alues
.                 kdensity rate if `strata'==1, normal name(kd_`strata'_1, repl
> ace)
 16.                 kdensity rate if `strata'==2, normal name(kd_`strata'_2, r
> eplace)
 17.                 kdensity rate if `strata'==3, normal name(kd_`strata'_3, r
> eplace)
 18.                 kdensity rate if `strata'==4, normal name(kd_`strata'_4, r
> eplace)
 19.                 kdensity rate if `strata'==5, normal name(kd_`strata'_5, r
> eplace)
 20.                 *Autoregression plots by ethnicity
.                 ac rate if `strata'==1, name(ac_`strata'_1, replace)
 21.                 ac rate if `strata'==2, name(ac_`strata'_2, replace)
 22.                 ac rate if `strata'==3, name(ac_`strata'_3, replace)
 23.                 ac rate if `strata'==4, name(ac_`strata'_4, replace)
 24.                 ac rate if `strata'==5, name(ac_`strata'_5, replace)
 25.                 *Partial autoregression plots by ethnicity
.                 pac rate if `strata'==1, name(pac_`strata'_1, replace)
 26.                 pac rate if `strata'==2, name(pac_`strata'_2, replace)
 27.                 pac rate if `strata'==3, name(pac_`strata'_3, replace)
 28.                 pac rate if `strata'==4, name(pac_`strata'_4, replace)
 29.                 pac rate if `strata'==5, name(pac_`strata'_5, replace)
 30.                 *Combine Graphs
.                 graph combine kd_`strata'_1 kd_`strata'_2 kd_`strata'_3 kd_`s
> trata'_4 kd_`strata'_5, altshrink
 31.                 graph export ./output/time_series/resp_kd_`var'_`strata'.s
> vg, as(svg) replace
 32.                 graph combine ac_`strata'_1 ac_`strata'_2 ac_`strata'_3 ac
> _`strata'_4 ac_`strata'_5, altshrink
 33.                 graph export ./output/time_series/resp_ac_`var'_`strata'.s
> vg, as(svg) replace
 34.                 graph combine pac_`strata'_1 pac_`strata'_2 pac_`strata'_3
>  pac_`strata'_4 pac_`strata'_5, altshrink
 35.                 graph export ./output/time_series/resp_pac_`var'_`strata'.
> svg, as(svg) replace
 36.         }
 37. }       
(6 vars, 500 obs)
(0 observations deleted)
(250 observations deleted)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month
(note: file ./output/time_series/resp_kd_asthma_ethnicity.svg not found)
(file ./output/time_series/resp_kd_asthma_ethnicity.svg written in SVG format)
(note: file ./output/time_series/resp_ac_asthma_ethnicity.svg not found)
(file ./output/time_series/resp_ac_asthma_ethnicity.svg written in SVG format)
(note: file ./output/time_series/resp_pac_asthma_ethnicity.svg not found)
(file ./output/time_series/resp_pac_asthma_ethnicity.svg written in SVG format)
(6 vars, 600 obs)
(100 observations deleted)
(250 observations deleted)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month
(note: file ./output/time_series/resp_kd_asthma_imd.svg not found)
(file ./output/time_series/resp_kd_asthma_imd.svg written in SVG format)
(note: file ./output/time_series/resp_ac_asthma_imd.svg not found)
(file ./output/time_series/resp_ac_asthma_imd.svg written in SVG format)
(note: file ./output/time_series/resp_pac_asthma_imd.svg not found)
(file ./output/time_series/resp_pac_asthma_imd.svg written in SVG format)
(6 vars, 500 obs)
(0 observations deleted)
(250 observations deleted)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month
(note: file ./output/time_series/resp_kd_copd_ethnicity.svg not found)
(file ./output/time_series/resp_kd_copd_ethnicity.svg written in SVG format)
(note: file ./output/time_series/resp_ac_copd_ethnicity.svg not found)
(file ./output/time_series/resp_ac_copd_ethnicity.svg written in SVG format)
(note: file ./output/time_series/resp_pac_copd_ethnicity.svg not found)
(file ./output/time_series/resp_pac_copd_ethnicity.svg written in SVG format)
(6 vars, 600 obs)
(100 observations deleted)
(250 observations deleted)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m4
                delta:  1 month
(note: file ./output/time_series/resp_kd_copd_imd.svg not found)
(file ./output/time_series/resp_kd_copd_imd.svg written in SVG format)
(note: file ./output/time_series/resp_ac_copd_imd.svg not found)
(file ./output/time_series/resp_ac_copd_imd.svg written in SVG format)
(note: file ./output/time_series/resp_pac_copd_imd.svg not found)
(file ./output/time_series/resp_pac_copd_imd.svg written in SVG format)

. 
.         
. log close
      name:  <unnamed>
       log:  /workspace/logs/model_checks_resp.log
  log type:  text
 closed on:  22 Feb 2023, 09:43:15
-------------------------------------------------------------------------------

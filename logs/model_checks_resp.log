
. cap mkdir ./output/time_series

. 
. *Respiratory outcomes:
. *Clinical monitoring for asthma & copd and hospital admissions for copd exace
> rbation - 
. * both by IMD and ethnicity
. * hospital admissions for asthma exacerbation only by IMD as ethnicity has sm
> all numbers
. foreach var in asthma_monitoring copd_monitoring asthma_exacerbation copd_exa
> cerbation {
  2.         foreach strata in ethnicity imd {
  3.                 import delimited "./output/measures/resp/measure_`var'_`st
> rata'_rate.csv", numericcols(4) clear //get csv
  4.                 gen temp_date=date(date, "YMD")
  5.                 format temp_date %td
  6.                 gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
  7.                 gen month=mofd(temp_date)
  8.                 format month %tm
  9.                 drop temp_date
 10.                 *Value to rate per 100k
.                 gen rate = value*100000
 11.                 *Set time series
.                 tsset `strata' month 
 12.                 *Kernel density plots to check for normality and extreme v
> alues
.                 kdensity rate if `strata'==1, normal name(kd_`strata'_1, repl
> ace)
 13.                 kdensity rate if `strata'==2, normal name(kd_`strata'_2, r
> eplace)
 14.                 kdensity rate if `strata'==3, normal name(kd_`strata'_3, r
> eplace)
 15.                 kdensity rate if `strata'==4, normal name(kd_`strata'_4, r
> eplace)
 16.                 kdensity rate if `strata'==5, normal name(kd_`strata'_5, r
> eplace)
 17.                 *Autoregression plots by ethnicity
.                 ac rate if `strata'==1, name(ac_`strata'_1, replace)
 18.                 ac rate if `strata'==2, name(ac_`strata'_2, replace)
 19.                 ac rate if `strata'==3, name(ac_`strata'_3, replace)
 20.                 ac rate if `strata'==4, name(ac_`strata'_4, replace)
 21.                 ac rate if `strata'==5, name(ac_`strata'_5, replace)
 22.                 *Partial autoregression plots by ethnicity
.                 pac rate if `strata'==1, name(pac_`strata'_1, replace)
 23.                 pac rate if `strata'==2, name(pac_`strata'_2, replace)
 24.                 pac rate if `strata'==3, name(pac_`strata'_3, replace)
 25.                 pac rate if `strata'==4, name(pac_`strata'_4, replace)
 26.                 pac rate if `strata'==5, name(pac_`strata'_5, replace)
 27.                 *Combine Graphs
.                 graph combine kd_`strata'_1 kd_`strata'_2 kd_`strata'_3 kd_`s
> trata'_4 kd_`strata'_5, altshrink
 28.                 graph export ./output/time_series/resp_kd_`var'_`strata'.s
> vg, as(svg) replace
 29.                 graph combine ac_`strata'_1 ac_`strata'_2 ac_`strata'_3 ac
> _`strata'_4 ac_`strata'_5, altshrink
 30.                 graph export ./output/time_series/resp_ac_`var'_`strata'.s
> vg, as(svg) replace
 31.                 graph combine pac_`strata'_1 pac_`strata'_2 pac_`strata'_3
>  pac_`strata'_4 pac_`strata'_5, altshrink
 32.                 graph export ./output/time_series/resp_pac_`var'_`strata'.
> svg, as(svg) replace
 33.         }
 34. }       
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_asthma_monitoring_ethnicity.svg not fo
> und)
(file ./output/time_series/resp_kd_asthma_monitoring_ethnicity.svg written in S
> VG format)
(note: file ./output/time_series/resp_ac_asthma_monitoring_ethnicity.svg not fo
> und)
(file ./output/time_series/resp_ac_asthma_monitoring_ethnicity.svg written in S
> VG format)
(note: file ./output/time_series/resp_pac_asthma_monitoring_ethnicity.svg not f
> ound)
(file ./output/time_series/resp_pac_asthma_monitoring_ethnicity.svg written in 
> SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_asthma_monitoring_imd.svg not found)
(file ./output/time_series/resp_kd_asthma_monitoring_imd.svg written in SVG for
> mat)
(note: file ./output/time_series/resp_ac_asthma_monitoring_imd.svg not found)
(file ./output/time_series/resp_ac_asthma_monitoring_imd.svg written in SVG for
> mat)
(note: file ./output/time_series/resp_pac_asthma_monitoring_imd.svg not found)
(file ./output/time_series/resp_pac_asthma_monitoring_imd.svg written in SVG fo
> rmat)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_copd_monitoring_ethnicity.svg not foun
> d)
(file ./output/time_series/resp_kd_copd_monitoring_ethnicity.svg written in SVG
>  format)
(note: file ./output/time_series/resp_ac_copd_monitoring_ethnicity.svg not foun
> d)
(file ./output/time_series/resp_ac_copd_monitoring_ethnicity.svg written in SVG
>  format)
(note: file ./output/time_series/resp_pac_copd_monitoring_ethnicity.svg not fou
> nd)
(file ./output/time_series/resp_pac_copd_monitoring_ethnicity.svg written in SV
> G format)
(5 vars, 282 obs)
(7 missing values generated)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_copd_monitoring_imd.svg not found)
(file ./output/time_series/resp_kd_copd_monitoring_imd.svg written in SVG forma
> t)
(note: file ./output/time_series/resp_ac_copd_monitoring_imd.svg not found)
(file ./output/time_series/resp_ac_copd_monitoring_imd.svg written in SVG forma
> t)
(note: file ./output/time_series/resp_pac_copd_monitoring_imd.svg not found)
(file ./output/time_series/resp_pac_copd_monitoring_imd.svg written in SVG form
> at)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_asthma_exacerbation_ethnicity.svg not 
> found)
(file ./output/time_series/resp_kd_asthma_exacerbation_ethnicity.svg written in
>  SVG format)
(note: file ./output/time_series/resp_ac_asthma_exacerbation_ethnicity.svg not 
> found)
(file ./output/time_series/resp_ac_asthma_exacerbation_ethnicity.svg written in
>  SVG format)
(note: file ./output/time_series/resp_pac_asthma_exacerbation_ethnicity.svg not
>  found)
(file ./output/time_series/resp_pac_asthma_exacerbation_ethnicity.svg written i
> n SVG format)
(5 vars, 282 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_asthma_exacerbation_imd.svg not found)
(file ./output/time_series/resp_kd_asthma_exacerbation_imd.svg written in SVG f
> ormat)
(note: file ./output/time_series/resp_ac_asthma_exacerbation_imd.svg not found)
(file ./output/time_series/resp_ac_asthma_exacerbation_imd.svg written in SVG f
> ormat)
(note: file ./output/time_series/resp_pac_asthma_exacerbation_imd.svg not found
> )
(file ./output/time_series/resp_pac_asthma_exacerbation_imd.svg written in SVG 
> format)
(5 vars, 235 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_copd_exacerbation_ethnicity.svg not fo
> und)
(file ./output/time_series/resp_kd_copd_exacerbation_ethnicity.svg written in S
> VG format)
(note: file ./output/time_series/resp_ac_copd_exacerbation_ethnicity.svg not fo
> und)
(file ./output/time_series/resp_ac_copd_exacerbation_ethnicity.svg written in S
> VG format)
(note: file ./output/time_series/resp_pac_copd_exacerbation_ethnicity.svg not f
> ound)
(file ./output/time_series/resp_pac_copd_exacerbation_ethnicity.svg written in 
> SVG format)
(5 vars, 282 obs)
(7 missing values generated)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2018m3 to 2022m1
                delta:  1 month
(note: file ./output/time_series/resp_kd_copd_exacerbation_imd.svg not found)
(file ./output/time_series/resp_kd_copd_exacerbation_imd.svg written in SVG for
> mat)
(note: file ./output/time_series/resp_ac_copd_exacerbation_imd.svg not found)
(file ./output/time_series/resp_ac_copd_exacerbation_imd.svg written in SVG for
> mat)
(note: file ./output/time_series/resp_pac_copd_exacerbation_imd.svg not found)
(file ./output/time_series/resp_pac_copd_exacerbation_imd.svg written in SVG fo
> rmat)

. 
.         
. log close
      name:  <unnamed>
       log:  /workspace/logs/model_checks_resp.log
  log type:  text
 closed on:   6 Jul 2022, 10:23:08
-------------------------------------------------------------------------------

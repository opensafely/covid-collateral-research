
. cap mkdir ./output/graphs

. cap mkdir ./output/tempdata

. cap mkdir ./output/tables

. 
. di "`outcome'"
depress

. 
. * open file to write results to
. file open tablecontent using ./output/tables/`outcome'_cox_models.txt, write 
> text replace
(note: file ./output/tables/depress_cox_models.txt not found)

. file write tablecontent ("period") _tab ("ethnic_group") _tab ("denominator")
>  _tab ("events") _tab ("total_person_wks") _tab ("Rate") _tab ("unadj_hr") _t
> ab ///
> ("unadj_ci") _tab ("unadj_lci") _tab ("unadj_uci") _tab ("p_adj_hr") _tab ("p
> _adj_ci") _tab ("p_adj_lci") _tab ("p_adj_uci") _tab ("f_adj_hr") _tab ("f_ad
> j_ci") _tab ("f_adj_lci") _tab ("f_adj_uci") _tab  _n

. 
. foreach period in pre pandemic wave1 easing1 wave2 easing2 wave3 easing3 {
  2. use ./output/prep_survival_`period', clear
  3. 
.     * Drop events that occur on index date
.     drop if `outcome'_admit_date==index_date
  4. 
.     * Update study population for diabetes and respiratory outcomes
.     drop if has_t1_diabetes==0 & "`outcome'"=="t1dm"
  5.     drop if has_t2_diabetes==0 & "`outcome'"=="t2dm"
  6.     drop if diabetes_subgroup==0 & "`outcome'"=="dm_keto"
  7.     drop if has_asthma==0 & "`outcome'"=="asthma"
  8.     drop if has_copd==1 & "`outcome'"=="copd"
  9. 
.     * Cox model for each outcome category
.     * Generate flags and end dates for each outcome
.     gen `outcome'_admit=(`outcome'_admit_date!=.)
 10.     tab `outcome'_admit
 11.     count if `outcome'_admit_date!=.
 12.     if r(N) > 10 {
 13.         gen `outcome'_end = end_date
 14.         replace `outcome'_end = `outcome'_admit_date if `outcome'_admit==1
 15. 
.         stset `outcome'_end, fail(`outcome'_admit) id(patient_id) enter(index
> _date) origin(index_date) 
 16.         * Kaplan-Meier plot
.         sts graph, by(eth5) ylabel(.75(.05)1)
 17.         graph export ./output/graphs/km_`outcome'_`period'_eth.svg, as(svg
> ) replace
 18.         * Cox model - crude
.         stcox i.eth5, strata(stp)
 19.         estimates save "./output/tempdata/crude_`outcome'_eth", replace 
 20.         eststo model1
 21.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'_eth", replace) idstr("crude_`outcome'_eth") 
 22.         *estat phtest, detail
.         * Cox model - age and gender adjusted
.         stcox i.eth5 i.age_cat i.male, strata(stp)
 23.         estimates save "./output/tempdata/model1_`outcome'_eth", replace 
 24.         eststo model2
 25.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model1_`outcome'_eth", replace) idstr("model1_`outcome'_eth") 
 26.         *estat phtest, detail
.         * Cox model - fully adjusted
.         stcox i.eth5 i.age_cat i.male i.urban_rural_bin i.imd i.shielded, str
> ata(stp)
 27.         estimates save "./output/tempdata/model2_`outcome'_eth", replace 
 28.         eststo model3
 29.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model2_`outcome'_eth", replace) idstr("model2_`outcome'_eth") 
 30.         *estat phtest, detail
.         esttab model1 model2 model3 using "./output/tables/`outcome'_estout_t
> able_eth_`period'.txt", b(a2) ci(2) label wide compress eform ///
>         title ("`outcome'") ///
>         varlabels(`e(labels)') ///
>         stats(N_outcome) ///
>         append 
 31.         eststo clear
 32.     * Write results to table
.         * eth16 labelled columns
. 
.         local lab1: label eth5 1
 33.         local lab2: label eth5 2
 34.         local lab3: label eth5 3
 35.         local lab4: label eth5 4
 36.         local lab5: label eth5 5
 37.         /* counts */
.         
.         * First row, eth16 = 1 (White British) reference cat
.         qui safecount if eth5==1
 38.         local denominator = r(N)
 39.         qui safecount if eth5 == 1 & `outcome'_admit == 1
 40.         local event = r(N)
 41.         bysort eth5: egen total_follow_up = total(_t)
 42.         qui su total_follow_up if eth5 == 1
 43.         local person_week = r(mean)/7
 44.         local rate = 100000*(`event'/`person_week')
 45.         if `event'>10 & `event'!=. {
 46.             file write tablecontent  ("`period'") _tab ("`lab1'") _tab (`d
> enominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate') _
> tab
 47.             file write tablecontent ("1.00") _tab _tab ("1.00") _tab _tab 
> _tab _tab ("1.00") _n
 48.             }
 49.         else {
 50.             file write tablecontent ("`period'") _tab ("`lab`eth''") _tab 
> ("redact") _n
 51.             continue
 52.         }
 53.     * outcomesequent ethnic groups
.         forvalues eth=2/5 {
 54.             qui safecount if eth5==`eth'
 55.             local denominator = r(N)
 56.             qui safecount if eth5 == `eth' & `outcome'_admit == 1
 57.             local event = r(N)
 58.             qui su total_follow_up if eth5 == `eth'
 59.             local person_week = r(mean)/7
 60.             local rate = 100000*(`event'/`person_week')
 61.             if `event'>10 & `event'!=. {
 62.                 file write tablecontent ("`period'") _tab ("`lab`eth''") _
> tab (`denominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`r
> ate') _tab  
 63.                 cap estimates use "./output/tempdata/crude_`outcome'_eth" 
 64.                 cap lincom `eth'.eth5, eform
 65.                 file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4
> .2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub))
>  _tab
 66.                 cap estimates clear
 67.                 cap estimates use "./output/tempdata/model1_`outcome'_eth"
>  
 68.                 cap lincom `eth'.eth5, eform
 69.                 file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4
> .2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub))
>   _tab
 70.                 cap estimates clear
 71.                 cap estimates use "./output/tempdata/model2_`outcome'_eth"
>  
 72.                 cap lincom `eth'.eth5, eform
 73.                 file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4
> .2f (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab %4.2f (r(lb)) _tab %4.2f (r(ub))
>  _n
 74.                 cap estimates clear
 75.             }
 76.             else {
 77.                 file write tablecontent ("`period'") _tab ("`lab`eth''") _
> tab ("redact") _n
 78.                 continue
 79.             }
 80.         }  //end ethnic group
 81. drop total_follow_up
 82.     }
 83. else { 
 84.     file write tablecontent ("`period'") _tab ("redact") _n
 85.     continue
 86. }
 87. } //end outcomes
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        975       97.50       97.50
          1 |         25        2.50      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  25
(25 real changes made)

                id:  patient_id
     failure event:  depress_admit != 0 & depress_admit < .
obs. time interval:  (depress_end[_n-1], depress_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          0  exclusions
------------------------------------------------------------------------------
      1,000  observations remaining, representing
      1,000  subjects
         25  failures in single-failure-per-subject data
    742,729  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       752

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_depress_pre_eth.svg not found)
(file ./output/graphs/km_depress_pre_eth.svg written in SVG format)

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood =  -2.944439
Iteration 1:   log likelihood = -1.009e-07
Iteration 2:   log likelihood = -3.710e-08
Iteration 3:   log likelihood = -1.365e-08
Iteration 4:   log likelihood = -5.021e-09
Iteration 5:   log likelihood = -1.847e-09
Iteration 6:   log likelihood = -6.795e-10
Iteration 7:   log likelihood = -2.500e-10
Iteration 8:   log likelihood = -9.196e-11
Iteration 9:   log likelihood = -3.383e-11
Iteration 10:  log likelihood = -1.245e-11
Iteration 11:  log likelihood = -4.579e-12
Iteration 12:  log likelihood = -1.684e-12
Iteration 13:  log likelihood = -6.182e-13
Iteration 14:  log likelihood = -2.274e-13
Iteration 15:  log likelihood = -8.527e-14
Iteration 16:  log likelihood = -2.842e-14
Iteration 17:  log likelihood = -1.421e-14
Iteration 18:  log likelihood = -7.105e-15
Iteration 19:  log likelihood =          0
Refining estimates:
Iteration 0:   log likelihood =          0
Iteration 1:   log likelihood =          0

Stratified Cox regr. -- no ties

No. of subjects =        1,000                  Number of obs    =          50
No. of failures =           25
Time at risk    =       742729
                                                LR chi2(4)       =        5.89
Log likelihood  =            0                  Prob > chi2      =      0.2076

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |          1   1.39e+08    -0.00   1.000            0           .
      Black  |          1   1.18e+08    -0.00   1.000            0           .
      Mixed  |          1   1.23e+08    -0.00   1.000            0           .
      Other  |   3.19e+16   2.96e+24     0.00   1.000            0           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/crude_depress_eth.ster not found)
file ./output/tempdata/crude_depress_eth.ster saved
(note: file ./output/tempdata/surv_crude_depress_eth.dta not found)
file ./output/tempdata/surv_crude_depress_eth.dta saved

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -2.8332133
Iteration 1:   log likelihood = -6.624e-07
Iteration 2:   log likelihood = -2.437e-07
Iteration 3:   log likelihood = -8.964e-08
Iteration 4:   log likelihood = -3.298e-08
Iteration 5:   log likelihood = -1.213e-08
Iteration 6:   log likelihood = -4.463e-09
Iteration 7:   log likelihood = -1.642e-09
Iteration 8:   log likelihood = -6.040e-10
Iteration 9:   log likelihood = -2.222e-10
Iteration 10:  log likelihood = -8.174e-11
Iteration 11:  log likelihood = -3.007e-11
Iteration 12:  log likelihood = -1.106e-11
Iteration 13:  log likelihood = -4.071e-12
Iteration 14:  log likelihood = -1.496e-12
Iteration 15:  log likelihood = -5.507e-13
Iteration 16:  log likelihood = -2.061e-13
Iteration 17:  log likelihood = -7.105e-14
Iteration 18:  log likelihood = -2.842e-14
Iteration 19:  log likelihood = -7.105e-15
Iteration 20:  log likelihood = -7.105e-15
Refining estimates:
Iteration 0:   log likelihood = -7.105e-15
Iteration 1:   log likelihood =          0

Stratified Cox regr. -- no ties

No. of subjects =          780                  Number of obs    =          43
No. of failures =           21
Time at risk    =       579344
                                                LR chi2(8)       =        5.67
Log likelihood  =            0                  Prob > chi2      =      0.6845

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.045952   1.13e+08     0.00   1.000            0           .
      Black  |   1.035675   8.15e+07     0.00   1.000            0           .
      Mixed  |   1.084334   1.28e+08     0.00   1.000            0           .
      Other  |   5.00e+13   6.62e+21     0.00   1.000            0           .
             |
     age_cat |
41 - 60 y..  |   .9966965   1.12e+08    -0.00   1.000            0           .
61 - 80 y..  |   1.051699   8.05e+07     0.00   1.000            0           .
  >80 years  |   256.1092   3.39e+10     0.00   1.000            0           .
             |
        male |
       Male  |   .9614164   6.90e+07    -0.00   1.000            0           .
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/model1_depress_eth.ster not found)
file ./output/tempdata/model1_depress_eth.ster saved
(note: file ./output/tempdata/surv_model1_depress_eth.dta not found)
file ./output/tempdata/surv_model1_depress_eth.dta saved

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -2.8332133
Iteration 1:   log likelihood = -6.624e-07
Iteration 2:   log likelihood = -2.437e-07
Iteration 3:   log likelihood = -8.964e-08
Iteration 4:   log likelihood = -3.298e-08
Iteration 5:   log likelihood = -1.213e-08
Iteration 6:   log likelihood = -4.463e-09
Iteration 7:   log likelihood = -1.642e-09
Iteration 8:   log likelihood = -6.040e-10
Iteration 9:   log likelihood = -2.222e-10
Iteration 10:  log likelihood = -8.174e-11
Iteration 11:  log likelihood = -3.007e-11
Iteration 12:  log likelihood = -1.106e-11
Iteration 13:  log likelihood = -4.071e-12
Iteration 14:  log likelihood = -1.499e-12
Iteration 15:  log likelihood = -5.471e-13
Iteration 16:  log likelihood = -1.990e-13
Iteration 17:  log likelihood = -7.105e-14
Iteration 18:  log likelihood = -2.842e-14
Iteration 19:  log likelihood = -7.105e-15
Iteration 20:  log likelihood = -7.105e-15
Refining estimates:
Iteration 0:   log likelihood = -7.105e-15
Iteration 1:   log likelihood =          0

Stratified Cox regr. -- no ties

No. of subjects =          780                  Number of obs    =          43
No. of failures =           21
Time at risk    =       579344
                                                LR chi2(12)      =        5.67
Log likelihood  =            0                  Prob > chi2      =      0.9320

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.220362   1.55e+08     0.00   1.000            0           .
      Black  |     1.0434   9.23e+07     0.00   1.000            0           .
      Mixed  |     1.8415   3.12e+08     0.00   1.000            0           .
      Other  |   6.73e+15   1.95e+24     0.00   1.000            0           .
             |
     age_cat |
41 - 60 y..  |   .5682669   7.50e+07    -0.00   1.000            0           .
61 - 80 y..  |    .843152   9.93e+07    -0.00   1.000            0           .
  >80 years  |   97.77032          .        .       .            .           .
             |
        male |
       Male  |   .3945285   3.69e+07    -0.00   1.000            0           .
             |
urban_rura~n |
      Urban  |   .5404708   5.37e+07    -0.00   1.000            0           .
             |
         imd |
          1  |   55.51886   1.82e+10     0.00   1.000            0           .
          2  |   16.58721          .        .       .            .           .
          3  |    58.1632   1.82e+10     0.00   1.000            0           .
          4  |   63.86085   2.29e+10     0.00   1.000            0           .
          5  |   37.05363   1.15e+10     0.00   1.000            0           .
             |
  1.shielded |          1  (omitted)
------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/tempdata/model2_depress_eth.ster not found)
file ./output/tempdata/model2_depress_eth.ster saved
(note: file ./output/tempdata/surv_model2_depress_eth.dta not found)
file ./output/tempdata/surv_model2_depress_eth.dta saved
(note: file ./output/tables/depress_estout_table_eth_pre.txt not found)
(output written to ./output/tables/depress_estout_table_eth_pre.txt)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        974       97.40       97.40
          1 |         26        2.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  26
(26 real changes made)

                id:  patient_id
     failure event:  depress_admit != 0 & depress_admit < .
obs. time interval:  (depress_end[_n-1], depress_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
        999  observations remaining, representing
        999  subjects
         26  failures in single-failure-per-subject data
    724,117  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       768

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_depress_pandemic_eth.svg not found)
(file ./output/graphs/km_depress_pandemic_eth.svg written in SVG format)

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -3.0910425
Iteration 1:   log likelihood = -1.6503331
Iteration 2:   log likelihood = -1.6240591
Iteration 3:   log likelihood = -1.6147628
Iteration 4:   log likelihood = -1.6113897
Iteration 5:   log likelihood =  -1.610155
Iteration 6:   log likelihood = -1.6097016
Iteration 7:   log likelihood = -1.6095349
Iteration 8:   log likelihood = -1.6094736
Iteration 9:   log likelihood =  -1.609451
Iteration 10:  log likelihood = -1.6094427
Iteration 11:  log likelihood = -1.6094397
Iteration 12:  log likelihood = -1.6094386
Iteration 13:  log likelihood = -1.6094382
Iteration 14:  log likelihood =  -1.609438
Iteration 15:  log likelihood = -1.6094379
Iteration 16:  log likelihood = -1.6094379
Iteration 17:  log likelihood = -1.6094379
Iteration 18:  log likelihood = -1.6094379
Iteration 19:  log likelihood = -1.6094379
Iteration 20:  log likelihood = -1.6094379
Iteration 21:  log likelihood = -1.6094379
Iteration 22:  log likelihood = -1.6094379
Iteration 23:  log likelihood = -1.6094379
Iteration 24:  log likelihood = -1.6094379
Iteration 25:  log likelihood = -1.6094379
Iteration 26:  log likelihood = -1.6094379
Iteration 27:  log likelihood = -1.6094379
Iteration 28:  log likelihood = -1.6094379
Iteration 29:  log likelihood = -1.6094379
Iteration 30:  log likelihood = -1.6094379
Iteration 31:  log likelihood = -1.6094379
Iteration 32:  log likelihood = -1.6094379
Refining estimates:
Iteration 0:   log likelihood = -1.6094379
Iteration 1:   log likelihood = -1.6094379

Stratified Cox regr. -- no ties

No. of subjects =          999                  Number of obs    =          50
No. of failures =           26
Time at risk    =       724117
                                                LR chi2(4)       =        2.96
Log likelihood  =   -1.6094379                  Prob > chi2      =      0.5640

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   6.86e+15   8.50e+23     0.00   1.000            0           .
      Black  |          1   1.49e+08    -0.00   1.000            0           .
      Mixed  |          1   1.55e+08    -0.00   1.000            0           .
      Other  |          1   1.55e+08    -0.00   1.000            0           .
------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/tempdata/crude_depress_eth.ster saved
file ./output/tempdata/surv_crude_depress_eth.dta saved

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -2.8903718
Iteration 1:   log likelihood = -.78888172
Iteration 2:   log likelihood = -.72694705
Iteration 3:   log likelihood =  -.7053625
Iteration 4:   log likelihood = -.69760721
Iteration 5:   log likelihood = -.69478312
Iteration 6:   log likelihood = -.69374834
Iteration 7:   log likelihood = -.69336825
Iteration 8:   log likelihood = -.69322849
Iteration 9:   log likelihood = -.69317709
Iteration 10:  log likelihood = -.69315818
Iteration 11:  log likelihood = -.69315123
Iteration 12:  log likelihood = -.69314867
Iteration 13:  log likelihood = -.69314773
Iteration 14:  log likelihood = -.69314738
Iteration 15:  log likelihood = -.69314725
Iteration 16:  log likelihood = -.69314721
Iteration 17:  log likelihood = -.69314719
Iteration 18:  log likelihood = -.69314718
Iteration 19:  log likelihood = -.69314718
Iteration 20:  log likelihood = -.69314718
Iteration 21:  log likelihood = -.69314718
Iteration 22:  log likelihood = -.69314718
Iteration 23:  log likelihood = -.69314718
Iteration 24:  log likelihood = -.69314718
Iteration 25:  log likelihood = -.69314718
Iteration 26:  log likelihood = -.69314718
Iteration 27:  log likelihood = -.69314718
Iteration 28:  log likelihood = -.69314718
Iteration 29:  log likelihood = -.69314718
Iteration 30:  log likelihood = -.69314718
Iteration 31:  log likelihood = -.69314718
Iteration 32:  log likelihood = -.69314718
Refining estimates:
Iteration 0:   log likelihood = -.69314718
Iteration 1:   log likelihood = -.69314718

Stratified Cox regr. -- no ties

No. of subjects =          774                  Number of obs    =          38
No. of failures =           19
Time at risk    =       562599
                                                LR chi2(7)       =        4.39
Log likelihood  =   -.69314718                  Prob > chi2      =      0.7334

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   1.12e+16   1.11e+24     0.00   1.000            0           .
      Black  |   1.12e+15   3.18e+23     0.00   1.000            0           .
      Mixed  |   4.71e+13   1.61e+22     0.00   1.000            0           .
      Other  |   3.028111   6.71e+08     0.00   1.000            0           .
             |
     age_cat |
41 - 60 y..  |   8.828892   8.44e+08     0.00   1.000            0           .
61 - 80 y..  |   6.43e-14   .0000164    -0.00   1.000            0           .
  >80 years  |          1  (omitted)
             |
        male |
       Male  |   1.36e+15   6.94e+22     0.00   1.000            0           .
------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/tempdata/model1_depress_eth.ster saved
file ./output/tempdata/surv_model1_depress_eth.dta saved

         failure _d:  depress_admit
   analysis time _t:  (depress_end-origin)
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

note: 1.shielded omitted because of collinearity
Iteration 0:   log likelihood = -2.8903718
Iteration 1:   log likelihood = -.00141135
Iteration 2:   log likelihood = -.00051957
Iteration 3:   log likelihood = -.00019124
Iteration 4:   log likelihood = -.00007038
Iteration 5:   log likelihood = -.00002589
Iteration 6:   log likelihood = -9.527e-06
Iteration 7:   log likelihood = -3.505e-06
Iteration 8:   log likelihood = -1.289e-06
Iteration 9:   log likelihood = -4.744e-07
Iteration 10:  log likelihood = -1.745e-07
Iteration 11:  log likelihood = -6.420e-08
Iteration 12:  log likelihood = -2.362e-08
Iteration 13:  log likelihood = -8.689e-09
Iteration 14:  log likelihood = -3.196e-09
Iteration 15:  log likelihood = -1.176e-09
Iteration 16:  log likelihood = -4.326e-10
Iteration 17:  log likelihood = -1.591e-10
Iteration 18:  log likelihood = -5.853e-11
Iteration 19:  log likelihood = -2.152e-11
Iteration 20:  log likelihood = -7.901e-12
Iteration 21:  log likelihood = -2.842e-12
Iteration 22:  log likelihood = -1.044e-12
Iteration 23:  log likelihood = -4.121e-13
Iteration 24:  log likelihood = -1.563e-13
Iteration 25:  log likelihood = -5.684e-14
Iteration 26:  log likelihood =  4.374e-09
Iteration 27:  log likelihood =  4.374e-09
Refining estimates:
Iteration 0:   log likelihood = -5.684e-14
Iteration 1:   log likelihood = -1.421e-14
Iteration 2:   log likelihood = -1.421e-14

Stratified Cox regr. -- no ties

No. of subjects =          774                  Number of obs    =          38
No. of failures =           19
Time at risk    =       562599
                                                LR chi2(9)       =        5.78
Log likelihood  =   -1.421e-14                  Prob > chi2      =      0.7616

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   28532.44          .        .       .            .           .
      Black  |   2.67e-09   .2448757    -0.00   1.000            0           .
      Mixed  |   1.24e-12   .0018402    -0.00   1.000            0           .
      Other  |   8414.758          .        .       .            .           .
             |
     age_cat |
41 - 60 y..  |   9.289189   9.98e+08     0.00   1.000            0           .
61 - 80 y..  |   1.14e+09   8.03e+16     0.00   1.000            0           .
  >80 years  |          1  (omitted)
             |
        male |
       Male  |   17775.43   1.16e+12     0.00   1.000            0           .
             |
urban_rura~n |
      Urban  |   9.27e-12   .0004973    -0.00   1.000            0           .
             |
         imd |
          1  |   2.89e+08   2.04e+16     0.00   1.000            0           .
          2  |   4.68e+31          .        .       .            .           .
          3  |   72795.08          .        .       .            .           .
          4  |   30493.09   3.54e+12     0.00   1.000            0           .
          5  |   3.79e+18   4.16e+26     0.00   1.000            0           .
             |
  1.shielded |          1  (omitted)
------------------------------------------------------------------------------
                                                             Stratified by stp
file ./output/tempdata/model2_depress_eth.ster saved
file ./output/tempdata/surv_model2_depress_eth.dta saved
(note: file ./output/tables/depress_estout_table_eth_pandemic.txt not found)
(output written to ./output/tables/depress_estout_table_eth_pandemic.txt)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        997       99.70       99.70
          1 |          3        0.30      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  3
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        995       99.50       99.50
          1 |          5        0.50      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  5
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        994       99.40       99.40
          1 |          6        0.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  6
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        998       99.80       99.80
          1 |          2        0.20      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  2
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        995       99.50       99.50
          1 |          5        0.50      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  5
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)
(0 observations deleted)

depress_adm |
         it |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        994       99.40       99.40
          1 |          6        0.60      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  6

. file close tablecontent

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/cox_model_depress.log
  log type:  text
 closed on:   9 Aug 2022, 09:12:52
-------------------------------------------------------------------------------

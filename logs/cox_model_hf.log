
. cap mkdir ./output/graphs

. cap mkdir ./output/tempdata

. cap mkdir ./output/tables

. 
. * open file to write results to
. file open tablecontent using ./output/tables/`outcome'_cox_models.txt, write 
> text replace
(note: file ./output/tables/hf_cox_models.txt not found)

. file write tablecontent ("Period") _tab ("Denominator") _tab ("Events") _tab 
> ("Total person-weeks") _tab ("Rate per 1000") _tab ("Crude HR") _tab _tab ("A
> ge/Sex Adjusted") _tab _tab ("Fully Adjusted") _tab _tab  _n

. file write tablecontent _tab _tab _tab _tab _tab _tab _tab   ("HR") _tab ("95
> % CI") _tab ("HR") _tab ("95% CI") _tab ("HR") _tab ("95% CI") _tab _tab  _n

. 
. foreach period in pre pandemic wave1 easing1 wave2 easing2 wave3 easing3 {
  2. use ./output/prep_survival_`period', clear
  3. 
.     * Drop events that occur on index date
.     drop if `outcome'_admit_date==index_date
  4.     * Cox model for each outcome category
.     * Generate flags and end dates for each outcome
.     gen `outcome'_admit=(`outcome'_admit_date!=.)
  5.     tab `outcome'_admit
  6.     count if `outcome'_admit_date!=.
  7.     if r(N) > 10 {
  8.         gen `outcome'_end = end_date
  9.         replace `outcome'_end = `outcome'_admit_date if `outcome'_admit==1
 10. 
.         stset `outcome'_end, fail(`outcome'_admit) id(patient_id) enter(index
> _date) origin(index_date) scale(365.25) 
 11.         * Kaplan-Meier plot
.         sts graph, by(eth5)
 12.         graph export ./output/graphs/km_`outcome'_`period'_eth.svg, as(svg
> ) replace
 13.         * Cox model - crude
.         stcox i.eth5
 14.         estimates save "./output/tempdata/crude_`outcome'_eth", replace 
 15.         eststo model1
 16.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_crude_`outcome'_eth", replace) idstr("crude_`outcome'_eth") 
 17.         estat phtest, detail
 18.         * Cox model - age and gender adjusted
.         stcox i.eth5 i.age_cat i.male
 19.         estimates save "./output/tempdata/model1_`outcome'_eth", replace 
 20.         eststo model2
 21.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model1_`outcome'_eth", replace) idstr("model1_`outcome'_eth") 
 22.         estat phtest, detail
 23.         * Cox model - fully adjusted
.         stcox i.eth5 i.age_cat i.male i.urban_rural_bin i.imd i.shielded
 24.         estimates save "./output/tempdata/model2_`outcome'_eth", replace 
 25.         eststo model3
 26.         parmest, label eform format(estimate p lb ub) saving("./output/tem
> pdata/surv_model2_`outcome'_eth", replace) idstr("model2_`outcome'_eth") 
 27.         estat phtest, detail
 28.         esttab model1 model2 model3 using "./output/tables/`outcome'_estou
> t_table_eth_`period'.txt", b(a2) ci(2) label wide compress eform ///
>         title ("`outcome'") ///
>         varlabels(`e(labels)') ///
>         stats(N_outcome) ///
>         append 
 29.         eststo clear
 30.     * Write results to table
.         * eth16 labelled columns
. 
.         local lab1: label eth5 1
 31.         local lab2: label eth5 2
 32.         local lab3: label eth5 3
 33.         local lab4: label eth5 4
 34.         local lab5: label eth5 5
 35.         /* counts */
.         
.         * First row, eth16 = 1 (White British) reference cat
.         qui safecount if eth5==1
 36.         local denominator = r(N)
 37.         qui safecount if eth5 == 1 & `outcome'_admit == 1
 38.         local event = r(N)
 39.         bysort eth5: egen total_follow_up = total(_t)
 40.         qui su total_follow_up if eth5 == 1
 41.         local person_week = r(mean)/7
 42.         local rate = 1000*(`event'/`person_week')
 43.         
.         file write tablecontent  ("`period'") _tab ("`lab1'") _tab (`denomina
> tor') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate') _tab
 44.         file write tablecontent ("1.00") _tab _tab ("1.00") _tab _tab ("1.
> 00") _n
 45. 
.     * outcomesequent ethnic groups
.         forvalues eth=2/5 {
 46.             qui safecount if eth5==`eth'
 47.             local denominator = r(N)
 48.             qui safecount if eth5 == `eth' & `outcome'_admit == 1
 49.             local event = r(N)
 50.             qui su total_follow_up if eth5 == `eth'
 51.             local person_week = r(mean)/7
 52.             local rate = 1000*(`event'/`person_week')
 53.             file write tablecontent ("`period'") _tab ("`lab`eth''") _tab 
> (`denominator') _tab (`event') _tab %10.0f (`person_week') _tab %3.2f (`rate'
> ) _tab  
 54.             cap estimates use "./output/tempdata/crude_`outcome'_eth" 
 55.             cap lincom `eth'.eth5, eform
 56.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 57.             cap estimates clear
 58.             cap estimates use "./output/tempdata/model1_`outcome'_eth" 
 59.             cap lincom `eth'.eth5, eform
 60.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab 
 61.             cap estimates clear
 62.             cap estimates use "./output/tempdata/model2_`outcome'_eth" 
 63.             cap lincom `eth'.eth5, eform
 64.             file write tablecontent  %4.2f (r(estimate)) _tab ("(") %4.2f 
> (r(lb)) (" - ") %4.2f (r(ub)) (")") _tab _n
 65.             cap estimates clear
 66.         }  //end ethnic group
 67. drop total_follow_up
 68.     }
 69. else { 
 70.     continue
 71. }
 72. } //end outcomes
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        979       97.90       97.90
          1 |         21        2.10      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  21
(21 real changes made)

                id:  patient_id
     failure event:  hf_admit != 0 & hf_admit < .
obs. time interval:  (hf_end[_n-1], hf_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)/365.25
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          0  exclusions
------------------------------------------------------------------------------
      1,000  observations remaining, representing
      1,000  subjects
         21  failures in single-failure-per-subject data
  2,035.885  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  2.058864

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_hf_pre_eth.svg not found)
(file ./output/graphs/km_hf_pre_eth.svg written in SVG format)

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -144.85039
Iteration 1:   log likelihood = -144.17925
Iteration 2:   log likelihood = -144.16892
Iteration 3:   log likelihood = -144.16892
Refining estimates:
Iteration 0:   log likelihood = -144.16892

Cox regression -- no ties

No. of subjects =        1,000                  Number of obs    =       1,000
No. of failures =           21
Time at risk    =   2035.88501
                                                LR chi2(4)       =        1.36
Log likelihood  =   -144.16892                  Prob > chi2      =      0.8506

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .4646346   .3393213    -1.05   0.294     .1110405    1.944203
      Black  |   .6680067   .4481129    -0.60   0.548     .1793812    2.487623
      Mixed  |   .6145698   .4122662    -0.73   0.468     .1650317    2.288627
      Other  |   .8294376   .5245835    -0.30   0.767     .2401239    2.865048
------------------------------------------------------------------------------
(note: file ./output/tempdata/crude_hf_eth.ster not found)
file ./output/tempdata/crude_hf_eth.ster saved
(note: file ./output/tempdata/surv_crude_hf_eth.dta not found)
file ./output/tempdata/surv_crude_hf_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |     -0.01222         0.00        1         0.9554
      3.eth5      |      0.29082         1.77        1         0.1830
      4.eth5      |      0.06484         0.09        1         0.7665
      5.eth5      |      0.23444         1.15        1         0.2830
      ------------+---------------------------------------------------
      global test |                      2.88        4         0.5782
      ----------------------------------------------------------------

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -126.54916
Iteration 1:   log likelihood =  -122.5984
Iteration 2:   log likelihood = -122.30721
Iteration 3:   log likelihood =   -122.235
Iteration 4:   log likelihood = -122.20862
Iteration 5:   log likelihood = -122.19894
Iteration 6:   log likelihood = -122.19538
Iteration 7:   log likelihood = -122.19407
Iteration 8:   log likelihood = -122.19359
Iteration 9:   log likelihood = -122.19341
Iteration 10:  log likelihood = -122.19335
Iteration 11:  log likelihood = -122.19332
Iteration 12:  log likelihood = -122.19332
Iteration 13:  log likelihood = -122.19331
Iteration 14:  log likelihood = -122.19331
Iteration 15:  log likelihood = -122.19331
Iteration 16:  log likelihood = -122.19331
Iteration 17:  log likelihood = -122.19331
Iteration 18:  log likelihood = -122.19331
Iteration 19:  log likelihood = -122.19331
Iteration 20:  log likelihood = -122.19331
Iteration 21:  log likelihood = -122.19331
Iteration 22:  log likelihood = -122.19331
Iteration 23:  log likelihood = -122.19331
Iteration 24:  log likelihood = -122.19331
Iteration 25:  log likelihood = -122.19331
Iteration 26:  log likelihood = -122.19331
Iteration 27:  log likelihood = -122.19331
Iteration 28:  log likelihood = -122.19331
Iteration 29:  log likelihood = -122.19331
Iteration 30:  log likelihood = -122.19331
Iteration 31:  log likelihood = -122.19331
Iteration 32:  log likelihood = -122.19331
Iteration 33:  log likelihood = -122.19331
Iteration 34:  log likelihood = -122.19331
Iteration 35:  log likelihood = -122.19331
Iteration 36:  log likelihood = -122.19331
Iteration 37:  log likelihood = -122.19331
Iteration 38:  log likelihood = -122.19331
Iteration 39:  log likelihood = -122.19331
Iteration 40:  log likelihood = -122.19331
Iteration 41:  log likelihood = -122.19331
Iteration 42:  log likelihood = -122.19331
Iteration 43:  log likelihood = -122.19331
Iteration 44:  log likelihood = -122.19331
Refining estimates:
Iteration 0:   log likelihood = -122.19331

Cox regression -- no ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           19
Time at risk    =  1605.114305
                                                LR chi2(7)       =        8.71
Log likelihood  =   -122.19331                  Prob > chi2      =      0.2740

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .2872775   .2403944    -1.49   0.136     .0557204    1.481115
      Black  |   .6934364   .4677053    -0.54   0.587     .1848812    2.600881
      Mixed  |   .4791913   .3510857    -1.00   0.315     .1139896    2.014433
      Other  |   .7585794   .4815511    -0.44   0.663     .2186014    2.632384
             |
     age_cat |
41 - 60 y..  |   .3232335   .2129649    -1.71   0.087     .0888578     1.17581
61 - 80 y..  |   .8513577   .4419115    -0.31   0.757     .3078093    2.354737
  >80 years  |   4.45e-20          .        .       .            .           .
             |
        male |
       Male  |   .9426039   .4369299    -0.13   0.899     .3799859     2.33825
------------------------------------------------------------------------------
(note: file ./output/tempdata/model1_hf_eth.ster not found)
file ./output/tempdata/model1_hf_eth.ster saved
(note: file ./output/tempdata/surv_model1_hf_eth.dta not found)
file ./output/tempdata/surv_model1_hf_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.00582         0.00        1         0.9797
      3.eth5      |      0.33674         2.22        1         0.1364
      4.eth5      |     -0.07320         0.10        1         0.7483
      5.eth5      |      0.24939         1.22        1         0.2697
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.17615         0.57        1         0.4484
      2.age_cat   |      0.28165         1.50        1         0.2211
      3.age_cat   |            .            .        1             .
      0b.male     |            .            .        1             .
      1.male      |     -0.45913         4.04        1         0.0444
      ------------+---------------------------------------------------
      global test |                     10.15        7         0.1801
      ----------------------------------------------------------------

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -126.54916
Iteration 1:   log likelihood = -116.67717
Iteration 2:   log likelihood = -116.19808
Iteration 3:   log likelihood = -116.10088
Iteration 4:   log likelihood = -116.06564
Iteration 5:   log likelihood = -116.05271
Iteration 6:   log likelihood = -116.04796
Iteration 7:   log likelihood = -116.04621
Iteration 8:   log likelihood = -116.04557
Iteration 9:   log likelihood = -116.04533
Iteration 10:  log likelihood = -116.04525
Iteration 11:  log likelihood = -116.04521
Iteration 12:  log likelihood =  -116.0452
Iteration 13:  log likelihood =  -116.0452
Iteration 14:  log likelihood =  -116.0452
Iteration 15:  log likelihood =  -116.0452
Iteration 16:  log likelihood =  -116.0452
Iteration 17:  log likelihood =  -116.0452
Iteration 18:  log likelihood =  -116.0452
Iteration 19:  log likelihood =  -116.0452
Iteration 20:  log likelihood =  -116.0452
Iteration 21:  log likelihood =  -116.0452
Iteration 22:  log likelihood =  -116.0452
Iteration 23:  log likelihood =  -116.0452
Iteration 24:  log likelihood =  -116.0452
Iteration 25:  log likelihood =  -116.0452
Iteration 26:  log likelihood =  -116.0452
Iteration 27:  log likelihood =  -116.0452
Iteration 28:  log likelihood =  -116.0452
Iteration 29:  log likelihood =  -116.0452
Iteration 30:  log likelihood =  -116.0452
Iteration 31:  log likelihood =  -116.0452
Iteration 32:  log likelihood =  -116.0452
Iteration 33:  log likelihood =  -116.0452
Iteration 34:  log likelihood =  -116.0452
Iteration 35:  log likelihood =  -116.0452
Iteration 36:  log likelihood =  -116.0452
Iteration 37:  log likelihood =  -116.0452
Iteration 38:  log likelihood =  -116.0452
Iteration 39:  log likelihood =  -116.0452
Iteration 40:  log likelihood =  -116.0452
Refining estimates:
Iteration 0:   log likelihood =  -116.0452
Iteration 1:   log likelihood =  -116.0452

Cox regression -- no ties

No. of subjects =          790                  Number of obs    =         790
No. of failures =           19
Time at risk    =  1605.114305
                                                LR chi2(15)      =       21.01
Log likelihood  =    -116.0452                  Prob > chi2      =      0.1366

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   .2451384   .2060736    -1.67   0.094     .0471906    1.273407
      Black  |   .6686167   .4542847    -0.59   0.554     .1765375    2.532313
      Mixed  |   .4595143   .3428768    -1.04   0.297     .1064526    1.983544
      Other  |   .6864231   .4425121    -0.58   0.559      .194023    2.428458
             |
     age_cat |
41 - 60 y..  |   .3043784   .2019103    -1.79   0.073     .0829405     1.11702
61 - 80 y..  |    .790061   .4166311    -0.45   0.655     .2810526    2.220924
  >80 years  |   9.84e-19   8.17e-10    -0.00   1.000            0           .
             |
        male |
       Male  |   .8598289   .4046778    -0.32   0.748     .3418179    2.162865
             |
urban_rura~n |
      Urban  |   3.767199   1.882355     2.65   0.008     1.414812    10.03086
             |
         imd |
          1  |   .1854237   .1891592    -1.65   0.099     .0251082     1.36935
          2  |   .1541107   .1570912    -1.83   0.067     .0209011    1.136309
          3  |   .3016356   .2820733    -1.28   0.200     .0482486    1.885734
          4  |    .476688   .4059909    -0.87   0.384     .0897994    2.530434
          5  |    .494803   .4243143    -0.82   0.412     .0921491    2.656888
             |
  1.shielded |   1.80e-18   3.32e-09    -0.00   1.000            0           .
------------------------------------------------------------------------------
(note: file ./output/tempdata/model2_hf_eth.ster not found)
file ./output/tempdata/model2_hf_eth.ster saved
(note: file ./output/tempdata/surv_model2_hf_eth.dta not found)
file ./output/tempdata/surv_model2_hf_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.02140         0.01        1         0.9283
      3.eth5      |      0.32708         2.20        1         0.1377
      4.eth5      |     -0.04244         0.04        1         0.8459
      5.eth5      |      0.22854         1.05        1         0.3048
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.19078         0.72        1         0.3962
      2.age_cat   |      0.25272         1.24        1         0.2648
      3.age_cat   |      0.13053         0.00        1         1.0000
      0b.male     |            .            .        1             .
      1.male      |     -0.42254         3.57        1         0.0587
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|     -0.32002         1.98        1         0.1599
      0b.imd      |            .            .        1             .
      1.imd       |      0.16012         0.51        1         0.4751
      2.imd       |     -0.04308         0.04        1         0.8419
      3.imd       |      0.16913         0.62        1         0.4301
      4.imd       |      0.08326         0.14        1         0.7067
      5.imd       |      0.00904         0.00        1         0.9668
      0b.shielded |            .            .        1             .
      1.shielded  |      0.07482         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                     13.56       15         0.5593
      ----------------------------------------------------------------
(note: file ./output/tables/hf_estout_table_eth_pre.txt not found)
(output written to ./output/tables/hf_estout_table_eth_pre.txt)
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        976       97.60       97.60
          1 |         24        2.40      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  24
(24 real changes made)

                id:  patient_id
     failure event:  hf_admit != 0 & hf_admit < .
obs. time interval:  (hf_end[_n-1], hf_end]
 enter on or after:  time index_date
 exit on or before:  failure
    t for analysis:  (time-origin)/365.25
            origin:  time index_date

------------------------------------------------------------------------------
      1,000  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
        999  observations remaining, representing
        999  subjects
         24  failures in single-failure-per-subject data
  1,975.485  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =  2.102669

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id
(note: file ./output/graphs/km_hf_pandemic_eth.svg not found)
(file ./output/graphs/km_hf_pandemic_eth.svg written in SVG format)

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -164.38877
Iteration 1:   log likelihood =  -161.8044
Iteration 2:   log likelihood = -161.48227
Iteration 3:   log likelihood = -161.46338
Iteration 4:   log likelihood = -161.46326
Refining estimates:
Iteration 0:   log likelihood = -161.46326

Cox regression -- no ties

No. of subjects =          999                  Number of obs    =         999
No. of failures =           24
Time at risk    =  1975.485284
                                                LR chi2(4)       =        5.85
Log likelihood  =   -161.46326                  Prob > chi2      =      0.2106

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   6.670246   7.130813     1.78   0.076     .8206662    54.21471
      Black  |   6.629349   7.087142     1.77   0.077     .8156225     53.8831
      Mixed  |    4.40207   4.921671     1.33   0.185     .4920206    39.38498
      Other  |    5.11072   5.598521     1.49   0.136     .5970851    43.74495
------------------------------------------------------------------------------
file ./output/tempdata/crude_hf_eth.ster saved
file ./output/tempdata/surv_crude_hf_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.13998         0.47        1         0.4929
      3.eth5      |      0.29616         2.11        1         0.1464
      4.eth5      |      0.19831         0.94        1         0.3312
      5.eth5      |      0.26431         1.68        1         0.1954
      ------------+---------------------------------------------------
      global test |                      4.05        4         0.3994
      ----------------------------------------------------------------

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -151.85429
Iteration 1:   log likelihood = -148.68189
Iteration 2:   log likelihood = -148.38634
Iteration 3:   log likelihood = -148.37163
Iteration 4:   log likelihood = -148.37155
Refining estimates:
Iteration 0:   log likelihood = -148.37155

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           23
Time at risk    =  1541.237509
                                                LR chi2(8)       =        6.97
Log likelihood  =   -148.37155                  Prob > chi2      =      0.5404

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   6.671675   7.135916     1.77   0.076     .8199803    54.28331
      Black  |   5.412462   5.846922     1.56   0.118     .6514289    44.96998
      Mixed  |    4.07319   4.557971     1.26   0.209     .4543861    36.51272
      Other  |   4.808829   5.270202     1.43   0.152     .5612689    41.20099
             |
     age_cat |
41 - 60 y..  |   1.297534   .6399507     0.53   0.597     .4935161    3.411426
61 - 80 y..  |   .8164016   .5121236    -0.32   0.746     .2387539    2.791626
  >80 years  |     1.5516   1.246578     0.55   0.585      .321301    7.492854
             |
        male |
       Male  |   .6815711   .2917048    -0.90   0.370     .2945822    1.576943
------------------------------------------------------------------------------
file ./output/tempdata/model1_hf_eth.ster saved
file ./output/tempdata/surv_model1_hf_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.13819         0.44        1         0.5072
      3.eth5      |      0.28311         1.86        1         0.1725
      4.eth5      |      0.18967         0.82        1         0.3641
      5.eth5      |      0.25828         1.52        1         0.2170
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.47227         5.06        1         0.0244
      2.age_cat   |      0.16432         0.64        1         0.4237
      3.age_cat   |      0.30376         2.04        1         0.1535
      0b.male     |            .            .        1             .
      1.male      |     -0.09267         0.20        1         0.6548
      ------------+---------------------------------------------------
      global test |                      9.46        8         0.3047
      ----------------------------------------------------------------

         failure _d:  hf_admit
   analysis time _t:  (hf_end-origin)/365.25
             origin:  time index_date
  enter on or after:  time index_date
                 id:  patient_id

Iteration 0:   log likelihood = -151.85429
Iteration 1:   log likelihood = -145.90916
Iteration 2:   log likelihood = -145.50034
Iteration 3:   log likelihood = -145.46537
Iteration 4:   log likelihood =   -145.458
Iteration 5:   log likelihood = -145.45533
Iteration 6:   log likelihood = -145.45434
Iteration 7:   log likelihood = -145.45398
Iteration 8:   log likelihood = -145.45385
Iteration 9:   log likelihood =  -145.4538
Iteration 10:  log likelihood = -145.45378
Iteration 11:  log likelihood = -145.45378
Iteration 12:  log likelihood = -145.45377
Iteration 13:  log likelihood = -145.45377
Iteration 14:  log likelihood = -145.45377
Iteration 15:  log likelihood = -145.45377
Iteration 16:  log likelihood = -145.45377
Iteration 17:  log likelihood = -145.45377
Iteration 18:  log likelihood = -145.45377
Iteration 19:  log likelihood = -145.45377
Iteration 20:  log likelihood = -145.45377
Iteration 21:  log likelihood = -145.45377
Iteration 22:  log likelihood = -145.45377
Iteration 23:  log likelihood = -145.45377
Iteration 24:  log likelihood = -145.45377
Iteration 25:  log likelihood = -145.45377
Iteration 26:  log likelihood = -145.45377
Iteration 27:  log likelihood = -145.45377
Iteration 28:  log likelihood = -145.45377
Iteration 29:  log likelihood = -145.45377
Iteration 30:  log likelihood = -145.45377
Iteration 31:  log likelihood = -145.45377
Refining estimates:
Iteration 0:   log likelihood = -145.45377
Iteration 1:   log likelihood = -145.45377

Cox regression -- no ties

No. of subjects =          780                  Number of obs    =         780
No. of failures =           23
Time at risk    =  1541.237509
                                                LR chi2(15)      =       12.80
Log likelihood  =   -145.45377                  Prob > chi2      =      0.6177

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        eth5 |
South Asian  |   6.410868   6.868455     1.73   0.083     .7851621     52.3449
      Black  |    6.04666   6.550143     1.66   0.097     .7234982    50.53515
      Mixed  |   4.356127   4.881084     1.31   0.189       .48453     39.1634
      Other  |   5.260377   5.775996     1.51   0.131     .6114784    45.25355
             |
     age_cat |
41 - 60 y..  |   1.337841   .6624326     0.59   0.557      .506911    3.530834
61 - 80 y..  |   .8834404   .5552324    -0.20   0.844     .2577547    3.027944
  >80 years  |   1.830774   1.496491     0.74   0.459     .3688541    9.086877
             |
        male |
       Male  |   .6893412   .2960318    -0.87   0.386     .2970933    1.599468
             |
urban_rura~n |
      Urban  |   .5876255    .271271    -1.15   0.249     .2377675    1.452275
             |
         imd |
          1  |   .9988739   .8080287    -0.00   0.999     .2046162    4.876198
          2  |   .6179661   .5252625    -0.57   0.571     .1168033    3.269445
          3  |   .3949784   .3639379    -1.01   0.313     .0649032    2.403703
          4  |   .5826625   .5146614    -0.61   0.541     .1031709    3.290615
          5  |   .2443424   .2472732    -1.39   0.164     .0336192    1.775867
             |
  1.shielded |   1.66e-14   3.08e-07    -0.00   1.000            0           .
------------------------------------------------------------------------------
file ./output/tempdata/model2_hf_eth.ster saved
file ./output/tempdata/surv_model2_hf_eth.dta saved

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      1b.eth5     |            .            .        1             .
      2.eth5      |      0.12520         0.37        1         0.5436
      3.eth5      |      0.26710         1.67        1         0.1958
      4.eth5      |      0.18822         0.84        1         0.3595
      5.eth5      |      0.27450         1.79        1         0.1804
      0b.age_cat  |            .            .        1             .
      1.age_cat   |      0.45330         4.44        1         0.0352
      2.age_cat   |      0.18222         0.81        1         0.3684
      3.age_cat   |      0.31151         2.24        1         0.1343
      0b.male     |            .            .        1             .
      1.male      |     -0.08879         0.18        1         0.6736
      0b.urban_r~n|            .            .        1             .
      1.urban_ru~n|      0.05175         0.07        1         0.7879
      0b.imd      |            .            .        1             .
      1.imd       |      0.24872         1.53        1         0.2154
      2.imd       |      0.35152         2.82        1         0.0933
      3.imd       |      0.13936         0.46        1         0.4990
      4.imd       |      0.25033         1.48        1         0.2232
      5.imd       |     -0.09450         0.23        1         0.6336
      0b.shielded |            .            .        1             .
      1.shielded  |      0.23237         0.00        1         1.0000
      ------------+---------------------------------------------------
      global test |                     16.56       15         0.3457
      ----------------------------------------------------------------
(note: file ./output/tables/hf_estout_table_eth_pandemic.txt not found)
(output written to ./output/tables/hf_estout_table_eth_pandemic.txt)
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        999       99.90       99.90
          1 |          1        0.10      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  1
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        997       99.70       99.70
          1 |          3        0.30      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  3
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        996       99.60       99.60
          1 |          4        0.40      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  4
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,000      100.00      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  0
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        996       99.60       99.60
          1 |          4        0.40      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  4
(0 observations deleted)

   hf_admit |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        998       99.80       99.80
          1 |          2        0.20      100.00
------------+-----------------------------------
      Total |      1,000      100.00
  2

. file close tablecontent

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/cox_model_hf.log
  log type:  text
 closed on:   6 Jul 2022, 14:07:08
-------------------------------------------------------------------------------

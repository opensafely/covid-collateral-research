
. cap mkdir ./output/time_series

. 
. 
. * Mental health outcomes
. * Clinical monitoring: BP measurement
. * Hospital admissions: any code and primary code for depression, anxiety, smi
> , self harm, eating disorders, OCD
. local a "systolic_bp_mh depression_admission anxiety_admission smi_admission 
> self_harm_admission eating_dis_admission" ///
> + "ocd_admission depression_primary_admission anxiety_primary_admission smi_p
> rimary_admission" ///
> + "self_harm_primary_admission eating_dis_primary_admission ocd_primary_admis
> sion anxiety_emergency" ///
> + "smi_emergency self_harm_emergency eating_dis_emergency ocd_emergency"

. forvalues i=1/19 {
  2.     local c: word `i' of `a' 
  3.         local b "ethnicity imd"
  4.         forvalues i=1/2 {
  5.         local d: word `i' of `b'
  6.         import delimited "./output/measures/measure_`c'_`d'_rate.csv", num
> ericcols(4) clear     //get csv
  7.         gen temp_date=date(date, "YMD")
  8.         format temp_date %td
  9.         gen postcovid=(temp_date>=date("23/03/2020", "DMY"))
 10.         gen month=mofd(temp_date)
 11.         format month %tm
 12.         drop temp_date
 13.         *Value to rate per 100k
.         gen rate = value*100000
 14.         label variable rate "Rate of `c' per 100,000"
 15.         *Set time series
.         tsset `d' month 
 16.         *Kernel density plots to check for normality and extreme values
.         kdensity rate if `d'==1, normal name(kd_`d'_1_`c')
 17.         kdensity rate if `d'==2, normal name(kd_`d'_2_`c')
 18.     kdensity rate if `d'==3, normal name(kd_`d'_3_`c')
 19.     kdensity rate if `d'==4, normal name(kd_`d'_4_`c')
 20.     kdensity rate if `d'==5, normal name(kd_`d'_5_`c')
 21.         *Autoregression plots by ethnicity
.     ac rate if `d'==1, name(ac_`d'_1_`c')
 22.         ac rate if `d'==2, name(ac_`d'_2_`c')
 23.     ac rate if `d'==3, name(ac_`d'_3_`c')
 24.     ac rate if `d'==4, name(ac_`d'_4_`c')
 25.     ac rate if `d'==5, name(ac_`d'_5_`c')
 26.         /*Partial autoregression plots by ethnicity
>         pac rate if `d'==1, name(pac_`d'_1_`c')
>         pac rate if `d'==2, name(pac_`d'_2_`c')
>     pac rate if `d'==3, name(pac_`d'_3_`c')
>     pac rate if `d'==4, name(pac_`d'_4_`c')
>     pac rate if `d'==5, name(pac_`d'_5_`c')*/
.         *Combine Graphs
.         graph combine kd_`d'_1_`c' kd_`d'_2_`c' kd_`d'_3_`c' kd_`d'_4_`c' kd_
> `d'_5_`c', altshrink
 27.         graph export ./output/time_series/mh_kd_`c'_`d'.eps, as(eps) repla
> ce
 28.         graph combine ac_`d'_1_`c' ac_`d'_2_`c' ac_`d'_3_`c' ac_`d'_4_`c' 
> ac_`d'_5_`c', altshrink
 29.         graph export ./output/time_series/mh_ac_`c'_`d'.eps, as(eps) repla
> ce
 30.     /*graph combine pac_`d'*', altshrink
>         graph export .output/graphs/mh_pac_`c'_`d'.eps, as(eps) replace*/
.         }
 31. }
(5 vars, 20 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2020m3 to 2020m6
                delta:  1 month
(n() set to 20)
(n() set to 20)
(n() set to 20)
(n() set to 20)
(n() set to 20)
(note: file ./output/time_series/mh_kd_systolic_bp_mh_ethnicity.eps not found)
(file ./output/time_series/mh_kd_systolic_bp_mh_ethnicity.eps written in EPS fo
> rmat)
(note: file ./output/time_series/mh_ac_systolic_bp_mh_ethnicity.eps not found)
(file ./output/time_series/mh_ac_systolic_bp_mh_ethnicity.eps written in EPS fo
> rmat)
(5 vars, 24 obs)
       panel variable:  imd (strongly balanced)
        time variable:  month, 2020m3 to 2020m6
                delta:  1 month
(n() set to 24)
(n() set to 24)
(n() set to 24)
(n() set to 24)
(n() set to 24)
(note: file ./output/time_series/mh_kd_systolic_bp_mh_imd.eps not found)
(file ./output/time_series/mh_kd_systolic_bp_mh_imd.eps written in EPS format)
(note: file ./output/time_series/mh_ac_systolic_bp_mh_imd.eps not found)
(file ./output/time_series/mh_ac_systolic_bp_mh_imd.eps written in EPS format)
(5 vars, 20 obs)
       panel variable:  ethnicity (strongly balanced)
        time variable:  month, 2020m3 to 2020m6
                delta:  1 month
(n() set to 20)
kd_ethnicity_1_depression_admission invalid name
r(198);

end of do-file
r(198);

end of do-file

r(198);



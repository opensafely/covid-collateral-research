
. cap mkdir ./output/collapsed

. cap mkdir ./output/graphs

. 
. * Generates graphs for clinical monitoring measures
. foreach this_group in cvd mh {
  2. * Ethnicity
.         import delimited using ./output/measures/`this_group'/measure_bp_meas
> _`this_group'_ethnicity_rate.csv, numericcols(4) clear
  3.         * Shouldn't be missing on server but is in dummy data
.         count if ethnicity==.
  4.         * Drop missings as not required
.         drop if ethnicity==0 | ethnicity==.
  5.         tab `this_group'_subgroup 
  6.         drop if `this_group'_subgroup==0
  7.         drop `this_group'_subgroup 
  8.         * Generate rate per 100,000
.         gen rate = value*100000 
  9.         * Format date
.         gen dateA = date(date, "YMD")
 10.         drop date
 11.         format dateA %dD/M/Y
 12.         * reshape dataset so columns with rates for each ethnicity 
.         reshape wide value rate population bp_meas, i(dateA) j(ethnicity)
 13.         describe
 14.         * Labelling ethnicity variables
.         label var rate1 "White"
 15.         label var rate2 "Mixed"
 16.         label var rate3 "Asian"
 17.         label var rate4 "Black"
 18.         label var rate5 "Other"
 19. 
.         * Generate line graph
.         graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan201
> 8(120)01Apr2022, angle(45) ///
>         format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Dat
> e") ylabel(#5, labsize(small) ///
>         angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(s
> mall) ///
>         title("Ethnic categories", size(small))) graphregion(fcolor(white))
 20. 
.         graph export ./output/graphs/line_`this_group'_bp_ethnic.svg, as(svg)
>  replace
 21. 
.         * Reviewer comments plotting first derivative i.e. difference between
>  current rate and previous months rate
.         forvalues i=1/5 {
 22.             sort dateA
 23.             gen first_derivative`i' = rate`i' - rate`i'[_n-1]
 24.             }
 25.         * Label variables 
.         label var first_derivative1 "White"
 26.         label var first_derivative2 "Mixed"
 27.         label var first_derivative3 "Asian"
 28.         label var first_derivative4 "Black"
 29.         label var first_derivative5 "Other"
 30.         * Plot this
.         graph twoway line first_derivative1 first_derivative2 first_derivativ
> e3 first_derivative4 first_derivative5 date, tlabel(01Jan2018(120)01Apr2022, 
> angle(45) ///
>         format(%dM-CY) labsize(small)) ytitle("Difference per 100,000") xtitl
> e("Date") ylabel(#5, labsize(small) ///
>         angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(s
> mall) ///
>         title("Ethnic categories", size(small))) graphregion(fcolor(white))
 31. 
.         graph export ./output/graphs/line_`this_group'_bp_diff_ethnic.svg, as
> (svg) replace
 32.         export delimited using ./output/graphs/line_data_`this_group'_bp_d
> iff_ethnic.csv
 33.     /* IMD
>     clear 
>     import delimited using ./output/measures/`this_group'/measure_bp_meas_`th
> is_group'_imd_rate.csv, numericcols(4)
>     * IMD should not have missings as . on server but could be in dummy data
>     count if imd==.
>     * Drop missings
>     drop if imd==. | imd==0
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_subgroup bp_meas, i(dateA) j(imd)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("IMD categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_`this_group'_bp_imd.svg, as(svg) replac
> e
>     */
.     }
(6 vars, 600 obs)
  100
(100 observations deleted)

cvd_subgrou |
          p |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        250       50.00       50.00
          1 |        250       50.00      100.00
------------+-----------------------------------
      Total |        500      100.00
(250 observations deleted)
(75 missing values generated)
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                      250   ->      50
Number of variables                   6   ->      21
j variable (5 values)         ethnicity   ->   (dropped)
xij variables:
                                  value   ->   value1 value2 ... value5
                                   rate   ->   rate1 rate2 ... rate5
                             population   ->   population1 population2 ... popu
> lation5
                                bp_meas   ->   bp_meas1 bp_meas2 ... bp_meas5
-----------------------------------------------------------------------------

Contains data
  obs:            50                          
 vars:            21                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
dateA           float   %dD/M/Y               
bp_meas1        byte    %8.0g                 1 bp_meas
population1     int     %8.0g                 1 population
value1          float   %9.0g                 1 value
rate1           float   %9.0g                 1 rate
bp_meas2        byte    %8.0g                 2 bp_meas
population2     int     %8.0g                 2 population
value2          float   %9.0g                 2 value
rate2           float   %9.0g                 2 rate
bp_meas3        byte    %8.0g                 3 bp_meas
population3     int     %8.0g                 3 population
value3          float   %9.0g                 3 value
rate3           float   %9.0g                 3 rate
bp_meas4        byte    %8.0g                 4 bp_meas
population4     int     %8.0g                 4 population
value4          float   %9.0g                 4 value
rate4           float   %9.0g                 4 rate
bp_meas5        byte    %8.0g                 5 bp_meas
population5     int     %8.0g                 5 population
value5          float   %9.0g                 5 value
rate5           float   %9.0g                 5 rate
-------------------------------------------------------------------------------
Sorted by: dateA
(note: file ./output/graphs/line_cvd_bp_ethnic.svg not found)
(file ./output/graphs/line_cvd_bp_ethnic.svg written in SVG format)
(33 missing values generated)
(25 missing values generated)
(23 missing values generated)
(26 missing values generated)
(24 missing values generated)
(note: file ./output/graphs/line_cvd_bp_diff_ethnic.svg not found)
(file ./output/graphs/line_cvd_bp_diff_ethnic.svg written in SVG format)
file ./output/graphs/line_data_cvd_bp_diff_ethnic.csv saved
(6 vars, 600 obs)
  100
(100 observations deleted)

mh_subgroup |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        250       50.00       50.00
          1 |        250       50.00      100.00
------------+-----------------------------------
      Total |        500      100.00
(250 observations deleted)
(2 missing values generated)
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                      250   ->      50
Number of variables                   6   ->      21
j variable (5 values)         ethnicity   ->   (dropped)
xij variables:
                                  value   ->   value1 value2 ... value5
                                   rate   ->   rate1 rate2 ... rate5
                             population   ->   population1 population2 ... popu
> lation5
                                bp_meas   ->   bp_meas1 bp_meas2 ... bp_meas5
-----------------------------------------------------------------------------

Contains data
  obs:            50                          
 vars:            21                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
dateA           float   %dD/M/Y               
bp_meas1        byte    %8.0g                 1 bp_meas
population1     int     %8.0g                 1 population
value1          float   %9.0g                 1 value
rate1           float   %9.0g                 1 rate
bp_meas2        byte    %8.0g                 2 bp_meas
population2     int     %8.0g                 2 population
value2          float   %9.0g                 2 value
rate2           float   %9.0g                 2 rate
bp_meas3        byte    %8.0g                 3 bp_meas
population3     int     %8.0g                 3 population
value3          float   %9.0g                 3 value
rate3           float   %9.0g                 3 rate
bp_meas4        byte    %8.0g                 4 bp_meas
population4     int     %8.0g                 4 population
value4          float   %9.0g                 4 value
rate4           float   %9.0g                 4 rate
bp_meas5        byte    %8.0g                 5 bp_meas
population5     int     %8.0g                 5 population
value5          float   %9.0g                 5 value
rate5           float   %9.0g                 5 rate
-------------------------------------------------------------------------------
Sorted by: dateA
(note: file ./output/graphs/line_mh_bp_ethnic.svg not found)
(file ./output/graphs/line_mh_bp_ethnic.svg written in SVG format)
(1 missing value generated)
(3 missing values generated)
(1 missing value generated)
(3 missing values generated)
(1 missing value generated)
(note: file ./output/graphs/line_mh_bp_diff_ethnic.svg not found)
(file ./output/graphs/line_mh_bp_diff_ethnic.svg written in SVG format)
file ./output/graphs/line_data_mh_bp_diff_ethnic.csv saved

. 
. /* Hospital admission graphs
> local groups "mi stroke heart_failure vte"
> forvalues i=1/4 {
>     local this_group :word `i' of `groups'
> * Ethnicity
>     clear 
>     import delimited using ./output/measures/cvd/measure_`this_group'_admissi
> on_ethnicity_rate.csv, numericcols(4)
>      * Shouldn't be missing on server but is in dummy data
>     count if ethnicity==.
>     * Drop missings as not required
>     drop if ethnicity==0 | ethnicity==.
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_admission population, i(dateA) j(eth
> nicity)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "White"
>     label var rate2 "Mixed"
>     label var rate3 "Asian"
>     label var rate4 "Black"
>     label var rate5 "Other"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("Ethnic categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_`this_group'_admission_ethnicity.svg, a
> s(svg) replace
>     * IMD
>     clear 
>     import delimited using ./output/measures/cvd/measure_`this_group'_admissi
> on_imd_rate.csv, numericcols(4)
>     * IMD should not have missings as . on server but could be in dummy data
>     count if imd==.
>     * Drop missings
>     drop if imd==. | imd==0
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_admission population, i(dateA) j(imd
> )
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("IMD categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_`this_group'_admission_imd.svg, as(svg)
>  replace
> 
> }
> local groups "depression anxiety smi self_harm eating_dis ocd"
> forvalues i=1/6 {
>     local this_group :word `i' of `groups'
> * Ethnicity
>     clear 
>     import delimited using ./output/measures/mh/measure_`this_group'_admissio
> n_ethnicity_rate.csv, numericcols(4)
>      * Shouldn't be missing on server but is in dummy data
>     count if ethnicity==.
>     * Drop missings as not required
>     drop if ethnicity==0 | ethnicity==.
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_admission population, i(dateA) j(eth
> nicity)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "White"
>     label var rate2 "Mixed"
>     label var rate3 "Asian"
>     label var rate4 "Black"
>     label var rate5 "Other"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("Ethnic categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_`this_group'_admission_ethnicity.svg, a
> s(svg) replace
>     * IMD
>     clear 
>     import delimited using ./output/measures/mh/measure_`this_group'_admissio
> n_imd_rate.csv, numericcols(4)
>     * IMD should not have missings as . on server but could be in dummy data
>     count if imd==.
>     * Drop missings
>     drop if imd==. | imd==0
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_admission population, i(dateA) j(imd
> )
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("IMD categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_`this_group'_admission_imd.svg, as(svg)
>  replace
> 
> }
> 
> * Hospital admissions - primary diagnosis CVD
> local groups "mi stroke heart_failure vte"
> forvalues i=1/4 {
>     local this_group :word `i' of `groups'
> * Ethnicity
>     clear 
>     import delimited using ./output/measures/cvd/measure_`this_group'_primary
> _admission_ethnicity_rate.csv, numericcols(4)
>      * Shouldn't be missing on server but is in dummy data
>     count if ethnicity==.
>     * Drop missings as not required
>     drop if ethnicity==0 | ethnicity==.
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_primary_admission population, i(date
> A) j(ethnicity)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "White"
>     label var rate2 "Mixed"
>     label var rate3 "Asian"
>     label var rate4 "Black"
>     label var rate5 "Other"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("Ethnic categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_cvd_`this_group'_primary_admission_ethn
> icity.svg, as(svg) replace
>     * IMD
>     clear 
>     import delimited using ./output/measures/cvd/measure_`this_group'_primary
> _admission_imd_rate.csv, numericcols(4)
>     * IMD should not have missings as . on server but could be in dummy data
>     count if imd==.
>     * Drop missings
>     drop if imd==. | imd==0
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_primary_admission population, i(date
> A) j(imd)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(12
> 0)01Apr2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(#5, labsize(small) ///
>     angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small
> ) ///
>     title("IMD categories", size(small))) graphregion(fcolor(white))
> 
>     graph export ./output/graphs/line_cvd_`this_group'_primary_admission_imd.
> svg, as(svg) replace
> 
> }*/
. /* Mental health measures - 3 monthly rates for primary admissions
> local groups "depression anxiety smi self_harm eating_dis ocd"
> forvalues i=1/6 {
>     local this_group :word `i' of `groups'
> * Ethnicity
>     clear 
>     import delimited using ./output/measures/measure_`this_group'_primary_adm
> ission_ethnicity_rate.csv, numericcols(4)
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * Collapse at 3 monthly intervals
>     gen quarter = qofd(dateA)
>     collapse (sum) value rate `this_group'_primary_admission population (min)
>  dateA,  by(quarter ethnicity)
>     drop quarter
>     * Outputing file 
>     export delimited using ./output/collapsed/collapse_measure_`this_group'_p
> rimary_admission_ethnicity_rate.csv
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_primary_admission population, i(date
> A) j(ethnicity)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "White"
>     label var rate2 "Mixed"
>     label var rate3 "Asian"
>     label var rate4 "Black"
>     label var rate5 "Other"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("Ethnic categories", size(small))) 
> 
>     graph export ./output/graphs/line_`this_group'_primary_admission_ethnicit
> y.svg, as(svg) replace
>     
>     * IMD
>     clear 
>     import delimited using ./output/measures/measure_`this_group'_primary_adm
> ission_imd_rate.csv, numericcols(4)
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * Collapse at 3 monthly intervals
>     gen quarter = qofd(dateA)
>     collapse (sum) value rate `this_group'_primary_admission population (min)
>  dateA,  by(quarter imd)
>     drop quarter
>     * Outputing file 
>     export delimited using ./output/collapsed/collapse_measure_`this_group'_p
> rimary_admission_imd_rate.csv
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_primary_admission population, i(date
> A) j(imd)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("IMD categories", size(small))) 
> 
>     graph export ./output/graphs/line_`this_group'_primary_admission_imd.svg,
>  as(svg) replace
> 
> }
> */
. /* Emergency admissions - small numbers for eating disorders and ocd so those
>  not included
> local groups "anxiety smi self_harm"
> forvalues i=1/3 {
>     local this_group :word `i' of `groups'
> * Ethnicity
>     clear 
>     import delimited using ./output/measures/mh/measure_`this_group'_emergenc
> y_ethnicity_rate.csv, numericcols(4)
>      * Shouldn't be missing on server but is in dummy data
>     count if ethnicity==.
>     * Drop missings as not required
>     drop if ethnicity==0 | ethnicity==.
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_emergency population, i(dateA) j(eth
> nicity)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "White"
>     label var rate2 "Mixed"
>     label var rate3 "Asian"
>     label var rate4 "Black"
>     label var rate5 "Other"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("Ethnic categories", size(small))) 
> 
>     graph export ./output/graphs/line_`this_group'_emergency_ethnicity.svg, a
> s(svg) replace
>     * IMD
>     clear 
>     import delimited using ./output/measures/mh/measure_`this_group'_emergenc
> y_imd_rate.csv, numericcols(4)
>     * IMD should not have missings as . on server but could be in dummy data
>     count if imd==.
>     * Drop missings
>     drop if imd==. | imd==0
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate `this_group'_emergency population, i(dateA) j(imd
> )
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("IMD categories", size(small))) 
> 
>     graph export ./output/graphs/line_`this_group'_emergency_imd.svg, as(svg)
>  replace
> 
> }*/
. 
. /*local outcomes "systolic_bp"
> local strata "monitoring exacerbation"
> local other "review exacerbation"
> forvalues i=1/2 {
>     local this_outcome :word `i' of `outcomes'
>     forvalues j=1/2 {
>         local this_strata :word `j' of `strata'
>         local this_other :word `j' of `other'
>     * Ethnicity
>     clear 
>     import delimited using "./output/measures/measure_`this_outcome'_`this_st
> rata'_ethnicity_rate.csv"
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate has_`this_outcome' `this_outcome'_`this_other', i
> (dateA) j(ethnicity)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "White"
>     label var rate2 "Mixed"
>     label var rate3 "Asian"
>     label var rate4 "Black"
>     label var rate5 "Other"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("Ethnic categories", size(small))) 
> 
>     graph export ./output/graphs/line_resp_ethnic_`this_outcome'_`this_strata
> '.svg, as(svg) replace
>     * IMD
>     clear 
>     import delimited using "./output/measures/resp/measure_`this_outcome'_`th
> is_strata'_imd_rate.csv"
>     * Generate rate per 100,000
>     gen rate = value*100000 
>     * Format date
>     gen dateA = date(date, "YMD")
>     drop date
>     format dateA %dD/M/Y
>     tab dateA 
>     * reshape dataset so columns with rates for each ethnicity 
>     reshape wide value rate has_`this_outcome' `this_outcome'_`this_other', i
> (dateA) j(imd)
>     describe
>     * Labelling ethnicity variables
>     label var rate1 "IMD - 1"
>     label var rate2 "IMD - 2"
>     label var rate3 "IMD - 3"
>     label var rate4 "IMD - 4"
>     label var rate5 "IMD - 5"
> 
>     * Generate line graph
>     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("IMD categories", size(small)))
> 
>     graph export ./output/graphs/line_resp_imd_`this_outcome'_`this_strata'.s
> vg, as(svg) replace
>     }
> }
> */
. */
. */
. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/graphs_mh_cvd.log
  log type:  text
 closed on:  28 Feb 2023, 14:28:14
-------------------------------------------------------------------------------

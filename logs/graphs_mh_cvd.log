
. cap mkdir ./output/collapsed

. cap mkdir ./output/graphs

. 
. * Generates graphs for clinical monitoring measures
. foreach this_group in cvd mh {
  2. * Ethnicity
.         import delimited using ./output/measures/`this_group'/measure_systoli
> c_bp_`this_group'_ethnicity_rate.csv, numericcols(4) clear
  3.         * Generate rate per 100,000
.         gen rate = value*100000 
  4.         * Format date
.         gen dateA = date(date, "YMD")
  5.         drop date
  6.         format dateA %dD/M/Y
  7.         tab dateA 
  8.         * reshape dataset so columns with rates for each ethnicity 
.         reshape wide value rate `this_group'_subgroup systolic_bp, i(dateA) j
> (ethnicity)
  9.         describe
 10.         * Labelling ethnicity variables
.         label var rate1 "White"
 11.         label var rate2 "Mixed"
 12.         label var rate3 "Asian"
 13.         label var rate4 "Black"
 14.         label var rate5 "Other"
 15. 
.         * Generate line graph
.         graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan201
> 8(180)01Jan2022, angle(45) ///
>         format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Dat
> e") ylabel(, labsize(small) ///
>         angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small)
>  title("Ethnic categories", size(small)))
 16. 
.         graph export ./output/graphs/line_bp_`this_group'_ethnic.svg, as(svg)
>  replace
 17.     * IMD
.     clear 
 18.     import delimited using ./output/measures/`this_group'/measure_systolic
> _bp_`this_group'_imd_rate.csv, numericcols(4)
 19.     * Generate rate per 100,000
.     gen rate = value*100000 
 20.     * Format date
.     gen dateA = date(date, "YMD")
 21.     drop date
 22.     format dateA %dD/M/Y
 23.     tab dateA 
 24.     * reshape dataset so columns with rates for each ethnicity 
.     reshape wide value rate `this_group'_subgroup systolic_bp, i(dateA) j(imd
> )
 25.     describe
 26.     * Labelling ethnicity variables
.     label var rate1 "IMD - 1"
 27.     label var rate2 "IMD - 2"
 28.     label var rate3 "IMD - 3"
 29.     label var rate4 "IMD - 4"
 30.     label var rate5 "IMD - 5"
 31. 
.     * Generate line graph
.     graph twoway line rate1 rate2 rate3 rate4 rate5 date, tlabel(01Jan2018(18
> 0)01Jan2022, angle(45) ///
>     format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") 
> ylabel(, labsize(small) ///
>     angle(0)) yscale(titlegap(*10)) xmtick(##6) legend(row(1) size(small) tit
> le("IMD categories", size(small))) 
 32. 
.     graph export ./output/graphs/line_bp_`this_group'_imd.svg, as(svg) replac
> e
 33.     }
(5 vars, 282 obs)
(90 missing values generated)

      dateA |      Freq.     Percent        Cum.
------------+-----------------------------------
  01mar2018 |          6        2.13        2.13
  01apr2018 |          6        2.13        4.26
  01may2018 |          6        2.13        6.38
  01jun2018 |          6        2.13        8.51
  01jul2018 |          6        2.13       10.64
  01aug2018 |          6        2.13       12.77
  01sep2018 |          6        2.13       14.89
  01oct2018 |          6        2.13       17.02
  01nov2018 |          6        2.13       19.15
  01dec2018 |          6        2.13       21.28
  01jan2019 |          6        2.13       23.40
  01feb2019 |          6        2.13       25.53
  01mar2019 |          6        2.13       27.66
  01apr2019 |          6        2.13       29.79
  01may2019 |          6        2.13       31.91
  01jun2019 |          6        2.13       34.04
  01jul2019 |          6        2.13       36.17
  01aug2019 |          6        2.13       38.30
  01sep2019 |          6        2.13       40.43
  01oct2019 |          6        2.13       42.55
  01nov2019 |          6        2.13       44.68
  01dec2019 |          6        2.13       46.81
  01jan2020 |          6        2.13       48.94
  01feb2020 |          6        2.13       51.06
  01mar2020 |          6        2.13       53.19
  01apr2020 |          6        2.13       55.32
  01may2020 |          6        2.13       57.45
  01jun2020 |          6        2.13       59.57
  01jul2020 |          6        2.13       61.70
  01aug2020 |          6        2.13       63.83
  01sep2020 |          6        2.13       65.96
  01oct2020 |          6        2.13       68.09
  01nov2020 |          6        2.13       70.21
  01dec2020 |          6        2.13       72.34
  01jan2021 |          6        2.13       74.47
  01feb2021 |          6        2.13       76.60
  01mar2021 |          6        2.13       78.72
  01apr2021 |          6        2.13       80.85
  01may2021 |          6        2.13       82.98
  01jun2021 |          6        2.13       85.11
  01jul2021 |          6        2.13       87.23
  01aug2021 |          6        2.13       89.36
  01sep2021 |          6        2.13       91.49
  01oct2021 |          6        2.13       93.62
  01nov2021 |          6        2.13       95.74
  01dec2021 |          6        2.13       97.87
  01jan2022 |          6        2.13      100.00
------------+-----------------------------------
      Total |        282      100.00
variable ethnicity contains missing values
r(498);

end of do-file
r(498);

end of do-file

r(498);


